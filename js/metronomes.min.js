(function(Ee,Fe){function B(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];b.toString!==Object.prototype.toString&&(d.toString=b.toString);return d}function x(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=Ge++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var Bc=function(){return I.__string_rec(this,"")},Jd=function(){};
Jd.__name__=!0;Jd.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Cc=function(){this.length=0};Cc.__name__=!0;Cc.prototype={add:function(a){a=[a];null==this.h?this.h=a:this.q[1]=a;this.q=a;this.length++},push:function(a){this.h=a=[a,this.h];null==this.q&&(this.q=a);this.length++},__class__:Cc};var Sb=function(){this.lastTime=window.performance.now();this._setDefaultValues()};Sb.__name__=!0;Sb.prototype={set_fps:function(a){this.frameCount=
0;return 1<=a&&60>a?this.fps=a|0:this.fps=60},set_skipFrame:function(a){a&&(Ee.log("pixi.plugins.app.Application > Deprecated: skipFrame - use fps property and set it to 30 instead"),this.set_fps(30));return this.skipFrame=a},_setDefaultValues:function(){this.pixelRatio=1;this.set_skipFrame(!1);this.autoResize=!0;this.forceFXAA=this.antialias=this.transparent=!1;this.backgroundColor=16777215;this.width=window.innerWidth;this.height=window.innerHeight;this.set_fps(60)},start:function(a,b){null==a&&
(a="auto");this.canvas=window.document.createElement("canvas");this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.canvas.style.position="absolute";null==b?window.document.body.appendChild(this.canvas):b.appendChild(this.canvas);this.stage=new PIXI.Container;var c={};c.view=this.canvas;c.backgroundColor=this.backgroundColor;c.resolution=this.pixelRatio;c.antialias=this.antialias;c.forceFXAA=this.forceFXAA;c.autoResize=this.autoResize;c.transparent=this.transparent;
this.renderer="auto"==a?PIXI.autoDetectRenderer(this.width,this.height,c):"canvas"==a?new PIXI.CanvasRenderer(this.width,this.height,c):new PIXI.WebGLRenderer(this.width,this.height,c);this.roundPixels&&(this.renderer.roundPixels=!0);this.autoResize&&(window.onresize=x(this,this._onWindowResize));Ja._frameTick.connect(x(this,this.onRequestAnimationFrame));this.lastTime=window.performance.now()},_onWindowResize:function(a){this.width=window.innerWidth;this.height=window.innerHeight;this.renderer.resize(this.width,
this.height);this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";if(null!=this.onResize)this.onResize()},onRequestAnimationFrame:function(a){this.frameCount++;if(this.frameCount==(60/this.fps|0)){this.frameCount=0;this.currentTime=window.performance.now();this.elapsedTime=this.currentTime-this.lastTime;this.lastTime=this.currentTime;if(null!=this.onUpdate)this.onUpdate(this.elapsedTime);this.renderer.render(this.stage)}},__class__:Sb};var ma=function(a,b,c){Sb.call(this);
this.initNape(b);this.initPixi(a);this.initAudio(c);this.setup();this.onResize=x(this,this.resize);this.onUpdate=x(this,this.firstTick)};ma.__name__=!0;ma.__super__=Sb;ma.prototype=B(Sb.prototype,{initPixi:function(a){this.antialias=!0;this.start(null,a)},initNape:function(a){this.space=null==a?new Dc(E.get(0,0,null)):a;this.cumalativeDt=0},initAudio:function(a){null==a&&(a=Fb.createContext());this.audioContext=a},firstTick:function(a){this.stage.visible=!1;this.tick(a);this.resize();this.onUpdate=
x(this,this.tick);this.stage.visible=!0},tick:function(a){this.updateSpace(a);for(this.cumalativeDt+=a;this.cumalativeDt>=ma.FixedTimeStep;)this.space.step(ma.FixedTimeStep,ma.VelocityIterationsPerTimeStep,ma.PositionIterationsPerTimeStep),this.cumalativeDt-=a;this.draw(a)},setup:function(){},updateSpace:function(a){},draw:function(a){},resize:function(){},__class__:ma});var cc=function(){this.g=new PIXI.Graphics;this.phase=-Math.PI/2;this.freqs=[];this.notes=[];ma.FixedTimeStep=.016666666666666666;
ma.VelocityIterationsPerTimeStep=20;ma.PositionIterationsPerTimeStep=20;this.noteUtils=new Tb;ma.call(this,window.document.getElementById("pixi-container"),new Dc(E.get(0,1E4,null)),Fb.createContext())};cc.__name__=!0;cc.main=function(){new cc};cc.__super__=ma;cc.prototype=B(ma.prototype,{setup:function(){var a=this;this.container=new PIXI.Container;this.stage.addChild(this.container);this.container.scale.set(.75);this.renderer.backgroundColor=1052703;for(var b=[],c=0;12>c;)c++,b.push(54+wa["int"](16*
Math.random()));this.notes=b;b=0;for(c=this.notes.length;b<c;)b++,this.freqs.push(this.noteUtils.noteIndexToFrequency(this.notes[wa["int"](Math.random()*this.notes.length)]));this.outGain=this.audioContext.createGain();this.outGain.gain.value=.5;this.outGain.connect(this.audioContext.destination);this.tones=new qc(this.audioContext,this.outGain);this.tones.type=window.TonesOscillatorTypeShim.SAWTOOTH;this.tones.set_attack(.05);this.tones.set_release(.25);this.tones.set_volume(0);this.createMetronomes();
dc.delay(function(){for(var b=0,c=a.metronomes;b<c.length;){var l=c[b];++b;l.applyStartForce()}},2E3)},resize:function(){this.container.x=this.width/2-this.container.width/2;this.container.y=this.height/2-this.container.height/2},updateSpace:function(a){for(var b=0,c=this.metronomes;b<c.length;){var d=c[b];++b;d.update(a);this.phase+=1E-4;d.setTuneAnchorPosition(.01+.01*d.index+.48*(Math.sin(this.phase)+1))}},draw:function(a){for(var b=0,c=this.metronomes;b<c.length;){var d=c[b];++b;d.draw(a)}},createMetronomes:function(){this.container.addChild(this.g);
this.g.lineStyle(2,3080192);this.g.moveTo(0,240);this.g.lineTo(1075,240);this.metronomes=[];for(var a=0,b=0;6>b;){var c=b++;this.metronomes[c]=new Ka(c,a,240,this.space);this.metronomes[c].setTuneAnchorPosition(.001+.01*c);this.container.addChild(this.metronomes[c].graphics);a+=215}a=Ec;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Qa,f.internal=!1);b=f.CbEvent_BEGIN;null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new na,f.internal=!1);this.tickListener=new a(b,
f.InteractionType_SENSOR,Ka.barCbType,Ka.sensorCbType,x(this,this.tickSensorHandler));this.space.zpp_inner.wrap_listeners.add(this.tickListener)},tickSensorHandler:function(a){a=a.zpp_inner.int2.outer_i.get_userData().metronome;a.tick(this.freqs.length);var b=this.freqs[a.tickIndex],c=a.index/this.metronomes.length,d=1-c;this.tones.set_volume(.025+.25*d*d*d*d);this.tones.set_attack(.025+c*c*.5);this.tones.set_release(.2+.5*c);1<a.index&&(c=this.tones,c.set_volume(.8*c._volume));b=this.noteUtils.detune(b,
1200*(a.index/2|0)+16*(Math.random()-.5));this.tones.playFrequency(b)},__class__:cc});Math.__name__=!0;var Ia=function(){this.zpp_inner=null;this.zpp_inner=new ba;this.zpp_inner.outer=this};Ia.__name__=!0;Ia.prototype={toString:function(){return this==ba.ANY_BODY?"ANY_BODY":this==ba.ANY_SHAPE?"ANY_SHAPE":this==ba.ANY_COMPOUND?"ANY_COMPOUND":this==ba.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:Ia};var ba=function(){this.cbsets=this.listeners=this.bodylisteners=this.conlisteners=
null;this.id=0;this.outer=null;this.id=oa.CbType();this.listeners=new Fc;this.bodylisteners=new sd;this.conlisteners=new td;this.constraints=new Ub;this.interactors=new ec;this.cbsets=new Gc};ba.__name__=!0;ba.prototype={addint:function(a){for(var b=null,c=this.listeners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.listeners.inlined_insert(b,a);this.invalidateint()},invalidateint:function(){for(var a=this.cbsets.head;null!=
a;){var b=a.elt;b.zip_listeners=!0;b.invalidate_pairs();a=a.next}},addbody:function(a){for(var b=null,c=this.bodylisteners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.bodylisteners.inlined_insert(b,a);this.invalidatebody()},invalidatebody:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_bodylisteners=!0,a=a.next},addconstraint:function(a){for(var b=null,c=this.conlisteners.head;null!=c;){var d=c.elt;if(a.precedence>
d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.conlisteners.inlined_insert(b,a);this.invalidateconstraint()},invalidateconstraint:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_conlisteners=!0,a=a.next},__class__:ba};var oa=function(){};oa.__name__=!0;oa.Constraint=function(){return oa._Constraint++};oa.Interactor=function(){return oa._Interactor++};oa.CbType=function(){return oa._CbType++};oa.CbSet=function(){return oa._CbSet++};oa.Listener=function(){return oa._Listener++};
var Fc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Fc.__name__=!0;Fc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Aa.zpp_pool?b=new Aa:(b=Aa.zpp_pool,Aa.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_insert:function(a,b){var c;null==Aa.zpp_pool?c=new Aa:(c=Aa.zpp_pool,Aa.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=
a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Aa.zpp_pool;Aa.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,
null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Aa.zpp_pool;Aa.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:Fc};var sd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};sd.__name__=!0;sd.prototype={inlined_insert:function(a,
b){var c;null==Gb.zpp_pool?c=new Gb:(c=Gb.zpp_pool,Gb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Gb.zpp_pool;Gb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==
a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Gb.zpp_pool;Gb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:sd};var td=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};td.__name__=
!0;td.prototype={inlined_insert:function(a,b){var c;null==Hb.zpp_pool?c=new Hb:(c=Hb.zpp_pool,Hb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Hb.zpp_pool;Hb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=
null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Hb.zpp_pool;Hb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:td};var Ub=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};Ub.__name__=!0;Ub.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ra.zpp_pool?b=new Ra:(b=Ra.zpp_pool,Ra.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Ra.zpp_pool?c=new Ra:(c=Ra.zpp_pool,Ra.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=
c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ra.zpp_pool;Ra.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);
d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ra.zpp_pool;Ra.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ub};var ec=function(){this.length=0;this.modified=this.pushmod=
!1;this.head=null};ec.__name__=!0;ec.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==jb.zpp_pool?b=new jb:(b=jb.zpp_pool,jb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=jb.zpp_pool;jb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=jb.zpp_pool;jb.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},inlined_clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:ec};var Gc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Gc.__name__=!0;Gc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ib.zpp_pool?b=new Ib:(b=Ib.zpp_pool,Ib.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=
!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ib.zpp_pool;Ib.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);
d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ib.zpp_pool;Ib.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Gc};var Ka=function(a,b,c,d){this.tp=0;this.ballOff=(new pa).setColor(5443343);this.ballOn=(new pa).setColor(16585748);this.ballColour=new pa;this.tickIndex=-1;this.ticked=!1;this.index=
a;this.space=d;this.graphics=new PIXI.Graphics;this._x=b;this._y=c;this.setup()};Ka.__name__=!0;Ka.prototype={setup:function(){var a,b,c=new Yc;b=this._x;a=this._y-100;a=rc.createBox(function(a){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1);return f.BodyType_DYNAMIC}(this),b,a,5,300);a.setShapeMaterials(new sc(.2,.57,.74,2.7,.001));a.set_group(new Kd(!1));null==a.zpp_inner_i.wrap_cbTypes&&a.zpp_inner_i.setupcbTypes();a.zpp_inner_i.wrap_cbTypes.add(Ka.barCbType);
(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)!=c&&(null!=(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)&&(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(a),null!=c&&c.zpp_inner.wrap_bodies.add(a));null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer;this.bar=a;a=this._y+100;a=rc.createCircle(function(a){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1);return f.BodyType_DYNAMIC}(this),b,a,32);
a.setShapeMaterials(new sc(0,.57,.84,11.34,.01));(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)!=c&&(null!=(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)&&(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(a),null!=c&&c.zpp_inner.wrap_bodies.add(a));null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer;this.massBall=a;a=this._y;a=rc.createCircle(function(a){null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new T,
f.internal=!1);return f.BodyType_KINEMATIC}(this),b,a,8);(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)!=c&&(null!=(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)&&(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(a),null!=c&&c.zpp_inner.wrap_bodies.add(a));null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer;this.pivotBall=a;a=this._y-100;a=rc.createCircle(function(a){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=
new T,f.internal=!1);return f.BodyType_DYNAMIC}(this),b,a,16);a.setShapeMaterials(new sc(0,.57,.84,11.34,.01));(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)!=c&&(null!=(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)&&(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(a),null!=c&&c.zpp_inner.wrap_bodies.add(a));null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer;this.tuneWeight=a;this.pivot=new Zc(this.pivotBall,this.bar,E.get(0,
0,!0),E.get(0,75,!0));this.pivot.set_compound(c);this.pivot.set_ignore(!0);this.pivot.set_stiff(!0);this.pivot.set_damping(0);this.massWeld=new Hc(this.massBall,this.bar,E.get(0,0,!0),E.get(0,150,!0));this.massWeld.set_compound(c);this.massWeld.set_ignore(!0);this.massWeld.set_stiff(!0);this.massWeld.set_damping(0);this.tuneWeld=new Hc(this.tuneWeight,this.bar,E.get(0,0,!0),E.get(0,0,!0));this.tuneWeld.set_compound(c);this.tuneWeld.set_ignore(!0);this.tuneWeld.set_stiff(!0);this.tuneWeld.set_damping(0);
b=new Ic(.01);b.zpp_inner.immutable_midstep("Shape::sensorEnabled");b.zpp_inner.sensorEnabled=!0;b.zpp_inner.wake();b.zpp_inner.sensorEnabled;a=Vb;null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new T,f.internal=!1);this.tickSensor=new a(f.BodyType_KINEMATIC,E.get(this._x,this._y+150,!0));this.tickSensor.zpp_inner.wrap_shapes.add(b);this.tickSensor.set_group(this.bar.get_group());this.tickSensor.set_compound(c);this.tickSensor.get_cbTypes().add(Ka.sensorCbType);this.tickSensor.get_userData().metronome=
this;c.set_space(this.space);this.set_x(this._x);this.set_y(this._y);this.tuneAnchorPosition=-1;this.setTuneAnchorPosition(.5)},applyStartForce:function(){this.massBall.applyImpulse(E.get(8192,0,!0))},tick:function(a){this.tickIndex=(this.tickIndex+1)%a;a=this.massBall.get_velocity().get_x();this.massBall.applyImpulse(E.get(42*(0<a?1:-1),0,!0));this.tp=0;this.ballColour.setColor(16585748);this.ticked=!0},update:function(a){1>this.tp&&(this.tp+=.1,this.ballColour=this.ballOn.interpolate(this.ballOff,
this.tp))},draw:function(a){this.graphics.clear();var b=16+(this.tickIndex/24*239|0)<<16;a=this.bar.zpp_inner.wrap_shapes.at(0).get_castPolygon().get_worldVerts();var c=a.at(0);this.graphics.beginFill(b);this.graphics.moveTo(function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");c.zpp_inner.validate();return c.zpp_inner.x}(this),function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");c.zpp_inner.validate();return c.zpp_inner.y}(this));
for(var b=1,d=a.zpp_gl();b<d;){var e=b++,c=a.at(e);this.graphics.lineTo(function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");c.zpp_inner.validate();return c.zpp_inner.x}(this),function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");c.zpp_inner.validate();return c.zpp_inner.y}(this))}c=a.at(0);this.graphics.lineTo(function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
c.zpp_inner.validate();return c.zpp_inner.x}(this),function(a){if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");c.zpp_inner.validate();return c.zpp_inner.y}(this));this.graphics.endFill();b=this.ballColour.getColor();this.graphics.beginFill(b);this.graphics.drawCircle(this.massBall.get_position().get_x(),this.massBall.get_position().get_y(),32);this.graphics.endFill();this.graphics.beginFill(b);this.graphics.drawCircle(this.pivotBall.get_position().get_x(),this.pivotBall.get_position().get_y(),
8);this.graphics.endFill();this.graphics.beginFill(b);this.graphics.drawCircle(this.tuneWeight.get_position().get_x(),this.tuneWeight.get_position().get_y(),16);this.graphics.endFill();this.ticked=!1},set_x:function(a){return this.tickSensor.get_position().set_x(this.pivotBall.get_position().set_x(this._x=a))},set_y:function(a){this.tickSensor.get_position().set_y(a-150);return this.pivotBall.get_position().set_y(this._y=a)},setTuneAnchorPosition:function(a){if(a!=this.tuneAnchorPosition){var b=this.pivot.get_anchor2().get_y()-
8-16;this.tuneWeld.get_anchor2().set_y(b+a*(-150-b));this.tuneAnchorPosition=a}},__class__:Ka};var Jc=function(){};Jc.__name__=!0;Jc.hasField=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};Jc.isFunction=function(a){return"function"==typeof a&&!(a.__name__||a.__ename__)};Jc.compare=function(a,b){return a==b?0:a>b?1:-1};var wa=function(){};wa.__name__=!0;wa.string=function(a){return I.__string_rec(a,"")};wa["int"]=function(a){return a|0};var ge=function(){};ge.__name__=!0;var dc=function(a){var b=
this;this.id=setInterval(function(){b.run()},a)};dc.__name__=!0;dc.delay=function(a,b){var c=new dc(b);c.run=function(){c.stop();a()};return c};dc.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:dc};var ud=function(){};ud.__name__=!0;ud.prototype={set:function(a,b){this.root=this.setLoop(a,b,this.root)},get:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return b.value;b=0>c?b.left:b.right}return null},iterator:function(){var a=
[];this.iteratorLoop(this.root,a);return Jd.iter(a)},setLoop:function(a,b,c){if(null==c)return new xa(null,a,b,null);var d=this.compare(a,c.key);if(0==d)return new xa(c.left,a,b,c.right,null==c?0:c._height);if(0>d)return a=this.setLoop(a,b,c.left),this.balance(a,c.key,c.value,c.right);a=this.setLoop(a,b,c.right);return this.balance(c.left,c.key,c.value,a)},iteratorLoop:function(a,b){null!=a&&(this.iteratorLoop(a.left,b),b.push(a.value),this.iteratorLoop(a.right,b))},balance:function(a,b,c,d){var e;
e=null==a?0:a._height;var l;l=null==d?0:d._height;return e>l+2?function(b){b=a.left;return null==b?0:b._height}(this)>=function(b){b=a.right;return null==b?0:b._height}(this)?new xa(a.left,a.key,a.value,new xa(a.right,b,c,d)):new xa(new xa(a.left,a.key,a.value,a.right.left),a.right.key,a.right.value,new xa(a.right.right,b,c,d)):l>e+2?function(a){a=d.right;return null==a?0:a._height}(this)>function(a){a=d.left;return null==a?0:a._height}(this)?new xa(new xa(a,b,c,d.left),d.key,d.value,d.right):new xa(new xa(a,
b,c,d.left.left),d.left.key,d.left.value,new xa(d.left.right,d.key,d.value,d.right)):new xa(a,b,c,d,(e>l?e:l)+1)},compare:function(a,b){return Jc.compare(a,b)},__class__:ud};var xa=function(a,b,c,d,e){null==e&&(e=-1);this.left=a;this.key=b;this.value=c;this.right=d;this._height=-1==e?(function(a){a=a.left;return null==a?0:a._height}(this)>function(a){a=a.right;return null==a?0:a._height}(this)?function(a){a=a.left;return null==a?0:a._height}(this):function(a){a=a.right;return null==a?0:a._height}(this))+
1:e};xa.__name__=!0;xa.prototype={__class__:xa};var vd=function(){this.h={}};vd.__name__=!0;vd.__interfaces__=[ge];vd.prototype={remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},__class__:vd};var Kc=function(){this.h={};this.h.__keys__={}};Kc.__name__=!0;Kc.__interfaces__=[ge];Kc.prototype={set:function(a,b){var c=a.__id__||(a.__id__=++Kc.count);this.h[c]=b;this.h.__keys__[c]=a},remove:function(a){a=a.__id__;if(null==this.h.__keys__[a])return!1;delete this.h[a];
delete this.h.__keys__[a];return!0},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&a.push(this.h.__keys__[b]);return Jd.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref[a.__id__]}}},__class__:Kc};var Ld=function(){};Ld.__name__=!0;Ld.prototype={__class__:Ld};var pa=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.numOfChannels=3;this.data=[];
this.set_red(a);this.set_green(b);this.set_blue(c)};pa.__name__=!0;pa.__interfaces__=[Ld];pa.prototype={getValue:function(a){return this.data[a]},setValue:function(a,b){this.data[a]=Math.min(255,Math.max(b,0));return b},get_red:function(){return this.getValue(0)},set_red:function(a){return this.setValue(0,a)},get_green:function(){return this.getValue(1)},set_green:function(a){return this.setValue(1,a)},get_blue:function(){return this.getValue(2)},set_blue:function(a){return this.setValue(2,a)},toRGB:function(){return this.clone()},
getColor:function(){return Math.round(this.get_red())<<16|Math.round(this.get_green())<<8|Math.round(this.get_blue())},fromRGB:function(a){this.set_red(a.get_red());this.set_green(a.get_green());this.set_blue(a.get_blue());return this},setColor:function(a){this.set_red(a>>16&255);this.set_green(a>>8&255);this.set_blue(a&255);return this},clone:function(){return new pa(this.get_red(),this.get_green(),this.get_blue())},interpolate:function(a,b){null==b&&(b=.5);var c;c=I.__instanceof(a,pa)?a:(new pa).fromRGB(a.toRGB());
return new pa(this.get_red()+(c.get_red()-this.get_red())*b,this.get_green()+(c.get_green()-this.get_green())*b,this.get_blue()+(c.get_blue()-this.get_blue())*b)},__class__:pa};var La={__ename__:!0,__constructs__:["Once","Times","Forever"],Once:["Once",0]};La.Once.toString=Bc;La.Once.__enum__=La;La.Times=function(a){a=["Times",1,a];a.__enum__=La;a.toString=Bc;return a};La.Forever=["Forever",2];La.Forever.toString=Bc;La.Forever.__enum__=La;var Wb={__ename__:!0,__constructs__:["AtBack","AtFront"],AtBack:["AtBack",
0]};Wb.AtBack.toString=Bc;Wb.AtBack.__enum__=Wb;Wb.AtFront=["AtFront",1];Wb.AtFront.toString=Bc;Wb.AtFront.__enum__=Wb;var $c=function(){this.length=0};$c.__name__=!0;$c.__super__=Cc;$c.prototype=B(Cc.prototype,{__class__:$c});var Lc=function(){};Lc.__name__=!0;Lc.__super__=ud;Lc.prototype=B(ud.prototype,{firstKey:function(){var a=this.getFirstNode();return null!=a?a.key:null},lastKey:function(){var a=this.getLastNode();return null!=a?a.key:null},firstValue:function(){var a=this.getFirstNode();return null!=
a?a.value:null},lastValue:function(){var a=this.getLastNode();return null!=a?a.value:null},getFirstNode:function(){var a=this.root;if(null!=a)for(;null!=a.left;)a=a.left;return a},getLastNode:function(){var a=this.root;if(null!=a)for(;null!=a.right;)a=a.right;return a},__class__:Lc});var Md=function(a,b,c){this.signal=a;if(null==b)throw new m("Slot cannot be null");this.slot=b;this.times=c;this.blocked=!1;this.connected=!0;this.calledTimes=0};Md.__name__=!0;Md.prototype={__class__:Md};var fc=function(){this.slots=
new ad};fc.__name__=!0;fc.prototype={connect:function(a,b,c,d){null==b&&(b=La.Forever);this.updateConnection(a,b)||(a=new Md(this,a,b),this.slots.insert(a,c,d))},updateConnection:function(a,b,c,d){var e=this.slots.get(a);if(null==e)return!1;if(null!=c&&e.groupId!=c||null!=d)return this.slots.disconnect(a),!1;e.times=b;e.calledTimes=0;return e.connected=!0},loop:function(a){this.emitting=!0;for(var b=this.slots.groups.iterator();b.hasNext();)for(var c=b.next().h,d=null;null!=c;)if(d=void 0,d=c[0],
c=c[1],d.connected&&!d.blocked){d.calledTimes++;a(d);d.connected||this.slots.disconnect(d.slot);d.times==La.Once&&(d.times=La.Times(1));var e=d.times;switch(e[1]){case 1:e[2]<=d.calledTimes&&this.slots.disconnect(d.slot)}}this.emitting=!1},__class__:fc};var bd=function(){this.slots=new ad};bd.__name__=!0;bd.__super__=fc;bd.prototype=B(fc.prototype,{emit:function(a){this.loop(function(b){b.slot(a)})},__class__:bd});var gc=function(){this.slots=new ad};gc.__name__=!0;gc.__super__=fc;gc.prototype=B(fc.prototype,
{emit:function(a,b){this.loop(function(c){c.slot(a,b)})},__class__:gc});var ad=function(){this.clear()};ad.__name__=!0;ad.prototype={clear:function(){this.slots=new Kc;this.groups=new Lc;this.groups.set(0,new $c)},insert:function(a,b,c){null==c&&(c=Wb.AtBack);this.slots.set(a.slot,a);var d;if(null==b)if(null!=c)switch(c[1]){case 1:b=this.groups.firstKey();d=this.groups.firstValue();break;default:b=this.groups.lastKey(),d=this.groups.lastValue()}else b=this.groups.lastKey(),d=this.groups.lastValue();
else d=this.groups.get(b),null==d&&(d=new $c,this.groups.set(b,d));a.groupId=b;if(null!=c)switch(c[1]){case 1:d.push(a);break;default:d.add(a)}else d.add(a)},get:function(a){return this.slots.h[a.__id__]},disconnect:function(a){var b=this.slots.h[a.__id__];if(null==b)return!1;this.slots.remove(a);b.connected=!1;return!0},__class__:ad};var m=function(a){Error.call(this);this.val=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,m)};m.__name__=!0;m.__super__=Error;m.prototype=
B(Error.prototype,{__class__:m});var I=function(){};I.__name__=!0;I.getClass=function(a){if(a instanceof Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=I.__nativeClassName(a);return null!=a?I.__resolveNativeClass(a):null};I.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];c=a[0]+"(";
b+="\t";for(var d=2,e=a.length;d<e;)var l=d++,c=2!=l?c+(","+I.__string_rec(a[l],b)):c+I.__string_rec(a[l],b);return c+")"}c=a.length;d="[";b+="\t";for(e=0;e<c;)l=e++,d+=(0<l?",":"")+I.__string_rec(a[l],b);return d+"]"}try{d=a.toString}catch(f){return f instanceof m&&(f=f.val),"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c=null;d="{\n";b+="\t";e=null!=a.hasOwnProperty;for(c in a)e&&!a.hasOwnProperty(c)||"prototype"==c||"__class__"==c||"__super__"==
c||"__interfaces__"==c||"__properties__"==c||(2!=d.length&&(d+=", \n"),d+=b+c+" : "+I.__string_rec(a[c],b));b=b.substring(1);return d+("\n"+b+"}");case "function":return"<function>";case "string":return a;default:return String(a)}};I.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,e=c.length;d<e;){var l=d++,l=c[l];if(l==b||I.__interfLoop(l,b))return!0}return I.__interfLoop(a.__super__,b)};I.__instanceof=function(a,b){if(null==b)return!1;
switch(b){case He:return(a|0)===a;case ne:return"number"==typeof a;case oe:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case Ie:return!0;default:if(null!=a)if("function"==typeof b){if(a instanceof b||I.__interfLoop(I.getClass(a),b))return!0}else{if("object"==typeof b&&I.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==Je&&null!=a.__name__||b==Ke&&null!=a.__ename__?!0:a.__enum__==b}};I.__nativeClassName=function(a){a=
I.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};I.__isNativeObj=function(a){return null!=I.__nativeClassName(a)};I.__resolveNativeClass=function(a){return Fe[a]};var p=function(){};p.__name__=!0;var ga=function(){this.zpp_inner=null;if(!U.internal)throw new m("Error: Callback cannot be instantiated derp!");};ga.__name__=!0;ga.prototype={toString:function(){return""},__class__:ga};var Mc=function(){ga.call(this)};Mc.__name__=!0;Mc.__super__=ga;Mc.prototype=
B(ga.prototype,{toString:function(){var a;a="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.body.outer.toString();return a+=" : listener: "+wa.string(this.zpp_inner.listener.outer)},__class__:Mc});var Ma=function(){this.zpp_inner=null;if(!N.internal)throw new m("Error: Cannot instantiate Listener derp!");};Ma.__name__=!0;Ma.prototype={toString:function(){var a="BEGIN END WAKE SLEEP BREAK PRE ONGOING".split(" ")[this.zpp_inner.event];if(this.zpp_inner.type==f.id_ListenerType_BODY)return"BodyListener{"+
a+"::"+wa.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(this.zpp_inner.type==f.id_ListenerType_CONSTRAINT)return"ConstraintListener{"+a+"::"+wa.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var b=this.zpp_inner.interaction,c;switch(b.itype){case 1:c="COLLISION";break;case 2:c="SENSOR";break;case 4:c="FLUID";break;default:c="ALL"}return(this.zpp_inner.type==f.id_ListenerType_INTERACTION?"InteractionListener{"+a+"#"+c+"::"+wa.string(b.outer_zni.zpp_inner_zn.options1.outer)+
":"+wa.string(b.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+c+"::"+wa.string(b.outer_znp.zpp_inner_zn.options1.outer)+":"+wa.string(b.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},__class__:Ma};var Nd=function(){this.zpp_inner_zn=null};Nd.__name__=!0;Nd.__super__=Ma;Nd.prototype=B(Ma.prototype,{__class__:Nd});var Qa=function(){if(!f.internal)throw new m("Error: Cannot instantiate CbEvent derp!");};Qa.__name__=!0;Qa.prototype={toString:function(){null==
f.CbEvent_PRE&&(f.internal=!0,f.CbEvent_PRE=new Qa,f.internal=!1);var a;this==f.CbEvent_PRE?a="PRE":(null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Qa,f.internal=!1),this==f.CbEvent_BEGIN?a="BEGIN":(null==f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new Qa,f.internal=!1),this==f.CbEvent_ONGOING?a="ONGOING":(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Qa,f.internal=!1),this==f.CbEvent_END?a="END":(null==f.CbEvent_WAKE&&(f.internal=!0,f.CbEvent_WAKE=new Qa,f.internal=!1),
this==f.CbEvent_WAKE?a="WAKE":(null==f.CbEvent_SLEEP&&(f.internal=!0,f.CbEvent_SLEEP=new Qa,f.internal=!1),this==f.CbEvent_SLEEP?a="SLEEP":(null==f.CbEvent_BREAK&&(f.internal=!0,f.CbEvent_BREAK=new Qa,f.internal=!1),a=this==f.CbEvent_BREAK?"BREAK":""))))));return a},__class__:Qa};var ib=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!Ba.internal)throw new m("Error: Cannot instantiate CbTypeIterator derp!");};ib.__name__=!0;ib.get=function(a){var b;null==ib.zpp_pool?
(Ba.internal=!0,b=new ib,Ba.internal=!1):(b=ib.zpp_pool,ib.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};ib.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=ib.zpp_pool;ib.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:ib};var cd=function(){this.zpp_inner=null;this.zpp_inner=new Ba;
this.zpp_inner.outer=this};cd.__name__=!0;cd.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=
this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: CbTypeList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=
null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: CbTypeList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?
(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();
for(c=ib.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:cd};var Nc=function(){ga.call(this)};Nc.__name__=!0;Nc.__super__=ga;Nc.prototype=B(ga.prototype,{toString:function(){var a;a="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.constraint.outer.toString();return a+=" : listener: "+wa.string(this.zpp_inner.listener.outer)},__class__:Nc});var dd=function(){this.zpp_inner_zn=
null};dd.__name__=!0;dd.__super__=Ma;dd.prototype=B(Ma.prototype,{__class__:dd});var Oc=function(){ga.call(this)};Oc.__name__=!0;Oc.__super__=ga;Oc.prototype=B(ga.prototype,{toString:function(){var a;a="Cb:"+"BEGIN END     ONGOING".split(" ")[this.zpp_inner.event];a+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();a+=" : "+this.zpp_inner.wrap_arbiters.toString();return a+=" : listener: "+wa.string(this.zpp_inner.listener.outer)},__class__:Oc});var Ec=function(a,
b,c,d,e,l){null==l&&(l=0);this.zpp_inner_zn=null;N.internal=!0;Ma.call(this);N.internal=!1;if(null==e)throw new m("Error: InteractionListener::handler cannot be null");if(null==a)throw new m("Error: CbEvent cannot be null for InteractionListener");var h=-1;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Qa,f.internal=!1);if(a==f.CbEvent_BEGIN)h=f.id_CbEvent_BEGIN;else if(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Qa,f.internal=!1),a==f.CbEvent_END)h=f.id_CbEvent_END;else if(null==
f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new Qa,f.internal=!1),a==f.CbEvent_ONGOING)h=f.id_CbEvent_ONGOING;else throw new m("Error: CbEvent '"+a.toString()+"' is not a valid event type for InteractionListener");this.zpp_inner=this.zpp_inner_zn=new ca(tc.argument(c),tc.argument(d),h,f.id_ListenerType_INTERACTION);this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zni=this;this.zpp_inner.precedence=l;this.zpp_inner_zn.handleri=e;this.set_interactionType(b)};Ec.__name__=!0;Ec.__super__=Ma;
Ec.prototype=B(Ma.prototype,{get_interactionType:function(){var a=this.zpp_inner_zn.itype;return a==f.id_InteractionType_COLLISION?(null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new na,f.internal=!1),f.InteractionType_COLLISION):a==f.id_InteractionType_SENSOR?(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new na,f.internal=!1),f.InteractionType_SENSOR):a==f.id_InteractionType_FLUID?(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=
new na,f.internal=!1),f.InteractionType_FLUID):a==f.id_InteractionType_ANY?(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new na,f.internal=!1),f.InteractionType_ANY):null},set_interactionType:function(a){if(null==a)throw new m("Error: Cannot set listener interaction type to null");this.get_interactionType()!=a&&(null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new na,f.internal=!1),a==f.InteractionType_COLLISION?a=f.id_InteractionType_COLLISION:(null==
f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new na,f.internal=!1),a==f.InteractionType_SENSOR?a=f.id_InteractionType_SENSOR:(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new na,f.internal=!1),a=a==f.InteractionType_FLUID?f.id_InteractionType_FLUID:f.id_InteractionType_ANY)),this.zpp_inner_zn.itype=a);return this.get_interactionType()},__class__:Ec});var na=function(){if(!f.internal)throw new m("Error: Cannot instantiate InteractionType derp!");};na.__name__=
!0;na.prototype={toString:function(){null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new na,f.internal=!1);var a;this==f.InteractionType_COLLISION?a="COLLISION":(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new na,f.internal=!1),this==f.InteractionType_SENSOR?a="SENSOR":(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new na,f.internal=!1),this==f.InteractionType_FLUID?a="FLUID":(null==f.InteractionType_ANY&&(f.internal=
!0,f.InteractionType_ANY=new na,f.internal=!1),a=this==f.InteractionType_ANY?"ANY":"")));return a},__class__:na};var Sa=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!Xb.internal)throw new m("Error: Cannot instantiate ListenerIterator derp!");};Sa.__name__=!0;Sa.get=function(a){var b;null==Sa.zpp_pool?(Xb.internal=!0,b=new Sa,Xb.internal=!1):(b=Sa.zpp_pool,Sa.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Sa.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Sa.zpp_pool;Sa.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Sa};var ed=function(){this.zpp_inner=null;this.zpp_inner=new Xb;this.zpp_inner.outer=this};ed.__name__=!0;ed.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: ListenerList is immutable");
this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);
return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: ListenerList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),
this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){if(this.zpp_inner.immutable)throw new m("Error: ListenerList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||
this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Sa.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ed};var fd=function(a,b){this.zpp_inner=null;this.zpp_inner=new tc;this.zpp_inner.outer=this;null!=a&&this.including(a);null!=b&&this.excluding(b)};fd.__name__=!0;fd.prototype={including:function(a){this.zpp_inner.append(this.zpp_inner.includes,
a);return this},excluding:function(a){this.zpp_inner.append(this.zpp_inner.excludes,a);return this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var a=this.zpp_inner.wrap_includes.toString();null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes();return"@{"+a+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},__class__:fd};var Pc=function(){ga.call(this)};Pc.__name__=!0;Pc.__super__=ga;Pc.prototype=B(ga.prototype,{toString:function(){var a;
a="Cb:PRE:"+(":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString());a+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString();return a+=" : listnener: "+wa.string(this.zpp_inner.listener.outer)},__class__:Pc});var Ca=function(){if(!f.internal)throw new m("Error: Cannot instantiate PreFlag derp!");};Ca.__name__=!0;Ca.prototype={toString:function(){null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);var a;this==f.PreFlag_ACCEPT?a="ACCEPT":(null==
f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1),this==f.PreFlag_IGNORE?a="IGNORE":(null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1),this==f.PreFlag_ACCEPT_ONCE?a="ACCEPT_ONCE":(null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new Ca,f.internal=!1),a=this==f.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")));return a},__class__:Ca};var Od=function(){this.zpp_inner_zn=null};Od.__name__=!0;Od.__super__=Ma;Od.prototype=B(Ma.prototype,
{__class__:Od});var ya=function(){this.zpp_inner.insert_cbtype(ba.ANY_CONSTRAINT.zpp_inner);if(!ya.zpp_internalAlloc)throw new m("Error: Constraint cannot be instantiated derp!");};ya.__name__=!0;ya.prototype={set_compound:function(a){(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=a&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=a&&a.zpp_inner.wrap_constraints.add(this));
return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_ignore:function(a){this.zpp_inner.ignore!=a&&(this.zpp_inner.ignore=a,this.zpp_inner.wake());return this.zpp_inner.ignore},set_stiff:function(a){this.zpp_inner.stiff!=a&&(this.zpp_inner.stiff=a,this.zpp_inner.wake());return this.zpp_inner.stiff},set_damping:function(a){if(a!=a)throw new m("Error: Constraint::Damping cannot be Nan");if(0>a)throw new m("Error: Constraint::Damping must be >=0");this.zpp_inner.damping!=a&&(this.zpp_inner.damping=
a,this.zpp_inner.stiff||this.zpp_inner.wake());return this.zpp_inner.damping},toString:function(){return"{Constraint}"},__class__:ya};var Jb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!Da.internal)throw new m("Error: Cannot instantiate ConstraintIterator derp!");};Jb.__name__=!0;Jb.get=function(a){var b;null==Jb.zpp_pool?(Da.internal=!0,b=new Jb,Da.internal=!1):(b=Jb.zpp_pool,Jb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Jb.prototype=
{hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Jb.zpp_pool;Jb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Jb};var Pd=function(){this.zpp_inner=null;this.zpp_inner=new Da;this.zpp_inner.outer=this};Pd.__name__=!0;Pd.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=
!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;
return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: ConstraintList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,
a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: ConstraintList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){if(this.zpp_inner.immutable)throw new m("Error: ConstraintList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=
c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Jb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Pd};var Zc=function(a,b,c,d){this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=
new Qc;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;ya.zpp_internalAlloc=!0;ya.call(this);ya.zpp_internalAlloc=!1;this.set_body1(a);this.set_body2(b);if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null==c)throw new m("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1.set(c);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1;
if(null!=d&&d.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null==d)throw new m("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2.set(d);null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2};Zc.__name__=!0;Zc.__super__=ya;Zc.prototype=B(ya.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;
a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=
a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");a=null==a?null:a.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&
null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));
return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor2:function(){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();return this.zpp_inner_zn.wrap_a2},__class__:Zc});var Hc=function(a,b,c,d,e){null==e&&(e=0);this.zpp_inner_zn=null;this.zpp_inner=this.zpp_inner_zn=new uc;this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zn=this;ya.zpp_internalAlloc=!0;ya.call(this);ya.zpp_internalAlloc=!1;this.set_body1(a);this.set_body2(b);if(null!=c&&c.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
if(null==c)throw new m("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1.set(c);null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();this.zpp_inner_zn.wrap_a1;if(null!=d&&d.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null==d)throw new m("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2.set(d);
null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();this.zpp_inner_zn.wrap_a2;this.zpp_inner.immutable_midstep("WeldJoint::phase");if(e!=e)throw new m("Error: WeldJoint::phase cannot be NaN");this.zpp_inner_zn.phase!=e&&(this.zpp_inner_zn.phase=e,this.zpp_inner.wake());this.zpp_inner_zn.phase};Hc.__name__=!0;Hc.__super__=ya;Hc.prototype=B(ya.prototype,{set_body1:function(a){this.zpp_inner.immutable_midstep("Constraint::body1");a=null==a?null:a.zpp_inner;a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&
(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&
null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body2:function(a){this.zpp_inner.immutable_midstep("Constraint::body2");a=null==a?null:a.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),
this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor2:function(){null==
this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();return this.zpp_inner_zn.wrap_a2},__class__:Hc});var Ta=function(){this.zpp_inner=null;if(!z.internal)throw new m("Error: Cannot instantiate Arbiter derp!");};Ta.__name__=!0;Ta.prototype={get_state:function(){if(!this.zpp_inner.active)throw new m("Error: Arbiter not currently in use");var a=this.zpp_inner.immState;if(a==(f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS))return null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=
!1),f.PreFlag_ACCEPT;switch(a){case 1:return null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1),f.PreFlag_ACCEPT_ONCE;default:if(a==(f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS))return null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1),f.PreFlag_IGNORE;null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new Ca,f.internal=!1);return f.PreFlag_IGNORE_ONCE}},toString:function(){var a;a=this.zpp_inner.type==z.COL?"CollisionArbiter":
this.zpp_inner.type==z.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)a+="(object-pooled)";else{a+="(";if(!this.zpp_inner.active)throw new m("Error: Arbiter not currently in use");a=a+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|";if(!this.zpp_inner.active)throw new m("Error: Arbiter not currently in use");a=a+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")"+
(this.zpp_inner.type==z.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-"+this.get_state().toString()}return a},__class__:Ta};var Kb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!V.internal)throw new m("Error: Cannot instantiate ArbiterIterator derp!");};Kb.__name__=!0;Kb.get=function(a){var b;null==Kb.zpp_pool?(V.internal=!0,b=new Kb,V.internal=!1):(b=Kb.zpp_pool,Kb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Kb.prototype=
{hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Kb.zpp_pool;Kb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Kb};var Qd=function(){this.zpp_inner=null;this.zpp_inner=new V;this.zpp_inner.outer=this};Qd.__name__=!0;Qd.prototype={zpp_gl:function(){this.zpp_inner.valmod();if(this.zpp_inner.zip_length){this.zpp_inner.zip_length=
!1;this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.head;null!=a;)a.elt.active&&this.zpp_inner.user_length++,a=a.next}return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();if(0>a||a>=this.zpp_gl())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=
this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=a;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},iterator:function(){this.zpp_vm();return Kb.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+
"]"},__class__:Qd};var gd=function(){if(!z.internal)throw new m("Error: Cannot instantiate CollisionArbiter derp!");Ta.call(this)};gd.__name__=!0;gd.__super__=Ta;gd.prototype=B(Ta.prototype,{__class__:gd});var he=function(){this.zpp_inner=null;if(!M.internal)throw new m("Error: Cannot instantiate Contact derp!");};he.__name__=!0;he.prototype={toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:he};var hd=function(){if(!z.internal)throw new m("Error: Cannot instantiate FluidArbiter derp!");
Ta.call(this)};hd.__name__=!0;hd.__super__=Ta;hd.prototype=B(Ta.prototype,{__class__:hd});var wd=function(a,b,c,d,e,l){null==l&&(l=-1);null==e&&(e=1);null==d&&(d=-1);null==c&&(c=1);null==b&&(b=-1);null==a&&(a=1);this.zpp_inner=null;null==ia.zpp_pool?this.zpp_inner=new ia:(this.zpp_inner=ia.zpp_pool,ia.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=this;this.zpp_inner.collisionGroup!=a&&(this.zpp_inner.collisionGroup=a,this.zpp_inner.invalidate());this.zpp_inner.collisionGroup;
this.zpp_inner.collisionMask!=b&&(this.zpp_inner.collisionMask=b,this.zpp_inner.invalidate());this.zpp_inner.collisionMask;this.zpp_inner.sensorGroup!=c&&(this.zpp_inner.sensorGroup=c,this.zpp_inner.invalidate());this.zpp_inner.sensorGroup;this.zpp_inner.sensorMask!=d&&(this.zpp_inner.sensorMask=d,this.zpp_inner.invalidate());this.zpp_inner.sensorMask;this.zpp_inner.fluidGroup!=e&&(this.zpp_inner.fluidGroup=e,this.zpp_inner.invalidate());this.zpp_inner.fluidGroup;this.zpp_inner.fluidMask!=l&&(this.zpp_inner.fluidMask=
l,this.zpp_inner.invalidate());this.zpp_inner.fluidMask};wd.__name__=!0;wd.prototype={__class__:wd};var Kd=function(a){null==a&&(a=!1);this.zpp_inner=null;this.zpp_inner=new Rd;this.zpp_inner.outer=this;this.zpp_inner.ignore!=a&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=a);this.zpp_inner.ignore};Kd.__name__=!0;Kd.prototype={toString:function(){var a="InteractionGroup";this.zpp_inner.ignore&&(a+=":ignore");return a},__class__:Kd};var Sd=function(){this.zpp_inner=null};Sd.__name__=!0;Sd.prototype=
{toString:function(){var a="GeomPoly[",b=this.zpp_inner.vertices,c=this.zpp_inner.vertices;if(null!=b){do{var d=b;d!=this.zpp_inner.vertices&&(a+=",");a+="{"+d.x+","+d.y+"}";b=b.next}while(b!=c)}return a+"]"},__class__:Sd};var E=function(a,b){null==b&&(b=0);null==a&&(a=0);this.zpp_inner=this.zpp_pool=null;if(a!=a||b!=b)throw new m("Error: Vec2 components cannot be NaN");this.zpp_inner=D.get(a,b,null);this.zpp_inner.outer=this};E.__name__=!0;E.get=function(a,b,c){null==c&&(c=!1);null==b&&(b=0);null==
a&&(a=0);if(a!=a||b!=b)throw new m("Error: Vec2 components cannot be NaN");var d;null==Ua.poolVec2?d=new E:(d=Ua.poolVec2,Ua.poolVec2=d.zpp_pool,d.zpp_pool=null,d.zpp_disp=!1,d==Ua.nextVec2&&(Ua.nextVec2=null));if(null==d.zpp_inner)d.zpp_inner=D.get(a,b,null),d.zpp_inner.outer=d;else{if(null!=d&&d.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");d.zpp_inner.immutable();if(a!=a||b!=b)throw new m("Error: Vec2 components cannot be NaN");if(null!=d&&d.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
d.zpp_inner.validate();var e;if(!(e=d.zpp_inner.x!=a)){if(null!=d&&d.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");d.zpp_inner.validate();e=d.zpp_inner.y!=b}e&&(d.zpp_inner.x=a,d.zpp_inner.y=b,d.zpp_inner.invalidate());d}d.zpp_inner.weak=c;return d};E.prototype={dispose:function(){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.immutable();if(this.zpp_inner._inuse)throw new m("Error: This Vec2 is not disposable");var a=this.zpp_inner;
this.zpp_pool=this.zpp_inner=this.zpp_inner.outer=null;null!=Ua.nextVec2?Ua.nextVec2.zpp_pool=this:Ua.poolVec2=this;Ua.nextVec2=this;this.zpp_disp=!0;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=D.zpp_pool;D.zpp_pool=a},get_x:function(){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();return this.zpp_inner.x},set_x:function(a){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
this.zpp_inner.immutable();if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();if(this.zpp_inner.x!=a){if(a!=a)throw new m("Error: Vec2::x cannot be NaN");this.zpp_inner.x=a;this.zpp_inner.invalidate()}if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();return this.zpp_inner.x},get_y:function(){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();
return this.zpp_inner.y},set_y:function(a){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.immutable();if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();if(this.zpp_inner.y!=a){if(a!=a)throw new m("Error: Vec2::y cannot be NaN");this.zpp_inner.y=a;this.zpp_inner.invalidate()}if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();return this.zpp_inner.y},
lsq:function(){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();var a=this.zpp_inner.x;if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();a*=this.zpp_inner.x;if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();var b=this.zpp_inner.y;if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
this.zpp_inner.validate();return a+b*this.zpp_inner.y},set:function(a){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.immutable();if(null==a)throw new m("Error: Cannot assign null Vec2");var b=this.setxy(function(b){if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.x}(this),function(b){if(null!=
a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.y}(this));a.zpp_inner.weak?(a.dispose(),!0):!1;return b},setxy:function(a,b){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.immutable();if(a!=a||b!=b)throw new m("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();var c;if(!(c=this.zpp_inner.x!=
a)){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();c=this.zpp_inner.y!=b}c&&(this.zpp_inner.x=a,this.zpp_inner.y=b,this.zpp_inner.invalidate());return this},mul:function(a,b){null==b&&(b=!1);if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(a!=a)throw new m("Error: Cannot multiply with NaN");return E.get(function(a){if(a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();
return a.zpp_inner.x}(this)*a,function(a){if(a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.y}(this)*a,b)},toString:function(){if(this.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner.validate();return this.zpp_inner.toString()},__class__:E};var Va=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!Yb.internal)throw new m("Error: Cannot instantiate Vec2Iterator derp!");
};Va.__name__=!0;Va.get=function(a){var b;null==Va.zpp_pool?(Yb.internal=!0,b=new Va,Yb.internal=!1):(b=Va.zpp_pool,Va.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Va.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Va.zpp_pool;Va.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Va};var Zb=
function(){this.zpp_inner=null;this.zpp_inner=new Yb;this.zpp_inner.outer=this};Zb.__name__=!0;Zb.prototype={zpp_gl:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();if(0>a||a>=this.zpp_gl())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||
null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: Vec2List is immutable");this.zpp_inner.modify_test();this.zpp_vm();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):
(null==this.zpp_inner.push_ite&&(this.empty()?this.zpp_inner.push_ite=null:this.zpp_inner.push_ite=this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},empty:function(){return 0==this.zpp_gl()},iterator:function(){this.zpp_vm();return Va.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;
c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Zb};var O=function(){this.zpp_inner_i=null;if(!O.zpp_internalAlloc)throw new m("Error: Cannot instantiate an Interactor, only Shape/Body/Compound");};O.__name__=!0;O.prototype={get_userData:function(){null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={});return this.zpp_inner_i.userData},get_group:function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},
set_group:function(a){this.zpp_inner_i.immutable_midstep("Interactor::group");this.zpp_inner_i.setGroup(null==a?null:a.zpp_inner);return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},get_cbTypes:function(){null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes();return this.zpp_inner_i.wrap_cbTypes},toString:function(){return""},__class__:O};var Vb=function(a,b){this.zpp_inner=null;O.zpp_internalAlloc=!0;O.call(this);O.zpp_internalAlloc=!1;this.zpp_inner=new kb;this.zpp_inner.outer=
this;this.zpp_inner.outer_i=this;this.zpp_inner_i=this.zpp_inner;if(null!=b){if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();this.zpp_inner.posx=b.zpp_inner.x;if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();this.zpp_inner.posy=b.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=
0;this.set_type(null==a?function(a){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1);return f.BodyType_DYNAMIC}(this):a);null!=b&&(b.zpp_inner.weak?(b.dispose(),!0):!1);this.zpp_inner_i.insert_cbtype(ba.ANY_BODY.zpp_inner)};Vb.__name__=!0;Vb.__super__=O;Vb.prototype=B(O.prototype,{set_type:function(a){this.zpp_inner.immutable_midstep("Body::type");if(this.zpp_inner.world)throw new m("Error: Space::world is immutable");if(kb.types[this.zpp_inner.type]!=a){if(null==a)throw new m("Error: Cannot use null BodyType");
null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1);a==f.BodyType_DYNAMIC?a=f.id_BodyType_DYNAMIC:(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new T,f.internal=!1),a=a==f.BodyType_KINEMATIC?f.id_BodyType_KINEMATIC:f.id_BodyType_STATIC);a==f.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0);this.zpp_inner.invalidate_type();null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,
a):this.zpp_inner.type=a}return kb.types[this.zpp_inner.type]},set_compound:function(a){(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=a&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=a&&a.zpp_inner.wrap_bodies.add(this));return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_position:function(){null==this.zpp_inner.wrap_pos&&
this.zpp_inner.setupPosition();return this.zpp_inner.wrap_pos},get_velocity:function(){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();return this.zpp_inner.wrap_vel},applyImpulse:function(a,b,c){null==c&&(c=!1);if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner.world)throw new m("Error: Space::world is immutable");if(null==a)throw new m("Error: Cannot apply null impulse to Body");
var d;if(d=c){if(null==this.zpp_inner.space)throw new m("Error: isSleeping makes no sense if the object is not contained within a Space");d=this.zpp_inner.component.sleeping}if(d)return a.zpp_inner.weak?(a.dispose(),!0):!1,null!=b&&(b.zpp_inner.weak?(b.dispose(),!0):!1),this;this.zpp_inner.validate_mass();d=this.zpp_inner.imass;var e=this.zpp_inner,l=this.zpp_inner.velx;if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();e.velx=l+a.zpp_inner.x*
d;e=this.zpp_inner;l=this.zpp_inner.vely;if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();e.vely=l+a.zpp_inner.y*d;if(null!=b){var h=0;d=0;if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();h=b.zpp_inner.x-this.zpp_inner.posx;if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();d=b.zpp_inner.y-this.zpp_inner.posy;this.zpp_inner.validate_inertia();
e=this.zpp_inner;l=this.zpp_inner.angvel;if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();h*=a.zpp_inner.y;if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();e.angvel=l+(h-a.zpp_inner.x*d)*this.zpp_inner.iinertia;b.zpp_inner.weak?(b.dispose(),!0):!1}c||this.zpp_inner.type==f.id_BodyType_DYNAMIC&&this.zpp_inner.wake();a.zpp_inner.weak?(a.dispose(),!0):!1;return this},translateShapes:function(a){this.zpp_inner.immutable_midstep("Body::translateShapes()");
if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner.world)throw new m("Error: Space::world is immutable");if(null==a)throw new m("Error: Cannot displace by null Vec2");var b=a.zpp_inner.weak;a.zpp_inner.weak=!1;for(var c=this.zpp_inner.shapes.head;null!=c;)c.elt.outer.translate(a),c=c.next;a.zpp_inner.weak=b;a.zpp_inner.weak?(a.dispose(),!0):!1;return this},setShapeMaterials:function(a){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");
if(this.zpp_inner.world)throw new m("Error: Space::world is immutable");for(var b=this.zpp_inner.shapes.head;null!=b;)b.elt.outer.set_material(a),b=b.next;return this},toString:function(){return(this.zpp_inner.world?"(space::world":"("+(this.zpp_inner.type==f.id_BodyType_DYNAMIC?"dynamic":this.zpp_inner.type==f.id_BodyType_STATIC?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:Vb});var Lb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!ja.internal)throw new m("Error: Cannot instantiate BodyIterator derp!");
};Lb.__name__=!0;Lb.get=function(a){var b;null==Lb.zpp_pool?(ja.internal=!0,b=new Lb,ja.internal=!1):(b=Lb.zpp_pool,Lb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Lb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Lb.zpp_pool;Lb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Lb};
var id=function(){this.zpp_inner=null;this.zpp_inner=new ja;this.zpp_inner.outer=this};id.__name__=!0;id.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||
null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: BodyList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):
(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: BodyList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=
this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?
this.push(a):this.unshift(a)},remove:function(a){if(this.zpp_inner.immutable)throw new m("Error: BodyList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=
Lb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:id};var T=function(){if(!f.internal)throw new m("Error: Cannot instantiate BodyType derp!");};T.__name__=!0;T.prototype={toString:function(){null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new T,f.internal=!1);var a;this==f.BodyType_STATIC?a="STATIC":(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1),this==
f.BodyType_DYNAMIC?a="DYNAMIC":(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new T,f.internal=!1),a=this==f.BodyType_KINEMATIC?"KINEMATIC":""));return a},__class__:T};var Yc=function(){this.zpp_inner=null;O.zpp_internalAlloc=!0;O.call(this);O.zpp_internalAlloc=!1;this.zpp_inner=new xd;this.zpp_inner.outer=this;this.zpp_inner.outer_i=this;this.zpp_inner_i=this.zpp_inner;this.zpp_inner.insert_cbtype(ba.ANY_COMPOUND.zpp_inner)};Yc.__name__=!0;Yc.__super__=O;Yc.prototype=B(O.prototype,
{set_space:function(a){if(null!=this.zpp_inner.compound)throw new m("Error: Cannot set the space of an inner Compound, only the root Compound space can be set");this.zpp_inner.immutable_midstep("Compound::space");(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=a&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=a&&a.zpp_inner.wrap_compounds.add(this));return null==
this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){return"Compound"+this.zpp_inner_i.id},__class__:Yc});var Wa=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!qa.internal)throw new m("Error: Cannot instantiate CompoundIterator derp!");};Wa.__name__=!0;Wa.get=function(a){var b;null==Wa.zpp_pool?(qa.internal=!0,b=new Wa,qa.internal=!1):(b=Wa.zpp_pool,Wa.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Wa.prototype=
{hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Wa.zpp_pool;Wa.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Wa};var Td=function(){this.zpp_inner=null;this.zpp_inner=new qa;this.zpp_inner.outer=this};Td.__name__=!0;Td.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=
!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;
return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: CompoundList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,
a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: CompoundList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){if(this.zpp_inner.immutable)throw new m("Error: CompoundList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=
c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Wa.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Td};var sc=function(a,b,c,d,e){null==e&&(e=.001);null==d&&(d=1);null==
c&&(c=2);null==b&&(b=1);null==a&&(a=0);this.zpp_inner=null;null==C.zpp_pool?this.zpp_inner=new C:(this.zpp_inner=C.zpp_pool,C.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=this;if(a!=this.zpp_inner.elasticity){if(a!=a)throw new m("Error: Material::elasticity cannot be NaN");this.zpp_inner.elasticity=a/1;this.zpp_inner.invalidate(C.WAKE|C.ARBITERS)}this.zpp_inner.elasticity;if(b!=this.zpp_inner.dynamicFriction){if(b!=b)throw new m("Error: Material::dynamicFriction cannot be NaN");
if(0>b)throw new m("Error: Material::dynamicFriction cannot be negative");this.zpp_inner.dynamicFriction=b/1;this.zpp_inner.invalidate(C.WAKE|C.ANGDRAG|C.ARBITERS)}this.zpp_inner.dynamicFriction;if(c!=this.zpp_inner.staticFriction){if(c!=c)throw new m("Error: Material::staticFriction cannot be NaN");if(0>c)throw new m("Error: Material::staticFriction cannot be negative");this.zpp_inner.staticFriction=c/1;this.zpp_inner.invalidate(C.WAKE|C.ARBITERS)}this.zpp_inner.staticFriction;if(d!=1E3*this.zpp_inner.density){if(d!=
d)throw new m("Error: Material::density cannot be NaN");if(0>d)throw new m("Error: Material::density must be positive");if(0>d)throw new m("Error: Material::density cannot be negative");this.zpp_inner.density=d/1E3;this.zpp_inner.invalidate(C.WAKE|C.PROPS)}1E3*this.zpp_inner.density;if(e!=this.zpp_inner.rollingFriction){if(e!=e)throw new m("Error: Material::rollingFriction cannot be NaN");if(0>e)throw new m("Error: Material::rollingFriction cannot be negative");this.zpp_inner.rollingFriction=e/1;
this.zpp_inner.invalidate(C.WAKE|C.ARBITERS)}this.zpp_inner.rollingFriction};sc.__name__=!0;sc.prototype={toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1E3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:sc};var da=function(){this.zpp_inner=null;O.zpp_internalAlloc=!0;O.call(this);O.zpp_internalAlloc=!1;if(!da.zpp_internalAlloc)throw new m("Error: Shape cannot be instantiated derp!");
};da.__name__=!0;da.__super__=O;da.prototype=B(O.prototype,{get_castPolygon:function(){return this.zpp_inner.type==f.id_ShapeType_POLYGON?this.zpp_inner.polygon.outer_zn:null},set_material:function(a){this.zpp_inner.immutable_midstep("Shape::material");if(null==a)throw new m("Error: Cannot assign null as Shape material");this.zpp_inner.setMaterial(a.zpp_inner);return this.zpp_inner.material.wrapper()},translate:function(a){this.zpp_inner.immutable_midstep("Shape::translate()");if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
if(null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&this.zpp_inner.body.type==f.id_BodyType_STATIC)throw new m("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(null==a)throw new m("Error: Cannot displace Shape by null Vec2");0<a.lsq()&&(this.zpp_inner.type==f.id_ShapeType_CIRCLE?this.zpp_inner.circle.__translate(function(b){if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.x}(this),
function(b){if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.y}(this)):this.zpp_inner.polygon.__translate(function(b){if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.x}(this),function(b){if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");a.zpp_inner.validate();return a.zpp_inner.y}(this)));a.zpp_inner.weak?
(a.dispose(),!0):!1;return this},toString:function(){return(this.zpp_inner.type==f.id_ShapeType_CIRCLE?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},__class__:da});var Ic=function(a,b,c,d){this.zpp_inner_zn=null;da.zpp_internalAlloc=!0;da.call(this);da.zpp_internalAlloc=!1;this.zpp_inner_zn=new yd;this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=this;this.zpp_inner.immutable_midstep("Circle::radius");if(null!=this.zpp_inner.body&&
this.zpp_inner.body.type==f.id_BodyType_STATIC&&null!=this.zpp_inner.body.space)throw new m("Error: Cannot modifiy radius of Circle contained in static object once added to space");if(a!=this.zpp_inner_zn.radius){if(a!=a)throw new m("Error: Circle::radius cannot be NaN");if(a<p.epsilon)throw new m("Error: Circle::radius ("+a+") must be > Config.epsilon");if(1E100<a)throw new m("Error: Circle::radius ("+a+") must be < PR(Const).FMAX");this.zpp_inner_zn.radius=a;this.zpp_inner_zn.invalidate_radius()}this.zpp_inner_zn.radius;
if(null==b)this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0;else{if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();this.zpp_inner.localCOMx=b.zpp_inner.x;if(null!=b&&b.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");b.zpp_inner.validate();this.zpp_inner.localCOMy=b.zpp_inner.y;b.zpp_inner.weak?(b.dispose(),!0):!1}if(null==
c)null==C.zpp_pool?this.zpp_inner.material=new C:(this.zpp_inner.material=C.zpp_pool,C.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null),null;else{this.zpp_inner.immutable_midstep("Shape::material");if(null==c)throw new m("Error: Cannot assign null as Shape material");this.zpp_inner.setMaterial(c.zpp_inner);this.zpp_inner.material.wrapper()}if(null==d)null==ia.zpp_pool?this.zpp_inner.filter=new ia:(this.zpp_inner.filter=ia.zpp_pool,ia.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=
null),null;else{this.zpp_inner.immutable_midstep("Shape::filter");if(null==d)throw new m("Error: Cannot assign null as Shape filter");this.zpp_inner.setFilter(d.zpp_inner);this.zpp_inner.filter.wrapper()}this.zpp_inner_i.insert_cbtype(ba.ANY_SHAPE.zpp_inner)};Ic.__name__=!0;Ic.__super__=da;Ic.prototype=B(da.prototype,{__class__:Ic});var Ud=function(){this.zpp_inner=null;if(!A.internal)throw new m("Error: Cannot instantiate an Edge derp!");};Ud.__name__=!0;Ud.prototype={toString:function(){if(null==
this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : "+("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" }";this.zpp_inner.polygon.validate_gaxi();return"{ localNormal : "+("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" worldNormal : "+("{ x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" }")+" }"},__class__:Ud};var hc=function(a,b,c){this.zpp_inner_zn=null;
da.zpp_internalAlloc=!0;da.call(this);da.zpp_internalAlloc=!1;if(null==a)throw new m("Error: localVerts cannot be null");this.zpp_inner_zn=new zd;this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=this;if(a instanceof Array&&null==a.__enum__)for(var d=0;d<a.length;){var e=a[d];++d;if(null==e)throw new m("Error: Array<Vec2> contains null objects");if(!I.__instanceof(e,E))throw new m("Error: Array<Vec2> contains non Vec2 objects");
var l=e;if(null!=l&&l.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(function(a){if(null!=l&&l.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");return E.get(function(a){if(null!=l&&l.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");l.zpp_inner.validate();return l.zpp_inner.x}(a),function(a){if(null!=l&&l.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
l.zpp_inner.validate();return l.zpp_inner.y}(a),!1)}(this))}else if(I.__instanceof(a,Zb))for(d=a.iterator();d.hasNext();){var f;d.zpp_critical=!1;f=d.zpp_inner.at(d.zpp_i++);if(null==f)throw new m("Error: Vec2List contains null objects");if(null!=f&&f.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(function(a){if(null!=f&&f.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");
return E.get(function(a){if(null!=f&&f.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");f.zpp_inner.validate();return f.zpp_inner.x}(a),function(a){if(null!=f&&f.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");f.zpp_inner.validate();return f.zpp_inner.y}(a),!1)}(this))}else if(I.__instanceof(a,Sd)){if(null!=a&&a.zpp_disp)throw new m("Error: GeomPoly has been disposed and cannot be used!");d=a.zpp_inner.vertices;if(null!=d){e=d;do{var g=E.get(e.x,
e.y,null),e=e.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(function(a){if(null!=g&&g.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");return E.get(function(a){if(null!=g&&g.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");g.zpp_inner.validate();return g.zpp_inner.x}(a),function(a){if(null!=g&&g.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");g.zpp_inner.validate();
return g.zpp_inner.y}(a),!1)}(this));g.dispose()}while(e!=d)}}else throw new m("Error: Invalid type for polygon object, should be Array<Vec2>, Vec2List, GeomPoly or for flash10+ flash.Vector<Vec2>");if(a instanceof Array&&null==a.__enum__)for(d=0;d<a.length;){var e=a[d],k;if(k=e.zpp_inner.weak)e.dispose(),k=!0;k?a.splice(d,1):d++}else if(I.__instanceof(a,Zb))for(null!=a.zpp_inner._validate&&a.zpp_inner._validate(),a=a.zpp_inner.inner,d=null,e=a.head;null!=e;)k=e.elt,k.outer.zpp_inner.weak?(e=a.erase(d),
k.outer.zpp_inner.weak?(k.outer.dispose(),!0):!1):(d=e,e=e.next);if(null==b)null==C.zpp_pool?this.zpp_inner.material=new C:(this.zpp_inner.material=C.zpp_pool,C.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null),null;else{this.zpp_inner.immutable_midstep("Shape::material");if(null==b)throw new m("Error: Cannot assign null as Shape material");this.zpp_inner.setMaterial(b.zpp_inner);this.zpp_inner.material.wrapper()}if(null==c)null==ia.zpp_pool?this.zpp_inner.filter=new ia:(this.zpp_inner.filter=
ia.zpp_pool,ia.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null),null;else{this.zpp_inner.immutable_midstep("Shape::filter");if(null==c)throw new m("Error: Cannot assign null as Shape filter");this.zpp_inner.setFilter(c.zpp_inner);this.zpp_inner.filter.wrapper()}this.zpp_inner_i.insert_cbtype(ba.ANY_SHAPE.zpp_inner)};hc.__name__=!0;hc.rect=function(a,b,c,d,e){null==e&&(e=!1);if(a!=a||b!=b||c!=c||d!=d)throw new m("Error: Polygon.rect cannot accept NaN arguments");return[E.get(a,
b,e),E.get(a+c,b,e),E.get(a+c,b+d,e),E.get(a,b+d,e)]};hc.__super__=da;hc.prototype=B(da.prototype,{get_worldVerts:function(){null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts();return this.zpp_inner_zn.wrap_gverts},__class__:hc});var Xa=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null;if(!lb.internal)throw new m("Error: Cannot instantiate ShapeIterator derp!");};Xa.__name__=!0;Xa.get=function(a){var b;null==Xa.zpp_pool?(lb.internal=!0,b=new Xa,lb.internal=
!1):(b=Xa.zpp_pool,Xa.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Xa.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Xa.zpp_pool;Xa.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Xa};var Vd=function(){this.zpp_inner=null;this.zpp_inner=new lb;this.zpp_inner.outer=this};Vd.__name__=
!0;Vd.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();if(0>a||a>=this.get_length())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);
else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){if(this.zpp_inner.immutable)throw new m("Error: ShapeList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?
null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){if(this.zpp_inner.immutable)throw new m("Error: ShapeList is immutable");this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&
(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){if(this.zpp_inner.immutable)throw new m("Error: ShapeList is immutable");
this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Xa.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();
b=!1}return a+"]"},__class__:Vd};var J=function(){if(!f.internal)throw new m("Error: Cannot instantiate ValidationResult derp!");};J.__name__=!0;J.prototype={toString:function(){null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=new J,f.internal=!1);var a;this==f.ValidationResult_VALID?a="VALID":(null==f.ValidationResult_DEGENERATE&&(f.internal=!0,f.ValidationResult_DEGENERATE=new J,f.internal=!1),this==f.ValidationResult_DEGENERATE?a="DEGENERATE":(null==f.ValidationResult_CONCAVE&&
(f.internal=!0,f.ValidationResult_CONCAVE=new J,f.internal=!1),this==f.ValidationResult_CONCAVE?a="CONCAVE":(null==f.ValidationResult_SELF_INTERSECTING&&(f.internal=!0,f.ValidationResult_SELF_INTERSECTING=new J,f.internal=!1),a=this==f.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")));return a},__class__:J};var ic=function(){if(!f.internal)throw new m("Error: Cannot instantiate Broadphase derp!");};ic.__name__=!0;ic.prototype={toString:function(){null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=
!0,f.Broadphase_DYNAMIC_AABB_TREE=new ic,f.internal=!1);var a;this==f.Broadphase_DYNAMIC_AABB_TREE?a="DYNAMIC_AABB_TREE":(null==f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new ic,f.internal=!1),a=this==f.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"");return a},__class__:ic};var Dc=function(a,b){this.zpp_inner=null;if(null!=a&&a.zpp_disp)throw new m("Error: Vec2 has been disposed and cannot be used!");this.zpp_inner=new Wd(null==a?null:a.zpp_inner,b);this.zpp_inner.outer=
this;null!=a&&(a.zpp_inner.weak?(a.dispose(),!0):!1)};Dc.__name__=!0;Dc.prototype={step:function(a,b,c){null==c&&(c=10);null==b&&(b=10);if(a!=a)throw new m("Error: deltaTime cannot be NaN");if(0>=a)throw new m("Error: deltaTime must be strictly positive");if(0>=b)throw new m("Error: must use atleast one velocity iteration");if(0>=c)throw new m("Error: must use atleast one position iteration");this.zpp_inner.step(a,b,c)},__class__:Dc};var rc=function(){};rc.__name__=!0;rc.createBox=function(a,b,c,
d,e){a=new Vb(a);a.zpp_inner.wrap_shapes.add(new hc(hc.rect(0,0,d,e)));if(a.zpp_inner.world)throw new m("Error: Space::world has no localCOM");null==a.zpp_inner.wrap_localCOM&&(a.zpp_inner.wrap_localCOM=E.get(a.zpp_inner.localCOMx,a.zpp_inner.localCOMy,null),a.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,a.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,a.zpp_inner.wrap_localCOM.zpp_inner._validate=(Mb=a.zpp_inner,x(Mb,Mb.getlocalCOM)));d=a.zpp_inner.wrap_localCOM.mul(-1);a.translateShapes(d);null==
a.zpp_inner_i.userData&&(a.zpp_inner_i.userData={});a.zpp_inner_i.userData.graphicOffset=d;null==a.zpp_inner.wrap_pos&&a.zpp_inner.setupPosition();a.zpp_inner.wrap_pos.setxy(b,c);return a};rc.createCircle=function(a,b,c,d){a=new Vb(a);a.zpp_inner.wrap_shapes.add(new Ic(d));null==a.zpp_inner.wrap_pos&&a.zpp_inner.setupPosition();a.zpp_inner.wrap_pos.setxy(b,c);return a};var Fb=function(a,b){this.ID=this.lastTime=0;this.context=null==a?Fb.createContext():a;this.sampleTime=1/this.context.sampleRate;
this.destination=null==b?this.context.destination:b;this.delayedBegin=[];this.delayedRelease=[];this.delayedEnd=[];this.timedEvents=[];this.lastId=this.ID;this.polyphony=0;this.activeItems=new vd;this.itemRelease=new gc;this.itemBegin=new gc;this.itemEnd=new bd;this.timedEvent=new gc;this.set_attack(.25);this.set_release(.5);this.set_volume(.25);this.set_duration(NaN);Ja._frameTick.connect(x(this,this.tick))};Fb.__name__=!0;Fb.createContext=function(){return new (window.AudioContext||window.webkitAudioContext)};
Fb.prototype={doRelease:function(a,b){null==b&&(b=-1);var c=this.activeItems.h[a];if(null!=c){var d;d=b<=this.context.currentTime?this.context.currentTime:b;var e=d+c.release,l=(d-c.triggerTime)/c.attack;1<l&&(l=1);c.env.gain.cancelScheduledValues(d);c.env.gain.setValueAtTime(c.volume*l,d);c.env.gain.linearRampToValueAtTime(0,e);c.env.gain.setValueAtTime(0,e);this.delayedRelease.push({id:a,time:d});this.delayedEnd.push({id:a,time:e})}},doStop:function(a){var b=this.activeItems.h[a];null!=b&&(b.src.stop(this.context.currentTime),
b.src.disconnect(),b.env.gain.cancelScheduledValues(this.context.currentTime),b.env.disconnect(),this.triggerItemEnd(a),this.activeItems.remove(a))},set_attack:function(a){a<this.sampleTime&&(a=this.sampleTime);return this._attack=a},set_release:function(a){a<this.sampleTime&&(a=this.sampleTime);return this._release=a},set_duration:function(a){return this._duration=a},set_volume:function(a){0>a&&(a=0);return this._volume=a},triggerItemBegin:function(a,b){this.polyphony++;this.itemBegin.emit(a,b)},
triggerItemEnd:function(a){this.polyphony--;this.itemEnd.emit(a)},tick:function(a){a=this.context.currentTime;var b=a-this.lastTime;this.lastTime=a;a+=b+b;for(var b=0,c=this.timedEvents.length;b<c;){var d=this.timedEvents[b];a>d.time?(this.timedEvent.emit(d.id,d.time),this.timedEvents.splice(b,1),c--):b++}b=0;for(c=this.delayedBegin.length;b<c;)d=this.delayedBegin[b],a>d.time?(this.triggerItemBegin(d.id,d.time),this.delayedBegin.splice(b,1),c--):b++;b=0;for(c=this.delayedRelease.length;b<c;)d=this.delayedRelease[b],
a>d.time?(this.itemRelease.emit(d.id,d.time),this.delayedRelease.splice(b,1),c--):b++;b=0;for(c=this.delayedEnd.length;b<c;)a=this.delayedEnd[b],this.lastTime>=a.time?(this.doStop(a.id),this.delayedEnd.splice(b,1),c--):b++},createAttackEnvelope:function(a){var b=this.context.createGain();b.gain.value=0;b.gain.setValueAtTime(0,a);b.gain.linearRampToValueAtTime(this._volume,a+this._attack);b.connect(this.destination);return b},__class__:Fb};var qc=function(a,b){this.customWave=null;Fb.call(this,a,b);
this.type=window.TonesOscillatorTypeShim.SINE};qc.__name__=!0;qc.__super__=Fb;qc.prototype=B(Fb.prototype,{playFrequency:function(a,b,c,d){null==d&&(d=0);null==c&&(c=!0);null==b&&(b=0);b<this.sampleTime&&(b=this.sampleTime);d<this.sampleTime&&(d=this.sampleTime);var e;this.lastId=this.ID;this.ID++;e=this.lastId;var l=this.context.currentTime+b,f=this.createAttackEnvelope(l),g=this.context.createOscillator();this.type==window.TonesOscillatorTypeShim.CUSTOM?g.setPeriodicWave(this.customWave):g.type=
this.type;g.frequency.value=a;g.connect(f);g.start(l);c?this.set_duration(this._attack+d+this._release):this.set_duration(NaN);this.activeItems.h[e]={id:e,src:g,volume:this._volume,env:f,attack:this._attack,release:this._release,duration:this._duration,triggerTime:l};c&&b<=this.sampleTime?this.triggerItemBegin(e,l):this.delayedBegin.push({id:e,time:l});c&&this.doRelease(e,l+this._duration-this._release);return e},__class__:qc});var Tb=function(){null==Tb.pitchNames&&(Tb.pitchNames="C C# D D# E F F# G G# A A# B".split(" "),
Tb.altPitchNames=[null,"Db",null,"Eb",null,null,"Gb",null,"Ab",null,"Bb",null]);this.noteFrequencies=new Float32Array(128);this.noteNames=[];this._octaveMiddleC=3;this.set_tuningBase(440)};Tb.__name__=!0;Tb.prototype={reset:function(){for(var a=0;128>a;){var b=a++;this.noteNames[b]=this.indexToName(b);this.noteFrequencies[b]=this.get_tuningBase()*Math.pow(2,.08333333333333333*(b-69))}},noteIndexToFrequency:function(a){return 0<=a&&128>a?this.noteFrequencies[a]:NaN},detune:function(a,b){return 0==
b?a:0>b?a/Math.pow(2,8.333333333333334E-4*-b):a*Math.pow(2,8.333333333333334E-4*b)},indexToName:function(a){var b=a%12;a=(.08333333333333333*a|0)-(5-this.get_octaveMiddleC());var c=Tb.pitchNames[b]+a;null!=Tb.altPitchNames[b]&&(c+="/"+Tb.altPitchNames[b]+a);return c},get_tuningBase:function(){return this._tuningBase},set_tuningBase:function(a){this._tuningBase=a;this.invTuningBase=1/(.5*this._tuningBase);this.reset();return this._tuningBase},get_octaveMiddleC:function(){return this._octaveMiddleC},
__class__:Tb};var Ja=function(){};Ja.__name__=!0;Ja.onFrame=function(a){Ja._frameTick.emit(a);window.requestAnimationFrame(Ja.onFrame)};var U=function(){this.body=this.constraint=null;this.pre_swapped=!1;this.int1=this.int2=this.set=this.wrap_arbiters=this.pre_arbiter=null;this.length=0;this.listener=this.next=this.prev=null;this.event=0;this.outer_body=this.outer_con=this.outer_int=null;this.length=0};U.__name__=!0;U.prototype={wrapper_body:function(){null==this.outer_body&&(U.internal=!0,this.outer_body=
new Mc,U.internal=!1,this.outer_body.zpp_inner=this);return this.outer_body},wrapper_con:function(){null==this.outer_con&&(U.internal=!0,this.outer_con=new Nc,U.internal=!1,this.outer_con.zpp_inner=this);return this.outer_con},wrapper_int:function(){null==this.outer_int&&(U.internal=!0,this.outer_int=new Oc,U.internal=!1,this.outer_int.zpp_inner=this);null==this.wrap_arbiters?this.wrap_arbiters=V.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters;this.wrap_arbiters.zpp_inner.zip_length=
!0;this.wrap_arbiters.zpp_inner.at_ite=null;return this.outer_int},push:function(a){null!=this.prev?this.prev.next=a:this.next=a;a.prev=this.prev;a.next=null;this.prev=a;this.length++},pop:function(){var a=this.next;this.next=a.next;null==this.next?this.prev=null:this.next.prev=null;this.length--;return a},empty:function(){return null==this.next},__class__:U};var G=function(){this.interactors=this.constraints=null;this.zip_conlisteners=!1;this.conlisteners=null;this.zip_bodylisteners=!1;this.bodylisteners=
null;this.zip_listeners=!1;this.manager=this.cbpairs=this.listeners=null;this.id=0;this.next=null;this.count=0;this.cbTypes=null;this.cbTypes=new mb;this.listeners=new Fc;this.zip_listeners=!0;this.bodylisteners=new sd;this.zip_bodylisteners=!0;this.conlisteners=new td;this.zip_conlisteners=!0;this.constraints=new Ub;this.interactors=new ec;this.id=oa.CbSet();this.cbpairs=new jd};G.__name__=!0;G.setlt=function(a,b){for(var c=a.cbTypes.head,d=b.cbTypes.head;null!=c&&null!=d;){var e=c.elt,l=d.elt;if(e.id<
l.id)return!0;if(l.id<e.id)return!1;c=c.next;d=d.next}return null!=d&&null==c};G.get=function(a){var b;null==G.zpp_pool?b=new G:(b=G.zpp_pool,G.zpp_pool=b.next,b.next=null);null;var c=null;for(a=a.head;null!=a;){var d=a.elt,c=b.cbTypes.insert(c,d);d.cbsets.add(b);a=a.next}return b};G.single_intersection=function(a,b,c){return a.manager.pair(a,b).single_intersection(c)};G.find_all=function(a,b,c,d){a.manager.pair(a,b).forall(c,d)};G.prototype={invalidate_pairs:function(){for(var a=this.cbpairs.head;null!=
a;)a.elt.zip_listeners=!0,a=a.next},realvalidate_listeners:function(){this.listeners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.listeners.head,d=a.elt.listeners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||N.setlt(e,c.elt)?(e.space==this.manager.space&&(b=this.listeners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,
c=this.bodylisteners.head,d=a.elt.bodylisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||N.setlt(e,c.elt)?(e.options.excluded(this.cbTypes)||e.space!=this.manager.space||(b=this.bodylisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},realvalidate_conlisteners:function(){this.conlisteners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.conlisteners.head,d=a.elt.conlisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,
b=c,c=c.next):null==c||N.setlt(e,c.elt)?(e.options.excluded(this.cbTypes)||e.space!=this.manager.space||(b=this.conlisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners());this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners());this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},free:function(){this.listeners.clear();this.zip_listeners=
!0;this.bodylisteners.clear();this.zip_bodylisteners=!0;this.conlisteners.clear();for(this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},__class__:G};var Z=function(){this.listeners=null;this.zip_listeners=!1;this.a=this.b=this.next=null;this.listeners=new Fc};Z.__name__=!0;Z.get=function(a,b){var c;null==Z.zpp_pool?c=new Z:(c=Z.zpp_pool,Z.zpp_pool=c.next,c.next=null);c.zip_listeners=!0;G.setlt(a,b)?(c.a=a,c.b=b):(c.a=b,c.b=a);return c};Z.setlt=function(a,
b){return G.setlt(a.a,b.a)||a.a==b.a&&G.setlt(a.b,b.b)};Z.prototype={__validate:function(){this.listeners.clear();for(var a=this.a.listeners.head,b=this.b.listeners.head;null!=a&&null!=b;){var c=a.elt,d=b.elt;c==d?((c.options1.compatible(this.a.cbTypes)&&c.options2.compatible(this.b.cbTypes)||c.options2.compatible(this.a.cbTypes)&&c.options1.compatible(this.b.cbTypes))&&this.listeners.add(c),a=a.next,b=b.next):c.precedence>d.precedence||c.precedence==d.precedence&&c.id>d.id?a=a.next:b=b.next}},empty_intersection:function(){return null==
this.listeners.head},single_intersection:function(a){var b=this.listeners.head;return null!=b&&b.elt==a&&null==b.next},forall:function(a,b){for(var c=this.listeners.head;null!=c;){var d=c.elt;d.event==a&&b(d);c=c.next}},__class__:Z};var f=function(){};f.__name__=!0;var N=function(){this.body=this.constraint=this.interaction=this.space=null;this.id=this.type=this.event=this.precedence=0;this.outer=null;this.id=oa.Listener()};N.__name__=!0;N.setlt=function(a,b){return a.precedence>b.precedence||a.precedence==
b.precedence&&a.id>b.id};N.prototype={addedToSpace:function(){},removedFromSpace:function(){},__class__:N};var kd=function(){this.outer_zn=this.options=this.handler=null};kd.__name__=!0;kd.__super__=N;kd.prototype=B(N.prototype,{addedToSpace:function(){this.options.handler=x(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addbody(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=a;){var b=a.elt;b.bodylisteners.remove(this);b.invalidatebody();
a=a.next}this.options.handler=null},cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:kd});var Xd=function(){this.outer_zn=this.options=this.handler=null};Xd.__name__=!0;Xd.__super__=N;Xd.prototype=B(N.prototype,{addedToSpace:function(){this.options.handler=x(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addconstraint(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=
a;){var b=a.elt;b.conlisteners.remove(this);b.invalidateconstraint();a=a.next}this.options.handler=null},cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:Xd});var mb=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};mb.__name__=!0;mb.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ya.zpp_pool?b=new Ya:(b=Ya.zpp_pool,Ya.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=
this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Ya.zpp_pool?c=new Ya:(c=Ya.zpp_pool,Ya.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ya.zpp_pool;Ya.zpp_pool=a;null==this.head&&
(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=
c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ya.zpp_pool;Ya.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},has:function(a){return this.inlined_has(a)},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:mb};var ca=function(a,b,c,d){this.handlerp=null;this.allowSleepingCallbacks=
this.pure=!1;this.options1=this.options2=this.handleri=null;this.itype=0;this.outer_zni=this.outer_znp=null;N.call(this);this.type=d;this.interaction=this;this.event=c;this.options1=a.zpp_inner;this.options2=b.zpp_inner;this.allowSleepingCallbacks=!1};ca.__name__=!0;ca.__super__=N;ca.prototype=B(N.prototype,{CbSetset:function(a,b,c){var d=ca.UCbSet,e=ca.VCbSet,l=ca.WCbSet;a=a.head;for(var f=b.head;null!=a&&null!=f;){var g=a.elt,k=f.elt;g==k?(l.inlined_add(g),a=a.next,f=f.next):G.setlt(g,k)?(d.inlined_add(g),
a=a.next):(e.inlined_add(k),f=f.next)}for(;null!=a;)d.inlined_add(a.elt),a=a.next;for(;null!=f;)e.inlined_add(f.elt),f=f.next;for(;null!=d.head;)for(a=d.pop_unsafe(),f=b.head;null!=f;)c(a,f.elt),f=f.next;for(;null!=e.head;)for(b=e.pop_unsafe(),d=l.head;null!=d;)c(b,d.elt),d=d.next;for(;null!=l.head;)for(e=l.pop_unsafe(),c(e,e),b=l.head;null!=b;)c(e,b.elt),b=b.next},CbTypeset:function(a,b,c){var d=ca.UCbType,e=ca.VCbType,f=ca.WCbType;a=a.head;for(var h=b.head;null!=a&&null!=h;){var g=a.elt,k=h.elt;
g==k?(f.inlined_add(g),a=a.next,h=h.next):g.id<k.id?(d.inlined_add(g),a=a.next):(e.inlined_add(k),h=h.next)}for(;null!=a;)d.inlined_add(a.elt),a=a.next;for(;null!=h;)e.inlined_add(h.elt),h=h.next;for(;null!=d.head;)for(a=d.pop_unsafe(),h=b.head;null!=h;)c(a,h.elt),h=h.next;for(;null!=e.head;)for(b=e.pop_unsafe(),d=f.head;null!=d;)c(b,d.elt),d=d.next;for(;null!=f.head;)for(e=f.pop_unsafe(),c(e,e),b=f.head;null!=b;)c(e,b.elt),b=b.next},with_uniquesets:function(a){var b=this,c;null==W.zpp_pool?c=new W:
(c=W.zpp_pool,W.zpp_pool=c.next,c.next=null);null;c.lt=Z.setlt;this.CbTypeset(this.options1.includes,this.options2.includes,function(a,d){b.CbSetset(a.cbsets,d.cbsets,function(a,d){a.validate();d.validate();G.single_intersection(a,d,b)&&c.try_insert(Z.get(a,d))})});c.clear_with(function(c){a?b.space.freshListenerType(c.a,c.b):b.space.nullListenerType(c.a,c.b);c.a=c.b=null;c.listeners.clear();c.next=Z.zpp_pool;Z.zpp_pool=c});var d=c;d.data=null;d.lt=null;d.swapped=null;d.next=W.zpp_pool;W.zpp_pool=
d},with_union:function(a){for(var b=this.options1.includes.head,c=this.options2.includes.head;null!=b&&null!=c;){var d=b.elt,e=c.elt;d==e?(a(d),b=b.next,c=c.next):d.id<e.id?(a(d),b=b.next):(a(e),c=c.next)}for(;null!=b;)a(b.elt),b=b.next;for(;null!=c;)a(c.elt),c=c.next},addedToSpace:function(){var a=this,b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.addint(a);if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=x(this,this.cbtype_change1);this.options2.handler=
x(this,this.cbtype_change2);this.with_uniquesets(!0)},removedFromSpace:function(){var a=this;this.with_uniquesets(!1);var b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.listeners.remove(a);c.invalidateint();if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=null;this.options2.handler=null},cbtype_change1:function(a,b,c){this.cbtype_change(this.options1,a,b,c)},cbtype_change2:function(a,b,c){this.cbtype_change(this.options2,a,b,c)},cbtype_change:function(a,
b,c,d){this.removedFromSpace();a.effect_change(b,c,d);this.addedToSpace();null},__class__:ca});var tc=function(){this.outer=this.handler=this.includes=this.excludes=this.wrap_includes=this.wrap_excludes=null;this.includes=new mb;this.excludes=new mb};tc.__name__=!0;tc.argument=function(a){return null==a?new fd:I.__instanceof(a,fd)?a:(new fd).including(a)};tc.prototype={setup_includes:function(){this.wrap_includes=Ba.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=Ba.get(this.excludes,
!0)},excluded:function(a){return this.nonemptyintersection(a,this.excludes)},compatible:function(a){return this.nonemptyintersection(a,this.includes)&&!this.nonemptyintersection(a,this.excludes)},nonemptyintersection:function(a,b){for(var c=!1,d=a.head,e=b.head;null!=e&&null!=d;){var f=e.elt,h=d.elt;if(f==h){c=!0;break}else f.id<h.id?e=e.next:d=d.next}return c},effect_change:function(a,b,c){if(b)if(c){b=null;for(c=this.includes.head;null!=c&&!(a.id<c.elt.id);)b=c,c=c.next;this.includes.inlined_insert(b,
a)}else this.includes.remove(a);else if(c){b=null;for(c=this.excludes.head;null!=c&&!(a.id<c.elt.id);)b=c,c=c.next;this.excludes.inlined_insert(b,a)}else this.excludes.remove(a)},append_type:function(a,b){a==this.includes?this.includes.has(b)||(this.excludes.has(b)?null!=this.handler?this.handler(b,!1,!1):this.effect_change(b,!1,!1):null!=this.handler?this.handler(b,!0,!0):this.effect_change(b,!0,!0)):this.excludes.has(b)||(this.includes.has(b)?null!=this.handler?this.handler(b,!0,!1):this.effect_change(b,
!0,!1):null!=this.handler?this.handler(b,!1,!0):this.effect_change(b,!1,!0))},append:function(a,b){if(null==b)throw new m("Error: Cannot append null, only CbType and CbType list values");if(I.__instanceof(b,Ia))this.append_type(a,b.zpp_inner);else if(I.__instanceof(b,cd)){var c;b.zpp_inner.valmod();for(c=ib.get(b);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);this.append_type(a,d.zpp_inner)}}else if(b instanceof Array&&null==b.__enum__)for(c=0;c<b.length;){d=b[c];++c;if(!I.__instanceof(d,
Ia))throw new m("Error: Cannot append non-CbType or CbType list value");this.append_type(a,d.zpp_inner)}else throw new m("Error: Cannot append non-CbType or CbType list value");},__class__:tc};var ub=function(){this.pre_dt=0;this.cbTypes=this.cbSet=null;this.ignore=this.__velocity=!1;this.component=null;this.breakUnderForce=this.breakUnderError=this.removeOnBreak=!1;this.frequency=this.damping=this.maxForce=this.maxError=0;this.active=this.stiff=!1;this.compound=this.space=null;this.id=0;this.outer=
null;this.__velocity=!1;this.id=oa.Constraint();this.active=this.stiff=!0;this.ignore=!1;this.frequency=10;this.damping=1;this.maxError=this.maxForce=Infinity;this.breakUnderForce=!1;this.removeOnBreak=!0;this.pre_dt=-1;this.cbTypes=new mb};ub.__name__=!0;ub.prototype={immutable_midstep:function(a){if(null!=this.space&&this.space.midstep)throw new m("Error: Constraint::"+a+" cannot be set during space step()");},insert_cbtype:function(a){if(!this.cbTypes.has(a)){null!=this.space&&(this.dealloc_cbSet(),
a.constraints.add(this));for(var b=null,c=this.cbTypes.head;null!=c&&!(a.id<c.elt.id);)b=c,c=c.next;this.cbTypes.inlined_insert(b,a);null!=this.space&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},dealloc_cbSet:function(){if(null!=this.cbSet){this.cbSet.constraints.remove(this);if(0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var a=this.cbSet;a.free();a.next=G.zpp_pool;
G.zpp_pool=a}this.cbSet=null}},addedToSpace:function(){this.active&&this.activeInSpace();this.activeBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.add(this),a=a.next},removedFromSpace:function(){this.active&&this.inactiveOrOutSpace();this.inactiveBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.remove(this),a=a.next},activeInSpace:function(){this.alloc_cbSet();null==ka.zpp_pool?this.component=new ka:(this.component=ka.zpp_pool,ka.zpp_pool=this.component.next,this.component.next=
null);null;this.component.isBody=!1;this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var a=this.component;a.body=null;a.constraint=null;null;a.next=ka.zpp_pool;ka.zpp_pool=a;this.component=null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},validate:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(a,b){return!1},broken:function(){},warmStart:function(){},preStep:function(a){return!1},applyImpulseVel:function(){return!1},
applyImpulsePos:function(){return!1},wake:function(){null!=this.space&&this.space.wake_constraint(this)},__class__:ub};var Qc=function(){this.stepped=!1;this.kMassa=this.kMassb=this.kMassc=this.jAccx=this.jAccy=this.jMax=this.gamma=this.biasx=this.biasy=0;this.wrap_a2=null;this.a2localx=this.a2localy=this.a2relx=this.a2rely=0;this.wrap_a1=this.b2=null;this.a1localx=this.a1localy=this.a1relx=this.a1rely=0;this.outer_zn=this.b1=null;ub.call(this);this.stepped=!1;this.jAccy=this.jAccx=0;this.jMax=Infinity;
this.a2rely=this.a2relx=this.a2localy=this.a2localx=this.a1rely=this.a1relx=this.a1localy=this.a1localx=0};Qc.__name__=!0;Qc.__super__=ub;Qc.prototype=B(ub.prototype,{activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx;
this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(a){this.immutable_midstep("Constraint::a1");this.a1localx=a.x;this.a1localy=a.y;this.wake()},setup_a1:function(){this.wrap_a1=E.get(this.a1localx,this.a1localy,null);this.wrap_a1.zpp_inner._inuse=!0;this.wrap_a1.zpp_inner._validate=x(this,this.validate_a1);this.wrap_a1.zpp_inner._invalidate=x(this,this.invalidate_a1)},validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx;this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(a){this.immutable_midstep("Constraint::a2");
this.a2localx=a.x;this.a2localy=a.y;this.wake()},setup_a2:function(){this.wrap_a2=E.get(this.a2localx,this.a2localy,null);this.wrap_a2.zpp_inner._inuse=!0;this.wrap_a2.zpp_inner._validate=x(this,this.validate_a2);this.wrap_a2.zpp_inner._invalidate=x(this,this.invalidate_a2)},validate:function(){if(null==this.b1||null==this.b2)throw new m("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new m("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+
")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new m("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(this.b1.type!=f.id_BodyType_DYNAMIC&&this.b2.type!=f.id_BodyType_DYNAMIC)throw new m("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");},wake_connected:function(){null!=
this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;
b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=
c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAccy=this.jAccx=0;this.pre_dt=-1},preStep:function(a){-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.stepped=!0;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy;this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;
this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy;this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var c=this.b1.smass+this.b2.smass;this.kMassa=c;this.kMassb=0;this.kMassc=c;if(0!=this.b1.sinertia){var c=this.a1relx*this.b1.sinertia,d=this.a1rely*this.b1.sinertia;this.kMassa+=d*this.a1rely;this.kMassb+=-d*this.a1relx;this.kMassc+=c*this.a1relx}0!=this.b2.sinertia&&(c=this.a2relx*this.b2.sinertia,d=this.a2rely*this.b2.sinertia,this.kMassa+=d*this.a2rely,this.kMassb+=
-d*this.a2relx,this.kMassc+=c*this.a2relx);c=this.kMassa*this.kMassc-this.kMassb*this.kMassb;c!=c?(this.kMassa=this.kMassb=this.kMassc=0,c=3):0==c?(c=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,c|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,c|=2),this.kMassb=0):(c=1/c,d=this.kMassc*c,this.kMassc=this.kMassa*c,this.kMassa=d,this.kMassb*=-c,c=0);0!=(c&1)&&(this.jAccx=0);0!=(c&2)&&(this.jAccy=0);if(this.stiff)this.gamma=this.biasy=this.biasx=0;else{d=2*Math.PI*this.frequency;
this.gamma=1/(a*d*(2*this.damping+d*a));c=1/(1+this.gamma);d=a*d*d*this.gamma;this.gamma*=c;this.kMassa*=c;this.kMassb*=c;this.kMassc*=c;this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx);this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);if(this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;c=-d;this.biasx*=c;this.biasy*=c;c=this.maxError;d=this.biasx*this.biasx+this.biasy*this.biasy;d>c*c&&(c*=1/Math.sqrt(d),this.biasx*=
c,this.biasy*=c)}this.jAccx*=b;this.jAccy*=b;this.jMax=this.maxForce*a;return!1},warmStart:function(){var a=this.b1.imass;this.b1.velx-=this.jAccx*a;this.b1.vely-=this.jAccy*a;a=this.b2.imass;this.b2.velx+=this.jAccx*a;this.b2.vely+=this.jAccy*a;this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia;this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},applyImpulseVel:function(){var a=0,b=0,a=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+
this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),b=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),c=0,d=0,c=this.biasx-a,d=this.biasy-b,a=this.kMassa*c+this.kMassb*d,d=this.kMassb*c+this.kMassc*d,b=this.gamma,c=a-this.jAccx*b,d=d-this.jAccy*b,b=a=0,a=this.jAccx,b=this.jAccy;this.jAccx+=1*c;this.jAccy+=1*d;if(this.breakUnderForce){if(this.jAccx*
this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(c=this.jMax,d=this.jAccx*this.jAccx+this.jAccy*this.jAccy,d>c*c&&(c*=1/Math.sqrt(d),this.jAccx*=c,this.jAccy*=c));c=this.jAccx-a;d=this.jAccy-b;a=this.b1.imass;this.b1.velx-=c*a;this.b1.vely-=d*a;a=this.b2.imass;this.b2.velx+=c*a;this.b2.vely+=d*a;this.b1.angvel-=(d*this.a1relx-c*this.a1rely)*this.b1.iinertia;this.b2.angvel+=(d*this.a2relx-c*this.a2rely)*this.b2.iinertia;return!1},applyImpulsePos:function(){var a=0,b=
0,a=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,b=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,c=0,d=0,c=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,d=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,e=0,f=0,e=this.b2.posx+c-(this.b1.posx+a),f=this.b2.posy+d-(this.b1.posy+b);if(this.breakUnderError&&e*e+f*f>this.maxError*this.maxError)return!0;if(e*e+f*f<p.constraintLinearSlop*p.constraintLinearSlop)return!1;var e=.5*e,f=.5*f,h=0,g=0;if(6<e*e+f*f&&(g=this.b1.smass+
this.b2.smass,g>p.epsilon)){var g=.75/g,h=-e*g,g=-f*g,k=h*h+g*g;400<k&&(k=1/Math.sqrt(k)*20,h*=k,g*=k);k=this.b1.imass;this.b1.posx-=h*k;this.b1.posy-=g*k;k=this.b2.imass;this.b2.posx+=h*k;this.b2.posy+=g*k;e=this.b2.posx+c-(this.b1.posx+a);f=this.b2.posy+d-(this.b1.posy+b);e*=.5;f*=.5}var r=k=0,n=0,k=h=this.b1.smass+this.b2.smass,r=0,n=h;0!=this.b1.sinertia&&(h=a*this.b1.sinertia,g=b*this.b1.sinertia,k+=g*b,r+=-g*a,n+=h*a);0!=this.b2.sinertia&&(h=c*this.b2.sinertia,g=d*this.b2.sinertia,k+=g*d,r+=
-g*c,n+=h*c);h=-e;g=-f;e=h*h+g*g;36<e&&(e=1/Math.sqrt(e)*6,h*=e,g*=e);e=k*n-r*r;e!=e?h=g=0:0==e?(h=0!=k?h/k:0,g=0!=n?g/n:0):(e=1/e,n=e*(n*h-r*g),g=e*(k*g-r*h),h=n);k=this.b1.imass;this.b1.posx-=h*k;this.b1.posy-=g*k;k=this.b2.imass;this.b2.posx+=h*k;this.b2.posy+=g*k;this.b1.delta_rot(-(g*a-h*b)*this.b1.iinertia);this.b2.delta_rot((g*c-h*d)*this.b2.iinertia);return!1},__class__:Qc});var uc=function(){this.stepped=!1;this.phase=this.kMassa=this.kMassb=this.kMassd=this.kMassc=this.kMasse=this.kMassf=
this.jAccx=this.jAccy=this.jAccz=this.jMax=this.gamma=this.biasx=this.biasy=this.biasz=0;this.wrap_a2=null;this.a2localx=this.a2localy=this.a2relx=this.a2rely=0;this.wrap_a1=this.b2=null;this.a1localx=this.a1localy=this.a1relx=this.a1rely=0;this.outer_zn=this.b1=null;ub.call(this);this.jAccz=this.jAccy=this.jAccx=this.phase=0;this.jMax=Infinity;this.stepped=!1;this.a2rely=this.a2relx=this.a2localy=this.a2localx=this.a1rely=this.a1relx=this.a1localy=this.a1localx=0};uc.__name__=!0;uc.__super__=ub;
uc.prototype=B(ub.prototype,{activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this);this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx;this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(a){this.immutable_midstep("Constraint::a1");this.a1localx=a.x;this.a1localy=
a.y;this.wake()},setup_a1:function(){this.wrap_a1=E.get(this.a1localx,this.a1localy,null);this.wrap_a1.zpp_inner._inuse=!0;this.wrap_a1.zpp_inner._validate=x(this,this.validate_a1);this.wrap_a1.zpp_inner._invalidate=x(this,this.invalidate_a1)},validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx;this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(a){this.immutable_midstep("Constraint::a2");this.a2localx=a.x;this.a2localy=a.y;this.wake()},setup_a2:function(){this.wrap_a2=E.get(this.a2localx,
this.a2localy,null);this.wrap_a2.zpp_inner._inuse=!0;this.wrap_a2.zpp_inner._validate=x(this,this.validate_a2);this.wrap_a2.zpp_inner._invalidate=x(this,this.invalidate_a2)},validate:function(){if(null==this.b1||null==this.b2)throw new m("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new m("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new m("Error: Constraints must have each body within the same space to which the constraint has been assigned");
if(this.b1.type!=f.id_BodyType_DYNAMIC&&this.b2.type!=f.id_BodyType_DYNAMIC)throw new m("Error: Constraints cannot have both bodies non-dynamic");},wake_connected:function(){null!=this.b1&&this.b1.type==f.id_BodyType_DYNAMIC&&this.b1.wake();null!=this.b2&&this.b2.type==f.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==f.id_BodyType_DYNAMIC){var a;if(this.b1.component==this.b1.component.parent)a=this.b1.component;else{a=this.b1.component;for(var b=null;a!=a.parent;){var c=a.parent;
a.parent=b;b=a;a=c}for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;){var d=b.parent;b.parent=c;c=b;b=d}for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}if(this.b2.type==f.id_BodyType_DYNAMIC){if(this.b2.component==this.b2.component.parent)a=this.b2.component;else{a=this.b2.component;for(b=null;a!=a.parent;)c=a.parent,a.parent=b,b=a,a=
c;for(;null!=b;)c=b.parent,b.parent=a,b=c}if(this.component==this.component.parent)b=this.component;else{b=this.component;for(c=null;b!=b.parent;)d=b.parent,b.parent=c,c=b,b=d;for(;null!=c;)d=c.parent,c.parent=b,c=d}a!=b&&(a.rank<b.rank?a.parent=b:a.rank>b.rank?b.parent=a:(b.parent=a,a.rank++))}},pair_exists:function(a,b){return this.b1.id==a&&this.b2.id==b||this.b1.id==b&&this.b2.id==a},clearcache:function(){this.jAccz=this.jAccy=this.jAccx=0;this.pre_dt=-1},preStep:function(a){-1==this.pre_dt&&
(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;this.stepped=!0;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy;this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy;this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var c=this.b1.smass+this.b2.smass;this.kMassa=c;this.kMassb=0;this.kMassd=c;this.kMassf=this.kMasse=this.kMassc=0;if(0!=this.b1.sinertia){var c=this.a1relx*this.b1.sinertia,
d=this.a1rely*this.b1.sinertia;this.kMassa+=d*this.a1rely;this.kMassb+=-d*this.a1relx;this.kMassd+=c*this.a1relx;this.kMassc+=-d;this.kMasse+=c;this.kMassf+=this.b1.sinertia}0!=this.b2.sinertia&&(c=this.a2relx*this.b2.sinertia,d=this.a2rely*this.b2.sinertia,this.kMassa+=d*this.a2rely,this.kMassb+=-d*this.a2relx,this.kMassd+=c*this.a2relx,this.kMassc+=-d,this.kMasse+=c,this.kMassf+=this.b2.sinertia);c=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-
this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(c!=c)this.kMassf=this.kMasse=this.kMassc=this.kMassd=this.kMassb=this.kMassa=0,c=7;else if(0==c)c=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,c|=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,c|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,c|=4),this.kMassb=this.kMassc=this.kMasse=0;else{var c=1/c,d=c*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),e=c*(this.kMassa*this.kMassf-
this.kMassc*this.kMassc),f=c*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),h=c*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),g=c*(this.kMassa*this.kMassd-this.kMassb*this.kMassb);this.kMassa=c*(this.kMassd*this.kMassf-this.kMasse*this.kMasse);this.kMassb=d;this.kMassd=e;this.kMassc=f;this.kMasse=h;this.kMassf=g;c=0}0!=(c&1)&&(this.jAccx=0);0!=(c&2)&&(this.jAccy=0);0!=(c&4)&&(this.jAccz=0);if(this.stiff)this.gamma=this.biasz=this.biasy=this.biasx=0;else{d=2*Math.PI*this.frequency;this.gamma=
1/(a*d*(2*this.damping+d*a));c=1/(1+this.gamma);d=a*d*d*this.gamma;this.gamma*=c;this.kMassa*=c;this.kMassb*=c;this.kMassd*=c;this.kMassc*=c;this.kMasse*=c;this.kMassf*=c;this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx);this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);this.biasz=this.b2.rot-this.b1.rot-this.phase;if(this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;c=-d;this.biasx*=c;this.biasy*=
c;this.biasz*=c;c=this.maxError;d=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;d>c*c&&(c*=1/Math.sqrt(d),this.biasx*=c,this.biasy*=c,this.biasz*=c)}this.jAccx*=b;this.jAccy*=b;this.jAccz*=b;this.jMax=this.maxForce*a;return!1},warmStart:function(){var a=this.b1.imass;this.b1.velx-=this.jAccx*a;this.b1.vely-=this.jAccy*a;a=this.b2.imass;this.b2.velx+=this.jAccx*a;this.b2.vely+=this.jAccy*a;this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia;
this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},applyImpulseVel:function(){var a=0,b=0,c=0,a=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),b=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),c=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel,
d=0,e=0,f=0,d=this.biasx-a,e=this.biasy-b,f=this.biasz-c,a=this.kMassa*d+this.kMassb*e+this.kMassc*f,b=this.kMassb*d+this.kMassd*e+this.kMasse*f,f=this.kMassc*d+this.kMasse*e+this.kMassf*f,c=this.gamma,d=a-this.jAccx*c,e=b-this.jAccy*c,f=f-this.jAccz*c,c=b=a=0,a=this.jAccx,b=this.jAccy,c=this.jAccz;this.jAccx+=1*d;this.jAccy+=1*e;this.jAccz+=1*f;if(this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else this.stiff||(d=this.jMax,
e=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz,e>d*d&&(d*=1/Math.sqrt(e),this.jAccx*=d,this.jAccy*=d,this.jAccz*=d));d=this.jAccx-a;e=this.jAccy-b;f=this.jAccz-c;a=this.b1.imass;this.b1.velx-=d*a;this.b1.vely-=e*a;a=this.b2.imass;this.b2.velx+=d*a;this.b2.vely+=e*a;this.b1.angvel-=(e*this.a1relx-d*this.a1rely+f)*this.b1.iinertia;this.b2.angvel+=(e*this.a2relx-d*this.a2rely+f)*this.b2.iinertia;return!1},applyImpulsePos:function(){var a=0,b=0,a=this.b1.axisy*this.a1localx-this.b1.axisx*
this.a1localy,b=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,c=0,d=0,c=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,d=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,e=0,f=0,h=0,e=this.b2.posx+c-(this.b1.posx+a),f=this.b2.posy+d-(this.b1.posy+b),h=this.b2.rot-this.b1.rot-this.phase,g=0,k=0,r=0;if(this.breakUnderError&&e*e+f*f+h*h>this.maxError*this.maxError)return!0;g=!0;e*e+f*f<p.constraintLinearSlop*p.constraintLinearSlop&&(g=!1,f=e=0);if(h*h<Nb.sqr(p.constraintAngularSlop))if(g)h=
0;else return!1;e*=.5;f*=.5;h*=.5;if(6<e*e+f*f&&(k=this.b1.smass+this.b2.smass,k>p.epsilon)){var k=.75/k,g=-e*k,k=-f*k,n=g*g+k*k;400<n&&(n=1/Math.sqrt(n)*20,g*=n,k*=n);n=this.b1.imass;this.b1.posx-=g*n;this.b1.posy-=k*n;n=this.b2.imass;this.b2.posx+=g*n;this.b2.posy+=k*n;e=this.b2.posx+c-(this.b1.posx+a);f=this.b2.posy+d-(this.b1.posy+b);h=this.b2.rot-this.b1.rot-this.phase;e*=.5;f*=.5;h*=.5}var m=n=0,t=0,w=0,q=0,F=0,n=g=this.b1.smass+this.b2.smass,m=0,t=g,F=q=w=0;0!=this.b1.sinertia&&(g=a*this.b1.sinertia,
k=b*this.b1.sinertia,n+=k*b,m+=-k*a,t+=g*a,w+=-k,q+=g,F+=this.b1.sinertia);0!=this.b2.sinertia&&(g=c*this.b2.sinertia,k=d*this.b2.sinertia,n+=k*d,m+=-k*c,t+=g*c,w+=-k,q+=g,F+=this.b2.sinertia);g=-e;k=-f;r=-h;e=g*g+k*k;36<e&&(e=1/Math.sqrt(e)*6,g*=e,k*=e);Nb.clamp(r,-.25,.25);e=n*(t*F-q*q)+m*(w*q-m*F)+w*(m*q-w*t);if(e!=e)g=k=r=0;else if(0==e)g=0!=n?g/n:0,k=0!=t?k/t:0,r=0!=F?r/F:0;else var e=1/e,x=q*w-m*F,f=m*q-w*t,h=m*w-n*q,q=e*(g*(t*F-q*q)+k*x+r*f),w=e*(g*x+k*(n*F-w*w)+r*h),r=e*(g*f+k*h+r*(n*t-m*
m)),g=q,k=w;n=this.b1.imass;this.b1.posx-=g*n;this.b1.posy-=k*n;n=this.b2.imass;this.b2.posx+=g*n;this.b2.posy+=k*n;this.b1.delta_rot(-(k*a-g*b+r)*this.b1.iinertia);this.b2.delta_rot((k*c-g*d+r)*this.b2.iinertia);return!1},__class__:uc});var z=function(){this.colarb=this.fluidarb=this.sensorarb=null;this.type=0;this.b1=this.b2=this.ws1=this.ws2=this.pair=null;this.invalidated=!1;this.immState=0;this.intchange=this.presentable=this.continuous=this.fresh=!1;this.present=0;this.active=this.cleared=this.sleeping=
!1;this.id=this.di=this.stamp=this.up_stamp=this.sleep_stamp=this.endGenerated=0;this.outer=null};z.__name__=!0;z.prototype={wrapper:function(){null==this.outer&&(z.internal=!0,this.type==z.COL?(this.colarb.outer_zn=new gd,this.outer=this.colarb.outer_zn):this.type==z.FLUID?(this.fluidarb.outer_zn=new hd,this.outer=this.fluidarb.outer_zn):this.outer=new Ta,this.outer.zpp_inner=this,z.internal=!1);return this.outer},__class__:z};var ra=function(){this.next=null;z.call(this);this.type=z.SENSOR;this.sensorarb=
this};ra.__name__=!0;ra.__super__=z;ra.prototype=B(z.prototype,{retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=this.active=!1;this.next=ra.zpp_pool;ra.zpp_pool=this},__class__:ra});var cb=function(){this.pre_dt=0;this.mutable=!1;this.wrap_position=null;this.wMass=this.adamp=this.agamma=this.vMassa=this.vMassb=this.vMassc=this.dampx=this.dampy=this.lgamma=
this.nx=this.ny=this.buoyx=this.buoyy=0;this.nodrag=!1;this.centroidx=this.centroidy=this.overlap=this.r1x=this.r1y=this.r2x=this.r2y=0;this.outer_zn=this.next=null;z.call(this);this.type=z.FLUID;this.fluidarb=this;this.buoyy=this.buoyx=0;this.pre_dt=-1};cb.__name__=!0;cb.__super__=z;cb.prototype=B(z.prototype,{retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=
this.active=!1;this.next=cb.zpp_pool;cb.zpp_pool=this;this.pre_dt=-1},preStep:function(a,b){-1==this.pre_dt&&(this.pre_dt=b);var c=b/this.pre_dt;this.pre_dt=b;this.r1x=this.centroidx-this.b1.posx;this.r1y=this.centroidy-this.b1.posy;this.r2x=this.centroidx-this.b2.posx;this.r2y=this.centroidy-this.b2.posy;var d=0,e=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(d=this.ws1.fluidProperties.gravityx,e=this.ws1.fluidProperties.gravityy):(d=a.gravityx,e=a.gravityy);var l=0,h=0;this.ws2.fluidEnabled&&
null!=this.ws2.fluidProperties.wrap_gravity?(l=this.ws2.fluidProperties.gravityx,h=this.ws2.fluidProperties.gravityy):(l=a.gravityx,h=a.gravityy);var g=0,k=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var r=this.overlap*this.ws1.fluidProperties.density,n=this.overlap*this.ws2.fluidProperties.density;if(r>n)l=r+n,g-=d*l,k-=e*l;else if(r<n)d=r+n,g+=l*d,k+=h*d;else{var m=0,t=0,m=.5*(d+l),t=.5*(e+h);this.ws1.worldCOMx*m+this.ws1.worldCOMy*t>this.ws2.worldCOMx*m+this.ws2.worldCOMy*t?(d=r+n,g-=m*
d,k-=t*d):(d=r+n,g+=m*d,k+=t*d)}}else this.ws1.fluidEnabled?(l=this.overlap*this.ws1.fluidProperties.density,g-=d*l,k-=e*l):this.ws2.fluidEnabled&&(d=this.overlap*this.ws2.fluidProperties.density,g+=l*d,k+=h*d);g*=b;k*=b;this.buoyx=g;this.buoyy=k;this.b1.type==f.id_BodyType_DYNAMIC&&(d=this.b1.imass,this.b1.velx-=g*d,this.b1.vely-=k*d,this.b1.angvel-=(k*this.r1x-g*this.r1y)*this.b1.iinertia);this.b2.type==f.id_BodyType_DYNAMIC&&(d=this.b2.imass,this.b2.velx+=g*d,this.b2.vely+=k*d,this.b2.angvel+=
(k*this.r2x-g*this.r2y)*this.b2.iinertia);if(this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;g=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),g+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area);this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),g+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area);0!=g?(k=this.b1.sinertia+this.b2.sinertia,this.wMass=
0!=k?1/k:0,g*=8E-4*Math.PI,this.agamma=1/(b*g*(2+g*b)),g=1/(1+this.agamma),this.agamma*=g,this.wMass*=g):this.agamma=this.wMass=0;g=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel));k=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));g*g+k*k<p.epsilon*p.epsilon||(d=1/Math.sqrt(g*g+k*k),this.nx=g*d,this.ny=
k*d);g=0;if(this.ws1.fluidEnabled)if(k=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area,this.ws2.type==f.id_ShapeType_CIRCLE)g-=k*this.ws2.circle.radius*p.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{e=d=0;for(l=this.ws2.polygon.edges.head;null!=l;)h=l.elt,d+=h.length,h=k*h.length*(h.gnormx*this.nx+h.gnormy*this.ny),0<h&&(h=h*=-p.fluidVacuumDrag),e-=.5*h*p.fluidLinearDrag,l=l.next;g+=e/d}if(this.ws2.fluidEnabled)if(k=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area,
this.ws1.type==f.id_ShapeType_CIRCLE)g-=k*this.ws1.circle.radius*p.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{e=d=0;for(l=this.ws1.polygon.edges.head;null!=l;)h=l.elt,d+=h.length,h=k*h.length*(h.gnormx*this.nx+h.gnormy*this.ny),0<h&&(h=h*=-p.fluidVacuumDrag),e-=.5*h*p.fluidLinearDrag,l=l.next;g+=e/d}0!=g?(l=this.b1.smass+this.b2.smass,e=d=k=0,k=l,d=0,e=l,0!=this.b1.sinertia&&(l=this.r1x*this.b1.sinertia,h=this.r1y*this.b1.sinertia,k+=h*this.r1y,d+=-h*this.r1x,e+=l*this.r1x),0!=this.b2.sinertia&&
(l=this.r2x*this.b2.sinertia,h=this.r2y*this.b2.sinertia,k+=h*this.r2y,d+=-h*this.r2x,e+=l*this.r2x),l=k*e-d*d,l!=l?(k=d=e=0,3):0==l?(l=0,0!=k?k=1/k:(k=0,l|=1),0!=e?e=1/e:(e=0,l|=2),d=0,l):(l=1/l,h=e*l,e=k*l,k=h,d*=-l,0),this.vMassa=k,this.vMassb=d,this.vMassc=e,g*=2*Math.PI,this.lgamma=1/(b*g*(2+g*b)),g=1/(1+this.lgamma),this.lgamma*=g,this.vMassa*=g,this.vMassb*=g,this.vMassc*=g):this.lgamma=this.vMassc=this.vMassb=this.vMassa=0}else this.nodrag=!0,this.adamp=this.dampy=this.dampx=0;this.dampx*=
c;this.dampy*=c;this.adamp*=c},warmStart:function(){var a=this.b1.imass;this.b1.velx-=this.dampx*a;this.b1.vely-=this.dampy*a;a=this.b2.imass;this.b2.velx+=this.dampx*a;this.b2.vely+=this.dampy*a;this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y);this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y);this.b1.angvel-=this.adamp*this.b1.iinertia;this.b2.angvel+=this.adamp*this.b2.iinertia},applyImpulseVel:function(){if(!this.nodrag){var a=this.b1.angvel+this.b1.kinangvel,
b=this.b2.angvel+this.b2.kinangvel,c=this.b1.velx+this.b1.kinvelx-this.r1y*a-(this.b2.velx+this.b2.kinvelx-this.r2y*b),d=this.b1.vely+this.b1.kinvely+this.r1x*a-(this.b2.vely+this.b2.kinvely+this.r2x*b),e=this.vMassa*c+this.vMassb*d,d=this.vMassb*c+this.vMassc*d,f=this.lgamma,c=e-this.dampx*f,d=d-this.dampy*f;this.dampx+=1*c;this.dampy+=1*d;e=this.b1.imass;this.b1.velx-=c*e;this.b1.vely-=d*e;e=this.b2.imass;this.b2.velx+=c*e;this.b2.vely+=d*e;this.b1.angvel-=this.b1.iinertia*(d*this.r1x-c*this.r1y);
this.b2.angvel+=this.b2.iinertia*(d*this.r2x-c*this.r2y);a=(a-b)*this.wMass-this.adamp*this.agamma;this.adamp+=a;this.b1.angvel-=a*this.b1.iinertia;this.b2.angvel+=a*this.b2.iinertia}},__class__:cb});var Ea=function(){this.pre_dt=0;this.stat=this.mutable=!1;this.next=null;this.hc2=this.hpc2=!1;this.c1=this.oc1=this.c2=this.oc2=null;this.__ref_vertex=0;this.__ref_edge1=this.__ref_edge2=null;this.biasCoef=0;this.rev=!1;this.kMassa=this.kMassb=this.kMassc=this.Ka=this.Kb=this.Kc=this.rMass=this.jrAcc=
this.rn1a=this.rt1a=this.rn1b=this.rt1b=this.rn2a=this.rt2a=this.rn2b=this.rt2b=this.k1x=this.k1y=this.k2x=this.k2y=this.surfacex=this.surfacey=this.lnormx=this.lnormy=this.lproj=this.radius=0;this.wrap_normal=null;this.nx=this.ny=0;this.s1=this.s2=this.contacts=this.wrap_contacts=this.innards=null;this.userdef_dyn_fric=this.userdef_stat_fric=this.userdef_restitution=this.userdef_rfric=!1;this.dyn_fric=this.stat_fric=this.restitution=this.rfric=0;this.outer_zn=null;z.call(this);this.pre_dt=-1;this.contacts=
new M;this.innards=new Ad;this.type=z.COL;this.colarb=this};Ea.__name__=!0;Ea.__super__=z;Ea.prototype=B(z.prototype,{injectContact:function(a,b,c,d,e,f,h){null==h&&(h=!1);for(var g=null,k=this.contacts.next;null!=k;){var r=k;if(f==r.hash){g=r;break}k=k.next}null==g?(null==M.zpp_pool?g=new M:(g=M.zpp_pool,M.zpp_pool=g.next,g.next=null),null,k=g.inner,k.jnAcc=k.jtAcc=0,g.hash=f,g.fresh=!0,g.arbiter=this,this.jrAcc=0,this.contacts.inlined_add(g),this.innards.add(k)):g.fresh=!1;g.px=a;g.py=b;this.nx=
c;this.ny=d;g.dist=e;g.stamp=this.stamp;g.posOnly=h;return g},retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;for(this.intchange=this.active=!1;null!=this.contacts.next;){var a=this.contacts.inlined_pop_unsafe();a.arbiter=null;a.next=M.zpp_pool;M.zpp_pool=a;this.innards.inlined_pop()}this.userdef_rfric=this.userdef_restitution=this.userdef_stat_fric=this.userdef_dyn_fric=
!1;this.__ref_edge1=this.__ref_edge2=null;this.next=Ea.zpp_pool;Ea.zpp_pool=this;this.pre_dt=-1},cleanupContacts:function(){var a=!0,b=null,c=null,d=this.innards.next;this.hc2=!1;for(var e=this.contacts.next;null!=e;){var f=e;f.stamp+p.arbiterExpirationDelay<this.stamp?(e=this.contacts.inlined_erase(b),d=this.innards.inlined_erase(c),f.arbiter=null,f.next=M.zpp_pool,M.zpp_pool=f):(b=f.inner,c=f.active,f.active=f.stamp==this.stamp,f.active&&(a?(a=!1,this.c1=b,this.oc1=f):(this.hc2=!0,this.c2=b,this.oc2=
f)),c!=f.active&&(this.contacts.modified=!0),b=e,c=d,d=d.next,e=e.next)}this.hc2?(this.hpc2=!0,this.oc1.posOnly?(d=this.c1,this.c1=this.c2,this.c2=d,d=this.oc1,this.oc1=this.oc2,this.oc2=d,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;return a},preStep:function(a){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=-Infinity>=this.s1.material.elasticity||-Infinity>=this.s2.material.elasticity?0:Infinity<=this.s1.material.elasticity||
Infinity<=this.s2.material.elasticity?1:(this.s1.material.elasticity+this.s2.material.elasticity)/2,0>this.restitution&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)));
-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;var c=this.b1.smass+this.b2.smass;this.hc2=!1;a=!0;this.biasCoef=this.b1.type!=f.id_BodyType_DYNAMIC||this.b2.type!=f.id_BodyType_DYNAMIC?this.continuous?p.contactContinuousStaticBiasCoef:p.contactStaticBiasCoef:this.continuous?p.contactContinuousBiasCoef:p.contactBiasCoef;this.continuous=!1;for(var d=null,e=null,l=this.innards.next,h=this.contacts.next;null!=h;){var g=h;if(g.stamp+p.arbiterExpirationDelay<this.stamp)h=this.contacts.inlined_erase(d),
l=this.innards.inlined_erase(e),g.arbiter=null,g.next=M.zpp_pool,M.zpp_pool=g;else{d=g.inner;e=g.active;g.active=g.stamp==this.stamp;if(g.active){a?(a=!1,this.c1=d,this.oc1=g):(this.hc2=!0,this.c2=d,this.oc2=g);d.r2x=g.px-this.b2.posx;d.r2y=g.py-this.b2.posy;d.r1x=g.px-this.b1.posx;d.r1y=g.py-this.b1.posy;var k=c+this.b2.sinertia*Nb.sqr(d.r2x*this.nx+d.r2y*this.ny),k=k+this.b1.sinertia*Nb.sqr(d.r1x*this.nx+d.r1y*this.ny);d.tMass=k<p.epsilon*p.epsilon?0:1/k;k=c+this.b2.sinertia*Nb.sqr(this.ny*d.r2x-
this.nx*d.r2y);k+=this.b1.sinertia*Nb.sqr(this.ny*d.r1x-this.nx*d.r1y);d.nMass=k<p.epsilon*p.epsilon?0:1/k;var r=k=0,n=this.b2.angvel+this.b2.kinangvel,k=this.b2.velx+this.b2.kinvelx-d.r2y*n,r=this.b2.vely+this.b2.kinvely+d.r2x*n,n=this.b1.angvel+this.b1.kinangvel,k=k-(this.b1.velx+this.b1.kinvelx-d.r1y*n),r=r-(this.b1.vely+this.b1.kinvely+d.r1x*n),n=this.nx*k+this.ny*r;g.elasticity=this.restitution;d.bounce=n*g.elasticity;d.bounce>-p.elasticThreshold&&(d.bounce=0);n=r*this.nx-k*this.ny;k=p.staticFrictionThreshold;
d.friction=n*n>k*k?this.dyn_fric:this.stat_fric;d.jnAcc*=b;d.jtAcc*=b}e!=g.active&&(this.contacts.modified=!0);d=h;e=l;l=l.next;h=h.next}}this.hc2?(this.hpc2=!0,this.oc1.posOnly?(l=this.c1,this.c1=this.c2,this.c2=l,l=this.oc1,this.oc1=this.oc2,this.oc2=l,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;this.jrAcc*=b;a||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,
this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel));this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*
this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=c+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=c+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=c+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<
p.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,b=this.kMassa*this.kMassc-this.kMassb*this.kMassb,b!=b?(this.kMassa=this.kMassb=this.kMassc=0,3):0==b?(b=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,b|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,b|=2),this.kMassb=0,b):(b=1/b,c=this.kMassc*b,this.kMassc=this.kMassa*b,this.kMassa=c,this.kMassb*=-b,0)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&
(b=this.c1,this.c1=this.c2,this.c2=b),this.oc2.active=!1,this.contacts.modified=!0));this.surfacex=this.b2.svelx;this.surfacey=this.b2.svely;this.surfacex+=1*this.b1.svelx;this.surfacey+=1*this.b1.svely;this.surfacex=-this.surfacex;this.surfacey=-this.surfacey;this.rMass=this.b1.sinertia+this.b2.sinertia;0!=this.rMass&&(this.rMass=1/this.rMass);return a},warmStart:function(){var a=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,b=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,c=this.b1.imass;this.b1.velx-=
a*c;this.b1.vely-=b*c;this.b1.angvel-=this.b1.iinertia*(b*this.c1.r1x-a*this.c1.r1y);c=this.b2.imass;this.b2.velx+=a*c;this.b2.vely+=b*c;this.b2.angvel+=this.b2.iinertia*(b*this.c1.r2x-a*this.c1.r2y);this.hc2&&(a=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,b=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,c=this.b1.imass,this.b1.velx-=a*c,this.b1.vely-=b*c,this.b1.angvel-=this.b1.iinertia*(b*this.c2.r1x-a*this.c2.r1y),c=this.b2.imass,this.b2.velx+=a*c,this.b2.vely+=b*c,this.b2.angvel+=this.b2.iinertia*
(b*this.c2.r2x-a*this.c2.r2y));this.b2.angvel+=this.jrAcc*this.b2.iinertia;this.b1.angvel-=this.jrAcc*this.b1.iinertia},applyImpulseVel:function(){var a,b,c,d,e;d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel);var f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);c=(f*this.nx-d*this.ny+this.surfacex)*this.c1.tMass;d=this.c1.friction*this.c1.jnAcc;a=this.c1.jtAcc;e=a-c;e>d?e=d:e<-d&&(e=-d);c=e-a;this.c1.jtAcc=e;
a=-this.ny*c;b=this.nx*c;this.b2.velx+=a*this.b2.imass;this.b2.vely+=b*this.b2.imass;this.b1.velx-=a*this.b1.imass;this.b1.vely-=b*this.b1.imass;this.b2.angvel+=this.rt1b*c*this.b2.iinertia;this.b1.angvel-=this.rt1a*c*this.b1.iinertia;this.hc2?(e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=(b*this.nx-e*this.ny+this.surfacex)*this.c2.tMass,d=this.c2.friction*
this.c2.jnAcc,a=this.c2.jtAcc,e=a-c,e>d?e=d:e<-d&&(e=-d),c=e-a,this.c2.jtAcc=e,a=-this.ny*c,b=this.nx*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rt2b*c*this.b2.iinertia,this.b1.angvel-=this.rt2a*c*this.b1.iinertia,d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),e=
this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=this.c1.jnAcc,a=this.c2.jnAcc,d=d*this.nx+f*this.ny+this.surfacey+this.c1.bounce-(this.Ka*c+this.Kb*a),e=e*this.nx+b*this.ny+this.surfacey+this.c2.bounce-(this.Kb*c+this.Kc*a),b=-(this.kMassa*d+this.kMassb*e),f=-(this.kMassb*d+this.kMassc*e),0<=b&&0<=f?(d=b-c,e=f-a,this.c1.jnAcc=b,this.c2.jnAcc=f):(b=-this.c1.nMass*
d,0<=b&&0<=this.Kb*b+e?(d=b-c,e=-a,this.c1.jnAcc=b,this.c2.jnAcc=0):(f=-this.c2.nMass*e,0<=f&&0<=this.Kb*f+d?(d=-c,e=f-a,this.c1.jnAcc=0,this.c2.jnAcc=f):0<=d&&0<=e?(d=-c,e=-a,this.c1.jnAcc=this.c2.jnAcc=0):e=d=0)),c=d+e,a=this.nx*c,b=this.ny*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=(this.rn1b*d+this.rn2b*e)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*d+this.rn2a*e)*this.b1.iinertia):(0!=this.radius&&
(c=(this.b2.angvel-this.b1.angvel)*this.rMass,d=this.rfric*this.c1.jnAcc,a=this.jrAcc,this.jrAcc-=c,this.jrAcc>d?this.jrAcc=d:this.jrAcc<-d&&(this.jrAcc=-d),c=this.jrAcc-a,this.b2.angvel+=c*this.b2.iinertia,this.b1.angvel-=c*this.b1.iinertia),d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),f=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),c=(this.c1.bounce+(this.nx*d+this.ny*f)+this.surfacey)*this.c1.nMass,a=this.c1.jnAcc,
e=a-c,0>e&&(e=0),c=e-a,this.c1.jnAcc=e,a=this.nx*c,b=this.ny*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rn1b*c*this.b2.iinertia,this.b1.angvel-=this.rn1a*c*this.b1.iinertia)},applyImpulsePos:function(){if(2==this.ptype){var a=this.c1,b=0,c=0,b=this.b2.axisy*a.lr2x-this.b2.axisx*a.lr2y,c=a.lr2x*this.b2.axisx+a.lr2y*this.b2.axisy,b=b+1*this.b2.posx,c=c+1*this.b2.posy,d=0,e=0,d=this.b1.axisy*a.lr1x-this.b1.axisx*
a.lr1y,e=a.lr1x*this.b1.axisx+a.lr1y*this.b1.axisy,d=d+1*this.b1.posx,e=e+1*this.b1.posy,f=a=0,a=b-d,f=c-e,h=Math.sqrt(a*a+f*f),g=this.radius-p.collisionSlop,k=h-g;0>a*this.nx+f*this.ny&&(a=-a,f=-f,k-=this.radius);0>k&&(h<p.epsilon?0!=this.b1.smass?this.b1.posx+=10*p.epsilon:this.b2.posx+=10*p.epsilon:(k=1/h,a*=k,f*=k,b=.5*(d+b),c=.5*(e+c),d=b-this.b1.posx,e=c-this.b1.posy,b-=this.b2.posx,c-=this.b2.posy,d=f*d-a*e,b=f*b-a*c,c=this.b2.smass+b*b*this.b2.sinertia+this.b1.smass+d*d*this.b1.sinertia,0!=
c&&(h=-this.biasCoef*(h-g)/c,c=g=0,g=a*h,c=f*h,a=this.b1.imass,this.b1.posx-=g*a,this.b1.posy-=c*a,this.b1.delta_rot(-d*this.b1.iinertia*h),a=this.b2.imass,this.b2.posx+=g*a,this.b2.posy+=c*a,this.b2.delta_rot(b*this.b2.iinertia*h))))}else{var r=k=f=a=0,e=g=0;0==this.ptype?(a=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,f=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,h=this.lproj+(a*this.b1.posx+f*this.b1.posy),k=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,r=this.c1.lr1x*this.b2.axisx+
this.c1.lr1y*this.b2.axisy,k+=1*this.b2.posx,r+=1*this.b2.posy,this.hpc2&&(g=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,g+=1*this.b2.posx,e+=1*this.b2.posy)):(a=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,f=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,h=this.lproj+(a*this.b2.posx+f*this.b2.posy),k=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,r=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,k+=1*this.b1.posx,
r+=1*this.b1.posy,this.hpc2&&(g=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,g+=1*this.b1.posx,e+=1*this.b1.posy));b=k*a+r*f-h-this.radius;b+=p.collisionSlop;c=0;this.hpc2&&(c=g*a+e*f-h-this.radius,c+=p.collisionSlop);if(0>b||0>c){this.rev&&(a=-a,f=-f);var n=0,m=0,n=k-this.b1.posx,m=r-this.b1.posy,d=h=0,h=k-this.b2.posx,d=r-this.b2.posy,t=0,w=0,r=k=0;if(this.hpc2){t=g-this.b1.posx;w=e-this.b1.posy;k=g-this.b2.posx;r=e-this.b2.posy;g=
f*n-a*m;h=f*h-a*d;e=f*t-a*w;d=f*k-a*r;k=this.b1.smass+this.b2.smass;this.kMassa=k+this.b1.sinertia*g*g+this.b2.sinertia*h*h;this.kMassb=k+this.b1.sinertia*g*e+this.b2.sinertia*h*d;this.kMassc=k+this.b1.sinertia*e*e+this.b2.sinertia*d*d;r=k=n=0;n=this.kMassa;k=this.kMassb;r=this.kMassc;m=b*this.biasCoef;t=c*this.biasCoef;c=b=0;b=-m;c=-t;w=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(w!=w)b=c=0;else if(0==w)b=0!=this.kMassa?b/this.kMassa:0,c=0!=this.kMassc?c/this.kMassc:0;else var w=1/w,q=w*(this.kMassc*
b-this.kMassb*c),c=w*(this.kMassa*c-this.kMassb*b),b=q;0<=b&&0<=c?(k=(b+c)*this.b1.imass,this.b1.posx-=a*k,this.b1.posy-=f*k,this.b1.delta_rot(-this.b1.iinertia*(g*b+e*c)),g=(b+c)*this.b2.imass,this.b2.posx+=a*g,this.b2.posy+=f*g,this.b2.delta_rot(this.b2.iinertia*(h*b+d*c))):(b=-m/n,c=0,n=k*b+t,0<=b&&0<=n?(k=(b+c)*this.b1.imass,this.b1.posx-=a*k,this.b1.posy-=f*k,this.b1.delta_rot(-this.b1.iinertia*(g*b+e*c)),g=(b+c)*this.b2.imass,this.b2.posx+=a*g,this.b2.posy+=f*g,this.b2.delta_rot(this.b2.iinertia*
(h*b+d*c))):(b=0,c=-t/r,k=k*c+m,0<=c&&0<=k&&(k=(b+c)*this.b1.imass,this.b1.posx-=a*k,this.b1.posy-=f*k,this.b1.delta_rot(-this.b1.iinertia*(g*b+e*c)),g=(b+c)*this.b2.imass,this.b2.posx+=a*g,this.b2.posy+=f*g,this.b2.delta_rot(this.b2.iinertia*(h*b+d*c)))))}else g=f*n-a*m,h=f*h-a*d,c=this.b2.smass+h*h*this.b2.sinertia+this.b1.smass+g*g*this.b1.sinertia,0!=c&&(b=-this.biasCoef*b/c,d=c=0,c=a*b,d=f*b,a=this.b1.imass,this.b1.posx-=c*a,this.b1.posy-=d*a,this.b1.delta_rot(-g*this.b1.iinertia*b),a=this.b2.imass,
this.b2.posx+=c*a,this.b2.posy+=d*a,this.b2.delta_rot(h*this.b2.iinertia*b))}}},__class__:Ea});var M=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.dist=this.elasticity=0;this.fresh=!1;this.stamp=this.hash=0;this.active=this.posOnly=!1;this.arbiter=this.inner=null;this.px=this.py=0;this.outer=null;this.inner=new Ad};M.__name__=!0;M.prototype={wrapper:function(){null==this.outer&&(M.internal=!0,this.outer=new he,M.internal=!1,this.outer.zpp_inner=this);return this.outer},
inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=
!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:M};var Ad=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.r1x=this.r1y=this.r2x=this.r2y=this.nMass=this.tMass=this.bounce=this.friction=this.jnAcc=this.jtAcc=this.lr1x=this.lr1y=this.lr2x=this.lr2y=0};Ad.__name__=!0;Ad.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},
inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Ad};var ia=function(){this.collisionGroup=this.collisionMask=this.sensorGroup=this.sensorMask=this.fluidGroup=this.fluidMask=
0;this.next=this.outer=this.shapes=null;this.shapes=new jc;this.collisionGroup=this.sensorGroup=this.fluidGroup=1;this.collisionMask=this.sensorMask=this.fluidMask=-1};ia.__name__=!0;ia.prototype={wrapper:function(){if(null==this.outer){this.outer=new wd;var a=this.outer.zpp_inner;a.outer=null;a.next=ia.zpp_pool;ia.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},shouldCollide:function(a){return 0!=(this.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&this.collisionGroup)},shouldSense:function(a){return 0!=
(this.sensorMask&a.sensorGroup)&&0!=(a.sensorMask&this.sensorGroup)},shouldFlow:function(a){return 0!=(this.fluidMask&a.fluidGroup)&&0!=(a.fluidMask&this.fluidGroup)},invalidate:function(){for(var a=this.shapes.head;null!=a;)a.elt.invalidate_filter(),a=a.next},__class__:ia};var Rd=function(){this.depth=0;this.group=this.groups=this.interactors=null;this.ignore=!1;this.outer=null;this.depth=0;this.groups=new Bd;this.interactors=new ec};Rd.__name__=!0;Rd.prototype={invalidate:function(a){null==a&&(a=
!1);if(a||this.ignore){for(var b=this.interactors.head;null!=b;){var c=b.elt;null!=c.ibody?c.ibody.wake():null!=c.ishape?c.ishape.body.wake():c.icompound.wake();b=b.next}for(b=this.groups.head;null!=b;)b.elt.invalidate(a),b=b.next}},__class__:Rd};var la=function(){this.wrap_max=null;this.maxx=this.maxy=0;this.wrap_min=null;this.minx=this.miny=0;this.outer=this.next=null;this._immutable=!1;this._invalidate=this._validate=null};la.__name__=!0;la.get=function(a,b,c,d){var e;null==la.zpp_pool?e=new la:
(e=la.zpp_pool,la.zpp_pool=e.next,e.next=null);null;e.minx=a;e.miny=b;e.maxx=c;e.maxy=d;return e};la.prototype={validate:function(){null!=this._validate&&this._validate()},perimeter:function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},intersectY:function(a){return!(a.miny>this.maxy||this.miny>a.maxy)},intersect:function(a){return a.miny<=this.maxy&&this.miny<=a.maxy&&a.minx<=this.maxx&&this.minx<=a.maxx},combine:function(a){a.minx<this.minx&&(this.minx=a.minx);a.maxx>this.maxx&&(this.maxx=
a.maxx);a.miny<this.miny&&(this.miny=a.miny);a.maxy>this.maxy&&(this.maxy=a.maxy)},contains:function(a){return a.minx>=this.minx&&a.miny>=this.miny&&a.maxx<=this.maxx&&a.maxy<=this.maxy},setCombine:function(a,b){this.minx=a.minx<b.minx?a.minx:b.minx;this.miny=a.miny<b.miny?a.miny:b.miny;this.maxx=a.maxx>b.maxx?a.maxx:b.maxx;this.maxy=a.maxy>b.maxy?a.maxy:b.maxy},setExpand:function(a,b){this.minx=a.minx-b;this.miny=a.miny-b;this.maxx=a.maxx+b;this.maxy=a.maxy+b},toString:function(){return"{ x: "+this.minx+
" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:la};var ld=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};ld.__name__=!0;ld.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Fa.zpp_pool?b=new Fa:(b=Fa.zpp_pool,Fa.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,
b){var c;null==Fa.zpp_pool?c=new Fa:(c=Fa.zpp_pool,Fa.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Fa.zpp_pool;Fa.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=
this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Fa.zpp_pool;Fa.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},
__class__:ld};var q=function(){};q.__name__=!0;q.contactCollide=function(a,b,c,d){if(b.type==f.id_ShapeType_POLYGON)if(a.type==f.id_ShapeType_POLYGON){for(var e=!0,l=-1E100,h=-1,g=null,k=null,r=a.polygon.edges.head;null!=r;){for(var n=r.elt,m=1E100,t=b.polygon.gverts.next;null!=t;){var w=t,w=n.gnormx*w.x+n.gnormy*w.y;w<m&&(m=w);if(m-n.gprojection<=l)break;t=t.next}m-=n.gprojection;if(0<=m){e=!1;break}m>l&&(l=m,g=n,h=1);r=r.next}if(e){for(r=b.polygon.edges.head;null!=r;){n=r.elt;m=1E100;for(t=a.polygon.gverts.next;null!=
t;){w=t;w=n.gnormx*w.x+n.gnormy*w.y;w<m&&(m=w);if(m-n.gprojection<=l)break;t=t.next}m-=n.gprojection;if(0<=m){e=!1;break}m>l&&(l=m,k=n,h=2);r=r.next}if(e){1==h?(a=b.polygon,b=g,k=1):(a=a.polygon,b=k,k=-1);g=null;e=1E100;for(l=a.edges.head;null!=l;)r=l.elt,n=b.gnormx*r.gnormx+b.gnormy*r.gnormy,n<e&&(e=n,g=r),l=l.next;var l=e=0,e=g.gp0.x,l=g.gp0.y,n=r=0,r=g.gp1.x,n=g.gp1.y,t=m=0,m=r-e,t=n-l,q=b.gnormy*e-b.gnormx*l,w=b.gnormy*r-b.gnormx*n,F=1/(w-q),q=(-b.tp1-q)*F;q>p.epsilon&&(e+=m*q,l+=t*q);w=(-b.tp0-
w)*F;w<-p.epsilon&&(r+=m*w,n+=t*w);t=m=0;t=k;m=b.gnormx*t;t*=b.gnormy;c.lnormx=b.lnormx;c.lnormy=b.lnormy;c.lproj=b.lprojection;c.radius=0;c.rev=d!=(-1==k);c.ptype=c.rev?1:0;w=e*b.gnormx+l*b.gnormy-b.gprojection;k=r*b.gnormx+n*b.gnormy-b.gprojection;if(0<w&&0<k)return!1;d&&(m=-m,t=-t);d=c.injectContact(e-b.gnormx*w*.5,l-b.gnormy*w*.5,m,t,w,c.rev?1:0,0<w);e-=1*a.body.posx;l-=1*a.body.posy;d.inner.lr1x=e*a.body.axisy+l*a.body.axisx;d.inner.lr1y=l*a.body.axisy-e*a.body.axisx;d=c.injectContact(r-b.gnormx*
k*.5,n-b.gnormy*k*.5,m,t,k,c.rev?0:1,0<k);r-=1*a.body.posx;n-=1*a.body.posy;d.inner.lr1x=r*a.body.axisy+n*a.body.axisx;d.inner.lr1y=n*a.body.axisy-r*a.body.axisx;1==h?(c.__ref_edge1=b,c.__ref_edge2=g):(c.__ref_edge2=b,c.__ref_edge1=g);return!0}}}else{k=-1E100;g=!0;e=h=null;l=b.polygon.gverts.next;for(r=b.polygon.edges.head;null!=r;){n=r.elt;m=n.gnormx*a.circle.worldCOMx+n.gnormy*a.circle.worldCOMy-n.gprojection-a.circle.radius;if(0<m){g=!1;break}m>k&&(k=m,h=n,e=l);l=l.next;r=r.next}if(g){g=e;e=null==
e.next?b.polygon.gverts.next:e.next;l=a.circle.worldCOMy*h.gnormx-a.circle.worldCOMx*h.gnormy;if(l<=g.y*h.gnormx-g.x*h.gnormy)return k=a.circle.radius,l=e=0,e=g.x-a.circle.worldCOMx,l=g.y-a.circle.worldCOMy,r=e*e+l*l,r>k*k?k=null:r<p.epsilon*p.epsilon?k=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-k,0,null):(r=1/Math.sqrt(r),n=r<p.epsilon?1E100:1/r,m=.5+(a.circle.radius-.5*k)*r,k=d?c.injectContact(a.circle.worldCOMx+e*m,a.circle.worldCOMy+l*m,-e*r,-l*r,n-k,0,null):c.injectContact(a.circle.worldCOMx+
e*m,a.circle.worldCOMy+l*m,e*r,l*r,n-k,0,null)),null!=k&&(e=k.inner,c.ptype=2,r=l=0,l=g.x-b.polygon.body.posx,r=g.y-b.polygon.body.posy,c.__ref_edge1=h,c.__ref_vertex=-1,d?(e.lr1x=l*b.polygon.body.axisy+r*b.polygon.body.axisx,e.lr1y=r*b.polygon.body.axisy-l*b.polygon.body.axisx,e.lr2x=a.circle.localCOMx,e.lr2y=a.circle.localCOMy):(e.lr2x=l*b.polygon.body.axisy+r*b.polygon.body.axisx,e.lr2y=r*b.polygon.body.axisy-l*b.polygon.body.axisx,e.lr1x=a.circle.localCOMx,e.lr1y=a.circle.localCOMy),c.radius=
a.circle.radius),null!=k;if(l>=e.y*h.gnormx-e.x*h.gnormy)return g=a.circle.radius,l=k=0,k=e.x-a.circle.worldCOMx,l=e.y-a.circle.worldCOMy,r=k*k+l*l,r>g*g?g=null:r<p.epsilon*p.epsilon?g=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-g,0,null):(r=1/Math.sqrt(r),n=r<p.epsilon?1E100:1/r,m=.5+(a.circle.radius-.5*g)*r,g=d?c.injectContact(a.circle.worldCOMx+k*m,a.circle.worldCOMy+l*m,-k*r,-l*r,n-g,0,null):c.injectContact(a.circle.worldCOMx+k*m,a.circle.worldCOMy+l*m,k*r,l*r,n-g,0,null)),null!=
g&&(k=g.inner,c.ptype=2,r=l=0,l=e.x-b.polygon.body.posx,r=e.y-b.polygon.body.posy,c.__ref_edge1=h,c.__ref_vertex=1,d?(k.lr1x=l*b.polygon.body.axisy+r*b.polygon.body.axisx,k.lr1y=r*b.polygon.body.axisy-l*b.polygon.body.axisx,k.lr2x=a.circle.localCOMx,k.lr2y=a.circle.localCOMy):(k.lr2x=l*b.polygon.body.axisy+r*b.polygon.body.axisx,k.lr2y=r*b.polygon.body.axisy-l*b.polygon.body.axisx,k.lr1x=a.circle.localCOMx,k.lr1y=a.circle.localCOMy),c.radius=a.circle.radius),null!=g;g=b=0;g=a.circle.radius+.5*k;b=
h.gnormx*g;g*=h.gnormy;l=e=0;e=a.circle.worldCOMx-b;l=a.circle.worldCOMy-g;b=d?c.injectContact(e,l,h.gnormx,h.gnormy,k,0,null):c.injectContact(e,l,-h.gnormx,-h.gnormy,k,0,null);c.ptype=d?0:1;c.lnormx=h.lnormx;c.lnormy=h.lnormy;c.rev=!d;c.lproj=h.lprojection;c.radius=a.circle.radius;b.inner.lr1x=a.circle.localCOMx;b.inner.lr1y=a.circle.localCOMy;c.__ref_edge1=h;c.__ref_vertex=0;return!0}}else if(h=a.circle.radius+b.circle.radius,k=g=0,g=b.circle.worldCOMx-a.circle.worldCOMx,k=b.circle.worldCOMy-a.circle.worldCOMy,
e=g*g+k*k,e>h*h?h=null:e<p.epsilon*p.epsilon?h=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-h,0,null):(e=1/Math.sqrt(e),l=e<p.epsilon?1E100:1/e,r=.5+(a.circle.radius-.5*h)*e,h=d?c.injectContact(a.circle.worldCOMx+g*r,a.circle.worldCOMy+k*r,-g*e,-k*e,l-h,0,null):c.injectContact(a.circle.worldCOMx+g*r,a.circle.worldCOMy+k*r,g*e,k*e,l-h,0,null)),null!=h)return h=h.inner,d?(h.lr1x=b.circle.localCOMx,h.lr1y=b.circle.localCOMy,h.lr2x=a.circle.localCOMx,h.lr2y=a.circle.localCOMy):(h.lr1x=a.circle.localCOMx,
h.lr1y=a.circle.localCOMy,h.lr2x=b.circle.localCOMx,h.lr2y=b.circle.localCOMy),c.radius=a.circle.radius+b.circle.radius,c.ptype=2,!0;return!1};q.testCollide_safe=function(a,b){if(b.type==f.id_ShapeType_CIRCLE){var c=a;a=b;b=c}return q.testCollide(a,b)};q.testCollide=function(a,b){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var c=!0,d=a.polygon.edges.head;null!=d;){for(var e=d.elt,l=1E100,h=b.polygon.gverts.next;null!=h;){var g=h,g=e.gnormx*g.x+e.gnormy*g.y;g<l&&(l=g);
h=h.next}l-=e.gprojection;if(0<l){c=!1;break}d=d.next}if(c){for(d=b.polygon.edges.head;null!=d;){e=d.elt;l=1E100;for(h=a.polygon.gverts.next;null!=h;)g=h,g=e.gnormx*g.x+e.gnormy*g.y,g<l&&(l=g),h=h.next;l-=e.gprojection;if(0<l){c=!1;break}d=d.next}return c}}else{d=c=null;e=!0;l=-1E100;h=b.polygon.gverts.next;for(g=b.polygon.edges.head;null!=g;){var k=g.elt,r=k.gnormx*a.circle.worldCOMx+k.gnormy*a.circle.worldCOMy-k.gprojection-a.circle.radius;if(0<r){e=!1;break}r>l&&(l=r,c=k,d=h);h=h.next;g=g.next}if(e)return e=
d,d=null==d.next?b.polygon.gverts.next:d.next,l=a.circle.worldCOMy*c.gnormx-a.circle.worldCOMx*c.gnormy,l<=e.y*c.gnormx-e.x*c.gnormy?(c=a.circle.radius,l=d=0,d=e.x-a.circle.worldCOMx,l=e.y-a.circle.worldCOMy,d*d+l*l<=c*c):l>=d.y*c.gnormx-d.x*c.gnormy?(c=a.circle.radius,l=e=0,e=d.x-a.circle.worldCOMx,l=d.y-a.circle.worldCOMy,e*e+l*l<=c*c):!0}return!1}c=a.circle.radius+b.circle.radius;e=d=0;d=b.circle.worldCOMx-a.circle.worldCOMx;e=b.circle.worldCOMy-a.circle.worldCOMy;return d*d+e*e<=c*c};q.flowCollide=
function(a,b,c){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var d=[],e=[],l=!0,h=!0,g=a.polygon.edges.head;null!=g;){for(var k=g.elt,r=1E100,n=0,m=b.polygon.gverts.next;null!=m;){var t=m,w=k.gnormx*t.x+k.gnormy*t.y;w<r&&(r=w);w>=k.gprojection+p.epsilon&&(e[n]=!0,h=!1);n++;m=m.next}r-=k.gprojection;if(0<r){l=!1;break}g=g.next}if(h)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,null,!0;if(l){for(var h=
!0,x=b.polygon.edges.head;null!=x;){for(var F=x.elt,B=1E100,z=0,v=a.polygon.gverts.next;null!=v;){var C=v,E=F.gnormx*C.x+F.gnormy*C.y;E<B&&(B=E);E>=F.gprojection+p.epsilon&&(d[z]=!0,h=!1);z++;v=v.next}B-=F.gprojection;if(0<B){l=!1;break}x=x.next}if(h)return a.polygon.validate_worldCOM(),c.overlap=a.polygon.area,c.centroidx=a.polygon.worldCOMx,c.centroidy=a.polygon.worldCOMy,null,!0;if(l){for(;null!=q.flowpoly.head;){var I=q.flowpoly.pop_unsafe();if(!I._inuse){var H=I;null!=H.outer&&(H.outer.zpp_inner=
null,H.outer=null);H._isimmutable=null;H._validate=null;H._invalidate=null;H.next=D.zpp_pool;D.zpp_pool=H}}for(var X=null,G=!1,nb=a.polygon.gverts.next,A=0,R=b.polygon.gverts.next,K=0,Q=0,W=b.polygon.edgeCnt;Q<W;){var oa=Q++;if(e[oa])R=R.next;else{K=oa;break}}if(null==R){for(var R=b.polygon.gverts.next,G=!0,U=0,la=a.polygon.edgeCnt;U<la;){var Ca=U++;if(d[Ca])nb=nb.next;else{A=Ca;break}}null==nb?nb=a.polygon.gverts.next:(q.flowpoly.add(nb),X=q.flowpoly.head.elt)}else q.flowpoly.add(R),X=q.flowpoly.head.elt;
var O=1;if(null==q.flowpoly.head){for(var P=!0,T=a.polygon.gverts.next,aa=T,N=T.next;null!=N;){for(var M=N,Y=2,ma=b.polygon.gverts.next,ba=ma,ca=ma.next;null!=ca;){var xe=ca,ia=0;(function(a){var b=a=0;a=aa.x-ba.x;var b=aa.y-ba.y,c=0,d=0,c=M.x-aa.x,d=M.y-aa.y,e=0,f=0,e=xe.x-ba.x,f=xe.y-ba.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(ia=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&ia<Y&&(Y=ia,R=ma);ma=ca;ba=xe;ca=ca.next}var Ae=
ca=b.polygon.gverts.next,za=0;(function(a){var b=a=0;a=aa.x-ba.x;var b=aa.y-ba.y,c=0,d=0,c=M.x-aa.x,d=M.y-aa.y,e=0,f=0,e=Ae.x-ba.x,f=Ae.y-ba.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(za=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&za<Y&&(Y=za,R=ma);if(2!=Y){var gb=0,u=0,xa=Y,gb=aa.x+(M.x-aa.x)*xa,u=aa.y+(M.y-aa.y)*xa,X=D.get(gb,u,null);q.flowpoly.add(X);G=!0;nb=T;P=!1;break}T=N;aa=M;N=N.next}if(P){for(var da=N=a.polygon.gverts.next,
vb=2,Z=b.polygon.gverts.next,md=Z,ra=Z.next;null!=ra;){var cb=ra,S=0;(function(a){var b=a=0;a=aa.x-md.x;var b=aa.y-md.y,c=0,d=0,c=da.x-aa.x,d=da.y-aa.y,e=0,f=0,e=cb.x-md.x,f=cb.y-md.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(S=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&S<vb&&(vb=S,R=Z);Z=ra;md=cb;ra=ra.next}var Ea=ra=b.polygon.gverts.next,ea=0;(function(a){var b=a=0;a=aa.x-md.x;var b=aa.y-md.y,c=0,d=0,c=da.x-aa.x,
d=da.y-aa.y,e=0,f=0,e=Ea.x-md.x,f=Ea.y-md.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(ea=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&ea<vb&&(vb=ea,R=Z);if(2!=vb){var wa=0,na=0,Aa=vb,wa=aa.x+(da.x-aa.x)*Aa,na=aa.y+(da.y-aa.y)*Aa,X=D.get(wa,na,null);q.flowpoly.add(X);G=!0;nb=T}}O=2}for(;;)if(G)if(nb=nb.next,A++,null==nb&&(nb=a.polygon.gverts.next,A=0),d[A]){var Cd=q.flowpoly.head.elt,Za=nb,db=R,ob=R.next;null==ob&&(ob=
b.polygon.gverts.next);var Yd=-1,ie=null,ye=0,Be=0,ze=ob,Na=ob;do{var Ra=Na,ue=0;if(function(a){var b=a=0;a=db.x-Cd.x;var b=db.y-Cd.y,c=0,d=0,c=Ra.x-db.x,d=Ra.y-db.y,e=0,f=0,e=Za.x-Cd.x,f=Za.y-Cd.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(ue=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&ue>=Yd)if(ie=R,ye=K,++Be==O){Yd=ue;Na=ze;break}else Yd=ue;db=Ra;R=Na;K++;K>=b.polygon.edgeCnt&&(K=0);Na=Na.next;null==Na&&(Na=b.polygon.gverts.next)}while(0);
for(;Na!=ze;){var $a=Na,ga=0;if(function(a){var b=a=0;a=db.x-Cd.x;var b=db.y-Cd.y,c=0,d=0,c=$a.x-db.x,d=$a.y-db.y,e=0,f=0,e=Za.x-Cd.x,f=Za.y-Cd.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(ga=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&ga>=Yd)if(ie=R,ye=K,++Be==O){Yd=ga;Na=ze;break}else Yd=ga;db=$a;R=Na;K++;K>=b.polygon.edgeCnt&&(K=0);Na=Na.next;null==Na&&(Na=b.polygon.gverts.next)}if(null==ie)break;var ya=ie,J=ie.next;
null==J&&(J=b.polygon.gverts.next);var Ya=J,y=0,ka=0,Fa=Yd,y=ya.x+(Ya.x-ya.x)*Fa,ka=ya.y+(Ya.y-ya.y)*Fa;if(null!=X&&eb.vec_dsq(y,ka,X.x,X.y)<p.epsilon)break;q.flowpoly.add(D.get(y,ka,null));null==X&&(X=q.flowpoly.head.elt);R=ie;K=ye;G=!G;O=2}else{var Ga=nb;if(null!=X&&eb.vec_dsq(Ga.x,Ga.y,X.x,X.y)<p.epsilon)break;q.flowpoly.add(Ga);null==X&&(X=q.flowpoly.head.elt);O=1}else if(R=R.next,K++,null==R&&(R=b.polygon.gverts.next,K=0),e[K]){var Dd=q.flowpoly.head.elt,Ha=R,$b=nb,Qa=nb.next;null==Qa&&(Qa=a.polygon.gverts.next);
var Zd=-1,fa=null,sa=0,Ja=0,ab=Qa,pb=Qa;do{var ua=pb,va=0;if(function(a){var b=a=0;a=$b.x-Dd.x;var b=$b.y-Dd.y,c=0,d=0,c=ua.x-$b.x,d=ua.y-$b.y,e=0,f=0,e=Ha.x-Dd.x,f=Ha.y-Dd.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(va=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&va>=Zd)if(fa=nb,sa=A,++Ja==O){Zd=va;pb=ab;break}else Zd=va;$b=ua;nb=pb;A++;A>=a.polygon.edgeCnt&&(A=0);pb=pb.next;null==pb&&(pb=a.polygon.gverts.next)}while(0);
for(;pb!=ab;){var ha=pb,La=0;if(function(a){var b=a=0;a=$b.x-Dd.x;var b=$b.y-Dd.y,c=0,d=0,c=ha.x-$b.x,d=ha.y-$b.y,e=0,f=0,e=Ha.x-Dd.x,f=Ha.y-Dd.y,l=d*e-c*f;l*l>p.epsilon*p.epsilon?(l=1/l,e=(f*a-e*b)*l,e>p.epsilon&&e<1-p.epsilon?(a=(d*a-c*b)*l,a>p.epsilon&&a<1-p.epsilon?(La=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&La>=Zd)if(fa=nb,sa=A,++Ja==O){Zd=La;pb=ab;break}else Zd=La;$b=ha;nb=pb;A++;A>=a.polygon.edgeCnt&&(A=0);pb=pb.next;null==pb&&(pb=a.polygon.gverts.next)}if(null==fa)break;var Ma=fa,Ba=fa.next;
null==Ba&&(Ba=a.polygon.gverts.next);var ib=Ba,wb=0,xb=0,Ce=Zd,wb=Ma.x+(ib.x-Ma.x)*Ce,xb=Ma.y+(ib.y-Ma.y)*Ce;if(null!=X&&eb.vec_dsq(wb,xb,X.x,X.y)<p.epsilon)break;q.flowpoly.add(D.get(wb,xb,null));null==X&&(X=q.flowpoly.head.elt);nb=fa;A=sa;G=!G;O=2}else{var vc=R;if(null!=X&&eb.vec_dsq(vc.x,vc.y,X.x,X.y)<p.epsilon)break;q.flowpoly.add(vc);null==X&&(X=q.flowpoly.head.elt);O=1}if(null!=q.flowpoly.head&&null!=q.flowpoly.head.next&&null!=q.flowpoly.head.next.next){for(var Bb=0,Rc=0,Sc=0,Bb=Sc=Rc=0,yb=
q.flowpoly.head,Da=yb.elt,yb=yb.next,fb=yb.elt,yb=yb.next;null!=yb;)var ja=yb.elt,Bb=Bb+fb.x*(ja.y-Da.y),mb=ja.y*fb.x-ja.x*fb.y,Rc=Rc+(fb.x+ja.x)*mb,Sc=Sc+(fb.y+ja.y)*mb,Da=fb,fb=ja,yb=yb.next;var yb=q.flowpoly.head,ta=yb.elt,Bb=Bb+fb.x*(ta.y-Da.y),Eb=ta.y*fb.x-ta.x*fb.y,Rc=Rc+(fb.x+ta.x)*Eb,Sc=Sc+(fb.y+ta.y)*Eb,Da=fb,fb=ta,yb=yb.next,Ia=yb.elt,Bb=Bb+fb.x*(Ia.y-Da.y),Gb=Ia.y*fb.x-Ia.x*fb.y,Rc=Rc+(fb.x+Ia.x)*Gb,Sc=Sc+(fb.y+Ia.y)*Gb,Bb=.5*Bb,Hb=1/(6*Bb),Rc=Rc*Hb,Sc=Sc*Hb;c.overlap=-Bb;c.centroidx=Rc;
c.centroidy=Sc;null;return!0}}}return!1}for(var jb=[],Ib=!0,pa=null,Sa=null,Jb=-1E100,Kb=!0,Va=b.polygon.gverts.next,Lb=0,qa=b.polygon.edges.head;null!=qa;){var Wa=qa.elt,Xa=Wa.gnormx*a.circle.worldCOMx+Wa.gnormy*a.circle.worldCOMy;if(Xa>Wa.gprojection+a.circle.radius){Kb=!1;break}else Xa+a.circle.radius>Wa.gprojection+p.epsilon&&(Ib=!1,jb[Lb]=!0);Xa-=Wa.gprojection+a.circle.radius;Xa>Jb&&(Jb=Xa,pa=Wa,Sa=Va);Va=Va.next;Lb++;qa=qa.next}if(Kb){if(Ib)return c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,
c.centroidy=a.circle.worldCOMy,null,!0;var Oa=Sa,hb;hb=null==Sa.next?b.polygon.gverts.next:Sa.next;var Pb=a.circle.worldCOMy*pa.gnormx-a.circle.worldCOMx*pa.gnormy;if(Pb<=Oa.y*pa.gnormx-Oa.x*pa.gnormy?function(b){b=a.circle.radius;var c=0,d=0,c=Oa.x-a.circle.worldCOMx,d=Oa.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):Pb>=hb.y*pa.gnormx-hb.x*pa.gnormy?function(b){b=a.circle.radius;var c=0,d=0,c=hb.x-a.circle.worldCOMx,d=hb.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):1){for(var bb=[],Fb=0,Tb=
!0,Ab=null,wc=0,Ka=b.polygon.gverts.next;null!=Ka;){var Ub=Ka,ec=eb.vec_dsq(Ub.x,Ub.y,a.circle.worldCOMx,a.circle.worldCOMy);(bb[Fb]=ec<=a.circle.radius*a.circle.radius)?(wc=Fb,Ab=Ka):Tb=!1;Fb++;Ka=Ka.next}if(Tb)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,null,!0;for(;null!=q.flowpoly.head;){var Xb=q.flowpoly.pop_unsafe();if(!Xb._inuse){var Ta=Xb;null!=Ta.outer&&(Ta.outer.zpp_inner=null,Ta.outer=null);Ta._isimmutable=
null;Ta._validate=null;Ta._invalidate=null;Ta.next=D.zpp_pool;D.zpp_pool=Ta}}q.flowsegs.clear();var qb=null,kc=1;null==Ab?(Ab=b.polygon.gverts.next,kc=2):q.flowpoly.add(qb=Ab);for(;0!=kc;)if(1==kc)if(Ab=Ab.next,null==Ab&&(Ab=b.polygon.gverts.next),wc++,wc>=b.polygon.edgeCnt&&(wc=0),bb[wc]){if(eb.vec_dsq(qb.x,qb.y,Ab.x,Ab.y)<p.epsilon)break;q.flowpoly.add(Ab)}else{var V=q.flowpoly.head.elt,Ua=Ab,kb=0,lb=0,kb=Ua.x-V.x,lb=Ua.y-V.y,Db=0,Mb=0,Db=V.x-a.circle.worldCOMx,Mb=V.y-a.circle.worldCOMy,ub=kb*kb+
lb*lb,Nb=2*(Db*kb+Mb*lb),mc=Math.sqrt(Nb*Nb-4*ub*(Db*Db+Mb*Mb-a.circle.radius*a.circle.radius)),ub=1/(2*ub),nc=(-Nb-mc)*ub,ac=0,bc=0,oc=nc<p.epsilon?(-Nb+mc)*ub:nc,ac=V.x+(Ua.x-V.x)*oc,bc=V.y+(Ua.y-V.y)*oc;if(eb.vec_dsq(qb.x,qb.y,ac,bc)<p.epsilon)break;q.flowpoly.add(D.get(ac,bc,null));kc=2}else if(2==kc){var Qb=Ab.next;null==Qb&&(Qb=b.polygon.gverts.next);var L=Ab,kc=0,Pa=Qb,rb=Qb;do{var xc=rb,Rb=wc+1;Rb==b.polygon.edgeCnt&&(Rb=0);if(jb[wc])if(bb[Rb]){var Vb=0,Wb=0,Vb=xc.x-L.x,Wb=xc.y-L.y,Yb=0,Zb=
0,Yb=L.x-a.circle.worldCOMx,Zb=L.y-a.circle.worldCOMy,Ob=Vb*Vb+Wb*Wb,cc=2*(Yb*Vb+Zb*Wb),Fc=Math.sqrt(cc*cc-4*Ob*(Yb*Yb+Zb*Zb-a.circle.radius*a.circle.radius)),Ob=1/(2*Ob),Gc=(-cc-Fc)*Ob,rc=0,sc=0,Jc=Gc<p.epsilon?(-cc+Fc)*Ob:Gc,rc=L.x+(xc.x-L.x)*Jc,sc=L.y+(xc.y-L.y)*Jc;if(eb.vec_dsq(qb.x,qb.y,rc,sc)<p.epsilon){kc=0;rb=Pa;break}var Kc=D.get(rc,sc,null);q.flowsegs.add(q.flowpoly.head.elt);q.flowsegs.add(Kc);q.flowpoly.add(Kc);kc=1;rb=Pa;break}else{var fc=0,gc=0,tc,hc=0,ic=0,hc=xc.x-L.x,ic=xc.y-L.y,jc=
0,pc=0,jc=L.x-a.circle.worldCOMx,pc=L.y-a.circle.worldCOMy,Sb=hc*hc+ic*ic,dc=2*(jc*hc+pc*ic),$d=dc*dc-4*Sb*(jc*jc+pc*pc-a.circle.radius*a.circle.radius);$d*$d<p.epsilon?(fc=0>$d?10:gc=-dc/(2*Sb),tc=!1):($d=Math.sqrt($d),Sb=1/(2*Sb),fc=(-dc-$d)*Sb,gc=(-dc+$d)*Sb,tc=!0);if(fc<1-p.epsilon&&gc>p.epsilon){var Hc=0,Ic=0,$c=fc,Hc=L.x+(xc.x-L.x)*$c,Ic=L.y+(xc.y-L.y)*$c;if(null!=qb&&eb.vec_dsq(qb.x,qb.y,Hc,Ic)<p.epsilon){kc=0;rb=Pa;break}var ad=D.get(Hc,Ic,null);null!=q.flowpoly.head&&(q.flowsegs.add(q.flowpoly.head.elt),
q.flowsegs.add(ad));q.flowpoly.add(ad);null==qb&&(qb=q.flowpoly.head.elt);if(tc){var bd=0,fd=0,ld=gc,bd=L.x+(xc.x-L.x)*ld,fd=L.y+(xc.y-L.y)*ld;q.flowpoly.add(D.get(bd,fd,null))}}}L=xc;Ab=rb;wc=Rb;rb=rb.next;null==rb&&(rb=b.polygon.gverts.next)}while(0);for(;rb!=Pa;){var yc=rb,zc=wc+1;zc==b.polygon.edgeCnt&&(zc=0);if(jb[wc])if(bb[zc]){var Ac=0,Bc=0,Ac=yc.x-L.x,Bc=yc.y-L.y,Cc=0,Dc=0,Cc=L.x-a.circle.worldCOMx,Dc=L.y-a.circle.worldCOMy,qc=Ac*Ac+Bc*Bc,Ec=2*(Cc*Ac+Dc*Bc),sd=Math.sqrt(Ec*Ec-4*qc*(Cc*Cc+
Dc*Dc-a.circle.radius*a.circle.radius)),qc=1/(2*qc),td=(-Ec-sd)*qc,Yc=0,Zc=0,ud=td<p.epsilon?(-Ec+sd)*qc:td,Yc=L.x+(yc.x-L.x)*ud,Zc=L.y+(yc.y-L.y)*ud;if(eb.vec_dsq(qb.x,qb.y,Yc,Zc)<p.epsilon){kc=0;rb=Pa;break}var vd=D.get(Yc,Zc,null);q.flowsegs.add(q.flowpoly.head.elt);q.flowsegs.add(vd);q.flowpoly.add(vd);kc=1;rb=Pa;break}else{var Lc=0,Mc=0,cd,Nc=0,Oc=0,Nc=yc.x-L.x,Oc=yc.y-L.y,Pc=0,Qc=0,Pc=L.x-a.circle.worldCOMx,Qc=L.y-a.circle.worldCOMy,je=Nc*Nc+Oc*Oc,uc=2*(Pc*Nc+Qc*Oc),ae=uc*uc-4*je*(Pc*Pc+Qc*
Qc-a.circle.radius*a.circle.radius);ae*ae<p.epsilon?(Lc=0>ae?10:Mc=-uc/(2*je),cd=!1):(ae=Math.sqrt(ae),je=1/(2*je),Lc=(-uc-ae)*je,Mc=(-uc+ae)*je,cd=!0);if(Lc<1-p.epsilon&&Mc>p.epsilon){var gd=0,hd=0,xd=Lc,gd=L.x+(yc.x-L.x)*xd,hd=L.y+(yc.y-L.y)*xd;if(null!=qb&&eb.vec_dsq(qb.x,qb.y,gd,hd)<p.epsilon){kc=0;rb=Pa;break}var yd=D.get(gd,hd,null);null!=q.flowpoly.head&&(q.flowsegs.add(q.flowpoly.head.elt),q.flowsegs.add(yd));q.flowpoly.add(yd);null==qb&&(qb=q.flowpoly.head.elt);if(cd){var zd=0,Ad=0,Ed=Mc,
zd=L.x+(yc.x-L.x)*Ed,Ad=L.y+(yc.y-L.y)*Ed;q.flowpoly.add(D.get(zd,Ad,null))}}}L=yc;Ab=rb;wc=zc;rb=rb.next;null==rb&&(rb=b.polygon.gverts.next)}}if(null==q.flowpoly.head)return!1;if(null==q.flowpoly.head.next){for(var Hd=!0,Xc=b.polygon.edges.head;null!=Xc;){var rd=Xc.elt;if(rd.gnormx*a.circle.worldCOMx+rd.gnormy*a.circle.worldCOMy>rd.gprojection){Hd=!1;break}Xc=Xc.next}return Hd?(c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,c.centroidy=a.circle.worldCOMy,null,!0):!1}var be=0,ce=0,ke=0;if(null!=
q.flowpoly.head.next.next){for(var lc=0,Tc=0,Uc=0,lc=Uc=Tc=0,Cb=q.flowpoly.head,pe=Cb.elt,Cb=Cb.next,sb=Cb.elt,Cb=Cb.next;null!=Cb;)var le=Cb.elt,lc=lc+sb.x*(le.y-pe.y),Jd=le.y*sb.x-le.x*sb.y,Tc=Tc+(sb.x+le.x)*Jd,Uc=Uc+(sb.y+le.y)*Jd,pe=sb,sb=le,Cb=Cb.next;var Cb=q.flowpoly.head,me=Cb.elt,lc=lc+sb.x*(me.y-pe.y),Kd=me.y*sb.x-me.x*sb.y,Tc=Tc+(sb.x+me.x)*Kd,Uc=Uc+(sb.y+me.y)*Kd,pe=sb,sb=me,Cb=Cb.next,qe=Cb.elt,lc=lc+sb.x*(qe.y-pe.y),Ld=qe.y*sb.x-qe.x*sb.y,Tc=Tc+(sb.x+qe.x)*Ld,Uc=Uc+(sb.y+qe.y)*Ld,lc=
.5*lc,Md=1/(6*lc),Tc=Tc*Md,Uc=Uc*Md,Nd=-lc,be=be+Tc*Nd,ce=ce+Uc*Nd,ke=ke-lc}else q.flowsegs.add(q.flowpoly.head.elt),q.flowsegs.add(q.flowpoly.head.next.elt);for(;null!=q.flowsegs.head;)var dd=q.flowsegs.pop_unsafe(),ed=q.flowsegs.pop_unsafe(),Od=0,Pd=0,Od=ed.x-dd.x,Pd=ed.y-dd.y,nd=0,od=0,nd=Od,od=Pd,Qd=1/Math.sqrt(nd*nd+od*od),nd=nd*Qd,od=od*Qd,he=nd,nd=-od,od=he,Vc=0,Wc=0,Vc=dd.x+ed.x,Wc=dd.y+ed.y,Vc=.5*Vc,Wc=.5*Wc,Vc=Vc-1*a.circle.worldCOMx,Wc=Wc-1*a.circle.worldCOMy,wd=0,Rd=0,Sd=nd*Vc+od*Wc,id=
Sd/a.circle.radius,re=Math.sqrt(1-id*id),Td=Math.acos(id),wd=a.circle.radius*(a.circle.radius*Td-Sd*re),Rd=.6666666666666666*a.circle.radius*re*re*re/(Td-id*re),Vc=a.circle.worldCOMx,Wc=a.circle.worldCOMy,Ud=Rd,Vc=Vc+nd*Ud,Wc=Wc+od*Ud,Vd=wd,be=be+Vc*Vd,ce=ce+Wc*Vd,ke=ke+wd;var Wd=1/ke,be=be*Wd,ce=ce*Wd;c.overlap=ke;c.centroidx=be;c.centroidy=ce;null;return!0}}return!1}var tb=a.circle,zb=b.circle,jd=0,kd=0,jd=zb.worldCOMx-tb.worldCOMx,kd=zb.worldCOMy-tb.worldCOMy,Xd=tb.radius+zb.radius,Bd=jd*jd+kd*
kd;if(Bd>Xd*Xd)return!1;if(Bd<p.epsilon*p.epsilon)tb.radius<zb.radius?(c.overlap=tb.area,c.centroidx=tb.worldCOMx,c.centroidy=tb.worldCOMy):(c.overlap=zb.area,c.centroidx=zb.worldCOMx,c.centroidy=zb.worldCOMy);else{var pd=Math.sqrt(Bd),de=1/pd,qd=.5*(pd-(zb.radius*zb.radius-tb.radius*tb.radius)*de);if(qd<=-tb.radius)c.overlap=tb.area,c.centroidx=tb.worldCOMx,c.centroidy=tb.worldCOMy;else{var Fd=pd-qd;if(Fd<=-zb.radius)c.overlap=zb.area,c.centroidx=zb.worldCOMx,c.centroidy=zb.worldCOMy;else{var Gd=
0,ee=0,Id=0,fe=0,ve=qd/tb.radius,se=Math.sqrt(1-ve*ve),ge=Math.acos(ve),Gd=tb.radius*(tb.radius*ge-qd*se),ee=.6666666666666666*tb.radius*se*se*se/(ge-ve*se),we=Fd/zb.radius,te=Math.sqrt(1-we*we),ne=Math.acos(we),Id=zb.radius*(zb.radius*ne-Fd*te),fe=.6666666666666666*zb.radius*te*te*te/(ne-we*te),oe=Gd+Id,De=(ee*Gd+(pd-fe)*Id)/oe*de;c.overlap=oe;c.centroidx=tb.worldCOMx+jd*De;c.centroidy=tb.worldCOMy+kd*De}}}null;return!0};var P=function(){this.slipped=this.failed=this.kinematic=!1;this.c1=this.c2=
this.axis=null;this.frozen1=this.frozen2=!1;this.s1=this.s2=this.arbiter=null;this.toi=0;this.next=null;this.c1=new D;this.c2=new D;this.axis=new D};P.__name__=!0;P.prototype={__class__:P};var ta=function(){};ta.__name__=!0;ta.dynamicSweep=function(a,b,c,d,e){null==e&&(e=!1);var f=a.s1,h=a.s2,g=f.body,k=h.body,r=0,n=0,r=k.velx-g.velx,n=k.vely-g.vely,m=g.angvel;0>m&&(m=-m);var t=k.angvel;0>t&&(t=-t);var w=f.sweepCoef*m+h.sweepCoef*t;if(!e&&!a.kinematic&&r*r+n*n<p.dynamicSweepLinearThreshold*p.dynamicSweepLinearThreshold&&
w<p.dynamicSweepAngularThreshold)a.toi=-1,a.failed=!0;else{for(var q=a.c1,m=a.c2,t=a.axis,x=0;;){g.sweepIntegrate(c*b);g.sweepValidate(f);k.sweepIntegrate(c*b);k.sweepValidate(h);var B=ta.distance(f,h,q,m,t,null)+d,z=r*t.x+n*t.y;if(B<p.distanceThresholdCCD){if(e)break;var v=0,C=0,v=q.x-g.posx,C=q.y-g.posy,A=0,H=0,A=m.x-k.posx,H=m.y-k.posy,v=z-g.sweep_angvel*(t.y*v-t.x*C)+k.sweep_angvel*(t.y*A-t.x*H);0<v&&(a.slipped=!0);if(0>=v||B<.5*p.distanceThresholdCCD)break}z=(w-z)*b;if(0>=z){c=-1;break}z=B/z;
1E-6>z&&(z=1E-6);c+=z;if(1<=c){c=1;g.sweepIntegrate(c*b);g.sweepValidate(f);k.sweepIntegrate(c*b);k.sweepValidate(h);b=ta.distance(f,h,q,m,t,null)+d;r=r*t.x+n*t.y;if(b<p.distanceThresholdCCD){if(e)break;n=e=0;e=q.x-g.posx;n=q.y-g.posy;d=q=0;q=m.x-k.posx;d=m.y-k.posy;g=r-g.sweep_angvel*(t.y*e-t.x*n)+k.sweep_angvel*(t.y*q-t.x*d);0<g&&(a.slipped=!0);if(0>=g||b<.5*p.distanceThresholdCCD)break}c=-1;break}if(40<=++x){B>d&&(a.failed=!0);break}}a.toi=c}};ta.staticSweep=function(a,b,c,d){var e=a.s1,f=a.s2,
h=e.body,g=0,k=0,g=-h.velx,k=-h.vely,m=h.sweep_angvel;0>m&&(m=-m);for(var n=e.sweepCoef*m,m=a.c1,q=a.c2,t=a.axis,w=0;;){h.sweepIntegrate(c*b);h.sweepValidate(e);var x=ta.distance(e,f,m,q,t,null)+d,F=g*t.x+k*t.y;if(x<p.distanceThresholdCCD){var z=0,B=0,z=m.x-h.posx,B=m.y-h.posy,z=F-h.sweep_angvel*(t.y*z-t.x*B);0<z&&(a.slipped=!0);if(0>=z||x<.5*p.distanceThresholdCCD)break}F=(n-F)*b;if(0>=F){c=-1;break}F=x/F;1E-6>F&&(F=1E-6);c+=F;if(1<=c){c=1;h.sweepIntegrate(c*b);h.sweepValidate(e);b=ta.distance(e,
f,m,q,t,null)+d;g=g*t.x+k*t.y;if(b<p.distanceThresholdCCD&&(d=k=0,k=m.x-h.posx,d=m.y-h.posy,h=g-h.sweep_angvel*(t.y*k-t.x*d),0<h&&(a.slipped=!0),0>=h||b<.5*p.distanceThresholdCCD))break;c=-1;break}if(40<=++w){x>d&&(a.failed=!0);break}}a.toi=c};ta.distance=function(a,b,c,d,e,l){null==l&&(l=1E100);if(a.type==f.id_ShapeType_CIRCLE&&b.type==f.id_ShapeType_CIRCLE){var h=a.circle,g=b.circle,k,m=0,n=0,m=g.worldCOMx-h.worldCOMx,n=g.worldCOMy-h.worldCOMy,q=Math.sqrt(m*m+n*n);k=q-(h.radius+g.radius);if(k<l){if(0==
q)m=1,n=0;else var t=1/q,m=m*t,n=n*t;var w=h.radius;c.x=h.worldCOMx+m*w;c.y=h.worldCOMy+n*w;var x=-g.radius;d.x=g.worldCOMx+m*x;d.y=g.worldCOMy+n*x;e.x=m;e.y=n}return k}var F=!1;if(a.type==f.id_ShapeType_CIRCLE&&b.type==f.id_ShapeType_POLYGON){var z=a;a=b;b=z;var B=c;c=d;d=B;F=!0}if(a.type==f.id_ShapeType_POLYGON&&b.type==f.id_ShapeType_CIRCLE){for(var v=b.circle,C=-1E100,A=null,H=a.polygon.edges.head;null!=H;){var E=H.elt,X=E.gnormx*v.worldCOMx+E.gnormy*v.worldCOMy-E.gprojection-v.radius;if(X>l){C=
X;break}0<X?X>C&&(C=X,A=E):0>C&&X>C&&(C=X,A=E);H=H.next}if(C<l){var G=A.gp0,D=A.gp1,I=v.worldCOMy*A.gnormx-v.worldCOMx*A.gnormy;if(I<=G.y*A.gnormx-G.x*A.gnormy){var R=0,K=0,R=v.worldCOMx-G.x,K=v.worldCOMy-G.y,O=Math.sqrt(R*R+K*K),C=O-v.radius;if(C<l){if(0==O)R=1,K=0;else var Q=1/O,R=R*Q,K=K*Q;c.x=G.x+0*R;c.y=G.y+0*K;var ba=-v.radius;d.x=v.worldCOMx+R*ba;d.y=v.worldCOMy+K*ba;e.x=R;e.y=K}}else if(I>=D.y*A.gnormx-D.x*A.gnormy){var M=0,N=0,M=v.worldCOMx-D.x,N=v.worldCOMy-D.y,W=Math.sqrt(M*M+N*N),C=W-
v.radius;if(C<l){if(0==W)M=1,N=0;else var oa=1/W,M=M*oa,N=N*oa;c.x=D.x+0*M;c.y=D.y+0*N;var T=-v.radius;d.x=v.worldCOMx+M*T;d.y=v.worldCOMy+N*T;e.x=M;e.y=N}}else{var U=-v.radius;d.x=v.worldCOMx+A.gnormx*U;d.y=v.worldCOMy+A.gnormy*U;var aa=-C;c.x=d.x+A.gnormx*aa;c.y=d.y+A.gnormy*aa;e.x=A.gnormx;e.y=A.gnormy}}F&&(e.x=-e.x,e.y=-e.y);return C}for(var ca=a.polygon,ma=b.polygon,Y=-1E100,Ca=null,da=null,ra=0,la=ca.edges.head;null!=la;){for(var Z=la.elt,P=1E100,ia=ma.gverts.next;null!=ia;){var za=ia,u=Z.gnormx*
za.x+Z.gnormy*za.y;u<P&&(P=u);ia=ia.next}P-=Z.gprojection;if(P>l){Y=P;break}0<P?P>Y&&(Y=P,Ca=Z,ra=1):0>Y&&P>Y&&(Y=P,Ca=Z,ra=1);la=la.next}if(Y<l){for(var fa=ma.edges.head;null!=fa;){for(var ga=fa.elt,vb=1E100,ya=ca.gverts.next;null!=ya;){var cb=ya,gb=ga.gnormx*cb.x+ga.gnormy*cb.y;gb<vb&&(vb=gb);ya=ya.next}vb-=ga.gprojection;if(vb>l){Y=vb;break}0<vb?vb>Y&&(Y=vb,da=ga,ra=2):0>Y&&vb>Y&&(Y=vb,da=ga,ra=2);fa=fa.next}if(Y<l){var Ha,S;if(1==ra)Ha=ma,S=Ca;else{Ha=ca;S=da;var Qa=c;c=d;d=Qa;F=!F}for(var ea=
null,Ra=1E100,pa=Ha.edges.head;null!=pa;){var xa=pa.elt,Ta=S.gnormx*xa.gnormx+S.gnormy*xa.gnormy;Ta<Ra&&(Ra=Ta,ea=xa);pa=pa.next}F?(e.x=-S.gnormx,e.y=-S.gnormy):(e.x=S.gnormx,e.y=S.gnormy);if(0<=Y){var Za=S.gp0,db=S.gp1,ob=ea.gp0,V=ea.gp1,ja=0,J=0,ka=0,Ea=0,ja=db.x-Za.x,J=db.y-Za.y,ka=V.x-ob.x,Ea=V.y-ob.y,Na=1/(ja*ja+J*J),ta=1/(ka*ka+Ea*Ea),Ga=-(ja*(Za.x-ob.x)+J*(Za.y-ob.y))*Na,$a=-(ja*(Za.x-V.x)+J*(Za.y-V.y))*Na,wa=-(ka*(ob.x-Za.x)+Ea*(ob.y-Za.y))*ta,na=-(ka*(ob.x-db.x)+Ea*(ob.y-db.y))*ta;0>Ga?Ga=
0:1<Ga&&(Ga=1);0>$a?$a=0:1<$a&&($a=1);0>wa?wa=0:1<wa&&(wa=1);0>na?na=0:1<na&&(na=1);var Aa=0,Da=0,y=Ga,Aa=Za.x+ja*y,Da=Za.y+J*y,Wa=0,Xa=0,Ya=$a,Wa=Za.x+ja*Ya,Xa=Za.y+J*Ya,Fa=0,va=0,$b=wa,Fa=ob.x+ka*$b,va=ob.y+Ea*$b,Ia=0,La=0,Ma=na,Ia=ob.x+ka*Ma,La=ob.y+Ea*Ma,sa=eb.vec_dsq(Aa,Da,ob.x,ob.y),ab=eb.vec_dsq(Wa,Xa,V.x,V.y),ua=eb.vec_dsq(Fa,va,Za.x,Za.y),pb=eb.vec_dsq(Ia,La,db.x,db.y),hb=0,Pa=0,ha=null;sa<ab?(hb=Aa,Pa=Da,ha=ob):(hb=Wa,Pa=Xa,ha=V,sa=ab);var Ja=0,Ka=0,Ba=null;ua<pb?(Ja=Fa,Ka=va,Ba=Za):(Ja=
Ia,Ka=La,Ba=db,ua=pb);sa<ua?(c.x=hb,c.y=Pa,d.x=ha.x,d.y=ha.y,Y=Math.sqrt(sa)):(d.x=Ja,d.y=Ka,c.x=Ba.x,c.y=Ba.y,Y=Math.sqrt(ua));if(0!=Y){e.x=d.x-c.x;e.y=d.y-c.y;var Sa=1/Y;e.x*=Sa;e.y*=Sa;F&&(e.x=-e.x,e.y=-e.y)}return Y}var wb=0,xb=0,wb=ea.gp0.x,xb=ea.gp0.y,qa=0,vc=0,qa=ea.gp1.x,vc=ea.gp1.y,Bb=0,Oa=0,Bb=qa-wb,Oa=vc-xb,bb=S.gnormy*wb-S.gnormx*xb,yb=S.gnormy*qa-S.gnormx*vc,jb=1/(yb-bb),fb=(-S.tp1-bb)*jb;fb>p.epsilon&&(wb+=Bb*fb,xb+=Oa*fb);var ib=(-S.tp0-yb)*jb;ib<-p.epsilon&&(qa+=Bb*ib,vc+=Oa*ib);var Ua=
wb*S.gnormx+xb*S.gnormy-S.gprojection,Va=qa*S.gnormx+vc*S.gnormy-S.gprojection;if(Ua<Va){d.x=wb;d.y=xb;var kb=-Ua;c.x=d.x+S.gnormx*kb;c.y=d.y+S.gnormy*kb;return Ua}d.x=qa;d.y=vc;var lb=-Va;c.x=d.x+S.gnormx*lb;c.y=d.y+S.gnormy*lb;return Va}}return l};var D=function(){this.length=this.x=this.y=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.weak=!1;this._isimmutable=this.outer=null;this._immutable=!1;this._invalidate=this._validate=null};D.__name__=!0;D.get=function(a,b,c){null==c&&
(c=!1);var d;null==D.zpp_pool?d=new D:(d=D.zpp_pool,D.zpp_pool=d.next,d.next=null);d.weak=!1;d._immutable=c;d.x=a;d.y=b;return d};D.prototype={validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},immutable:function(){if(this._immutable)throw new m("Error: Vec2 is immutable");null!=this._isimmutable&&this._isimmutable()},wrapper:function(){if(null==this.outer){this.outer=new E;var a=this.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=
null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=D.zpp_pool;D.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){b._inuse=!0;null==a?(b.next=this.next,this.next=b):(b.next=a.next,a.next=b);this.pushmod=this.modified=!0;this.length++;
return b},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.next,b=null;null!=a;){var c=a.next;a.next=b;b=this.next=a;a=c}this.pushmod=this.modified=!0},iterator_at:function(a){for(var b=this.next;0<a--&&null!=b;)b=b.next;return b},toString:function(){return"{ x: "+
this.x+" y: "+this.y+" }"},__class__:D};var eb=function(){};eb.__name__=!0;eb.vec_dsq=function(a,b,c,d){var e=0,f=0,e=a-c,f=b-d;return e*e+f*f};var H=function(){this.userData=this.ishape=this.ibody=this.icompound=this.cbsets=this.group=this.cbTypes=this.cbSet=this.wrap_cbTypes=null;this.id=0;this.outer_i=null;this.id=oa.Interactor();this.cbsets=new pd;this.cbTypes=new mb};H.__name__=!0;H.get=function(a,b){var c;c=a.id<b.id?a.id:b.id;var d;d=a.id<b.id?b.id:a.id;for(var e=null,f=(a.cbsets.length<b.cbsets.length?
a.cbsets:b.cbsets).head;null!=f;){var h=f.elt;if(h.id==c&&h.di==d){e=h;break}f=f.next}return e};H.int_callback=function(a,b,c){var d=a.int1;a=a.int2;b.options1.compatible(d.cbTypes)&&b.options2.compatible(a.cbTypes)?(c.int1=d,c.int2=a):(c.int1=a,c.int2=d)};H.prototype={__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var a=this.cbTypes.head;null!=a;)a.elt.interactors.add(this),a=a.next;this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);
for(var a=this.cbTypes.head;null!=a;)a.elt.interactors.remove(this),a=a.next;this.dealloc_cbSet()},wake:function(){if(null!=this.ishape){var a=this.ishape.body;null!=a&&null!=a.space&&a.space.non_inlined_wake(a);!0}else null!=this.ibody?null!=this.ibody.space?this.ibody.space.non_inlined_wake(this.ibody):!1:(null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound),!0)},setupcbTypes:function(){this.wrap_cbTypes=Ba.get(this.cbTypes);this.wrap_cbTypes.zpp_inner.adder=x(this,this.wrap_cbTypes_adder);
this.wrap_cbTypes.zpp_inner.subber=x(this,this.wrap_cbTypes_subber);this.wrap_cbTypes.zpp_inner.dontremove=!0;this.wrap_cbTypes.zpp_inner._modifiable=x(this,this.immutable_cbTypes)},immutable_cbTypes:function(){this.immutable_midstep("Interactor::cbTypes")},wrap_cbTypes_subber:function(a){a=a.zpp_inner;if(this.cbTypes.has(a)){var b;b=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.remove(this));
this.cbTypes.remove(a);null!=b&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(a){this.insert_cbtype(a.zpp_inner);return!1},insert_cbtype:function(a){if(!this.cbTypes.has(a)){var b;b=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.add(this));for(var c=null,d=this.cbTypes.head;null!=d&&!(a.id<d.elt.id);)c=d,d=d.next;this.cbTypes.inlined_insert(c,a);null!=b&&(this.alloc_cbSet(),
this.wake())}},alloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=a.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),a.freshInteractorType(this))},dealloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=this.cbSet&&(this.cbSet.interactors.remove(this),
a.nullInteractorType(this),0==--this.cbSet.count&&(a.cbsets.remove(this.cbSet),a=this.cbSet,a.free(),a.next=G.zpp_pool,G.zpp_pool=a),this.cbSet=null)},setGroup:function(a){if(this.group!=a){var b;(b=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space))&&null!=this.group&&this.group.interactors.remove(this);this.group=a;b&&null!=a&&a.interactors.add(this);b&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():
this.icompound.wake())}},immutable_midstep:function(a){null!=this.ibody?this.ibody.__immutable_midstep(a):null!=this.ishape?this.ishape.__immutable_midstep(a):this.icompound.__imutable_midstep(a)},lookup_group:function(){for(var a=this;null!=a&&null==a.group;)a=null!=a.ishape?a.ishape.body:null!=a.icompound?a.icompound.compound:a.ibody.compound;return null==a?null:a.group},__class__:H};var kb=function(){this.wrap_localCOM=this.wrap_worldCOM=null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=
0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_aabb=!1;this.aabb=null;this.norotate=!1;this.cinertia=this.iinertia=this.sinertia=0;this.zip_inertia=!1;this.inertiaMode=this.inertia=0;this.zip_gravMassScale=!1;this.gravMassMode=this.gravMassScale=0;this.zip_gravMass=!1;this.gravMass=0;this.nomove=!1;this.massMode=this.imass=this.smass=this.cmass=0;this.zip_mass=!1;this.mass=0;this.zip_axis=!1;this.forcex=this.forcey=this.kinvelx=this.kinvely=this.svelx=this.svely=this.angvel=this.torque=
this.kinangvel=this.pre_rot=this.rot=this.axisx=this.axisy=0;this.wrap_vel=null;this.velx=this.vely=0;this.wrap_pos=null;this.pre_posx=this.pre_posy=this.posx=this.posy=0;this.bullet=this.bulletEnabled=this.disableCCD=!1;this.sweepRadius=0;this.sweepFrozen=!1;this.sweepTime=this.sweep_angvel=0;this.compound=this.shapes=this.wrap_shapes=this.space=this.arbiters=this.constraints=this.component=null;this.type=0;this.world=!1;this.outer=null;H.call(this);this.ibody=this;this.bulletEnabled=this.world=
!1;this.sweep_angvel=this.sweepTime=0;this.disableCCD=this.norotate=this.nomove=!1;this.axisx=this.rot=this.posy=this.posx=0;this.axisy=1;this.torque=this.angvel=this.kinangvel=this.forcey=this.forcex=this.kinvely=this.kinvelx=this.vely=this.velx=this.svely=this.svelx=0;this.pre_rot=this.pre_posy=this.pre_posx=Infinity;this.worldCOMy=this.worldCOMx=this.localCOMy=this.localCOMx=0;this.zip_aabb=!0;this.aabb=la.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=x(this,this.aabb_validate);this.massMode=
f.id_MassMode_DEFAULT;this.gravMassMode=f.id_GravMassMode_DEFAULT;this.gravMassScale=1;this.inertiaMode=f.id_InertiaMode_DEFAULT;this.arbiters=new zc;this.constraints=new Ub;this.shapes=new jc;this.wrap_shapes=lb.get(this.shapes);this.wrap_shapes.zpp_inner.adder=x(this,this.shapes_adder);this.wrap_shapes.zpp_inner.subber=x(this,this.shapes_subber);this.wrap_shapes.zpp_inner._invalidate=x(this,this.shapes_invalidate);this.wrap_shapes.zpp_inner._modifiable=x(this,this.shapes_modifiable);this.kinematicDelaySleep=
!1};kb.__name__=!0;kb.__static=function(){var a=Vb;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new T,f.internal=!1);var a=new a(f.BodyType_STATIC),b=a.zpp_inner;b.world=!0;b.wrap_shapes.zpp_inner.immutable=!0;b.smass=b.imass=b.cmass=b.mass=b.gravMass=0;b.sinertia=b.iinertia=b.cinertia=b.inertia=0;b.cbTypes.clear();return a};kb.__super__=H;kb.prototype=B(H.prototype,{invalidate_type:function(){this.invalidate_mass();this.invalidate_inertia()},invalidate_shapes:function(){this.zip_worldCOM=
this.zip_localCOM=this.zip_aabb=!0;this.invalidate_mass();this.invalidate_inertia()},atRest:function(a){if(this.type!=f.id_BodyType_DYNAMIC)return this.component.sleeping;var b=p.linearSleepThreshold,b=b*b;if(this.velx*this.velx+this.vely*this.vely>b)a=!1;else if(eb.vec_dsq(this.posx,this.posy,this.pre_posx,this.pre_posy)>.25*b*a*a)a=!1;else{var c=b=0,b=this.aabb.maxx-this.aabb.minx,c=this.aabb.maxy-this.aabb.miny,b=b*b+c*c,c=p.angularSleepThreshold,c=c*c;if(4*this.angvel*this.angvel*b>c)a=!1;else{var d=
this.rot-this.pre_rot;a=d*d*b>c*a*a?!1:!0}}a||(this.component.waket=this.space.stamp);return this.component.waket+p.sleepDelay<this.space.stamp},refreshArbiters:function(){for(var a=this.arbiters.head;null!=a;)a.elt.invalidated=!0,a=a.next},sweepIntegrate:function(a){var b=a-this.sweepTime;0!=b&&(this.sweepTime=a,this.posx+=this.velx*b,this.posy+=this.vely*b,0!=this.angvel&&this.delta_rot(this.sweep_angvel*b))},sweepValidate:function(a){if(a.type==f.id_ShapeType_CIRCLE)a.worldCOMx=this.posx+(this.axisy*
a.localCOMx-this.axisx*a.localCOMy),a.worldCOMy=this.posy+(a.localCOMx*this.axisx+a.localCOMy*this.axisy);else{a=a.polygon;for(var b=a.lverts.next,c=a.gverts.next;null!=c;){var d=c,e=b,b=b.next;d.x=this.posx+(this.axisy*e.x-this.axisx*e.y);d.y=this.posy+(e.x*this.axisx+e.y*this.axisy);c=c.next}c=a.edges.head;b=d=a.gverts.next;for(d=d.next;null!=d;){var e=d,l=c.elt,c=c.next;l.gnormx=this.axisy*l.lnormx-this.axisx*l.lnormy;l.gnormy=l.lnormx*this.axisx+l.lnormy*this.axisy;l.gprojection=this.posx*l.gnormx+
this.posy*l.gnormy+l.lprojection;l.tp0=b.y*l.gnormx-b.x*l.gnormy;l.tp1=e.y*l.gnormx-e.x*l.gnormy;b=e;d=d.next}a=a.gverts.next;c=c.elt;c.gnormx=this.axisy*c.lnormx-this.axisx*c.lnormy;c.gnormy=c.lnormx*this.axisx+c.lnormy*this.axisy;c.gprojection=this.posx*c.gnormx+this.posy*c.gnormy+c.lprojection;c.tp0=b.y*c.gnormx-b.x*c.gnormy;c.tp1=a.y*c.gnormx-a.x*c.gnormy}},invalidate_pos:function(){for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),
b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=!0},pos_invalidate:function(a){this.immutable_midstep("Body::position");if(this.type==f.id_BodyType_STATIC&&null!=this.space)throw new m("Error: Cannot move a static object once inside a Space");if(this.posx!=a.x||this.posy!=a.y)this.posx=a.x,this.posy=a.y,this.invalidate_pos(),this.wake()},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx;this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(a){if(this.type==
f.id_BodyType_STATIC)throw new m("Error: Static body cannot have its velocity set.");this.velx=a.x;this.vely=a.y;this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx;this.wrap_vel.zpp_inner.y=this.vely},setupPosition:function(){this.wrap_pos=E.get(this.posx,this.posy,null);this.wrap_pos.zpp_inner._inuse=!0;this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=x(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=x(this,this.pos_validate))},
setupVelocity:function(){this.wrap_vel=E.get(this.velx,this.vely,null);this.wrap_vel.zpp_inner._inuse=!0;this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=x(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=x(this,this.vel_validate))},invalidate_rot:function(){this.zip_axis=!0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=
!0},validate_axis:function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null)},delta_rot:function(a){this.rot+=a;if(1E-4<a*a)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null;else{var b=a*a,c=1-.5*b,b=1-b*b/8,d=(c*this.axisx+a*this.axisy)*b;this.axisy=(c*this.axisy-a*this.axisx)*b;this.axisx=d}},invalidate_mass:function(){this.zip_mass=!0;this.invalidate_gravMass()},validate_mass:function(){if(this.zip_mass){this.zip_mass=!1;if(this.massMode==
f.id_MassMode_DEFAULT){this.cmass=0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cmass+=b.area*b.material.density;a=a.next}}this.type!=f.id_BodyType_DYNAMIC||this.nomove?(this.mass=Infinity,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},invalidate_gravMass:function(){this.gravMassMode!=f.id_GravMassMode_FIXED&&(this.zip_gravMass=!0);this.gravMassMode!=f.id_GravMassMode_SCALED&&(this.zip_gravMassScale=
!0);this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),this.gravMassMode==f.id_GravMassMode_DEFAULT?(this.validate_mass(),this.gravMass=this.cmass):this.gravMassMode==f.id_GravMassMode_SCALED&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_inertia:function(){this.zip_inertia=!0;this.wake()},validate_inertia:function(){if(this.zip_inertia){this.zip_inertia=!1;if(this.inertiaMode==f.id_InertiaMode_DEFAULT){this.cinertia=
0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cinertia+=b.inertia*b.area*b.material.density;a=a.next}}this.type!=f.id_BodyType_DYNAMIC||this.norotate?(this.inertia=Infinity,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},validate_aabb:function(){if(null==this.shapes.head)throw new m("Error: Body bounds only makes sense if it contains shapes");if(this.zip_aabb){this.zip_aabb=
!1;this.aabb.minx=Infinity;this.aabb.miny=Infinity;this.aabb.maxx=-Infinity;this.aabb.maxy=-Infinity;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.zip_aabb&&null!=b.body&&(b.zip_aabb=!1,b.type==f.id_ShapeType_CIRCLE?b.circle.__validate_aabb():b.polygon.__validate_aabb());this.aabb.combine(b.aabb);a=a.next}}},invalidate_localCOM:function(){this.zip_worldCOM=this.zip_localCOM=!0},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var a=0,b=0,c=0,d=this.shapes.head;null!=
d;){var e=d.elt;e.zip_localCOM&&(e.zip_localCOM=!1,e.type==f.id_ShapeType_POLYGON&&e.polygon.__validate_localCOM(),null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy));e.validate_area_inertia();var l=e.area*e.material.density,a=a+e.localCOMx*l,b=b+e.localCOMy*l,c=c+e.area*e.material.density,d=d.next}0!=c&&(d=1/c,this.localCOMx=a*d,this.localCOMy=b*d);null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=
this.localCOMy);this.zip_mass&&this.massMode==f.id_MassMode_DEFAULT&&(this.zip_mass=!1,this.cmass=c,this.type==f.id_BodyType_DYNAMIC?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Infinity,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),
this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},getlocalCOM:function(){if(null==this.shapes.head)throw new m("Error: localCOM only makes sense when Body has Shapes");this.validate_localCOM()},__immutable_midstep:function(a){if(null!=this.space&&this.space.midstep)throw new m("Error: "+a+" cannot be set during a space step()");},aabb_validate:function(){if(null==
this.shapes.head)throw new m("Error: bounds only makes sense when Body has shapes");this.validate_aabb()},shapes_adder:function(a){return a.zpp_inner.body!=this?(null!=a.zpp_inner.body&&a.zpp_inner.body.wrap_shapes.remove(a),a.zpp_inner.body=this,a.zpp_inner.addedToBody(),null!=this.space&&this.space.added_shape(a.zpp_inner,null),a.zpp_inner.type==f.id_ShapeType_POLYGON&&(a.zpp_inner.polygon.invalidate_gaxi(),a.zpp_inner.polygon.invalidate_gverts()),!0):!1},shapes_subber:function(a){null!=this.space&&
this.space.removed_shape(a.zpp_inner);a.zpp_inner.body=null;a.zpp_inner.removedFromBody()},shapes_invalidate:function(a){this.invalidate_shapes()},shapes_modifiable:function(){this.immutable_midstep("Body::shapes");if(this.type==f.id_BodyType_STATIC&&null!=this.space)throw new m("Error: Cannot modifiy shapes of static object once added to Space");},addedToSpace:function(){null==ka.zpp_pool?this.component=new ka:(this.component=ka.zpp_pool,ka.zpp_pool=this.component.next,this.component.next=null);
null;this.component.isBody=!0;this.component.body=this;this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=this.arbiters.head;){var a=this.arbiters.pop_unsafe();a.cleared=!0;a.b2==this&&a.b1.arbiters.inlined_try_remove(a);a.b1==this&&a.b2.arbiters.inlined_try_remove(a);null!=a.pair&&(a.pair.arb=null,a.pair=null);a.active=!1;this.space.f_arbiters.modified=!0}a=this.component;a.body=null;a.constraint=null;null;a.next=ka.zpp_pool;ka.zpp_pool=a;this.component=null;this.__iremovedFromSpace()},
__class__:kb});var xd=function(){this.compound=this.space=null;this.depth=0;this.outer=this.bodies=this.constraints=this.compounds=this.wrap_bodies=this.wrap_constraints=this.wrap_compounds=null;H.call(this);this.icompound=this;this.depth=1;this.bodies=new mc;this.wrap_bodies=ja.get(this.bodies);this.wrap_bodies.zpp_inner.adder=x(this,this.bodies_adder);this.wrap_bodies.zpp_inner.subber=x(this,this.bodies_subber);this.wrap_bodies.zpp_inner._modifiable=x(this,this.bodies_modifiable);this.constraints=
new Ub;this.wrap_constraints=Da.get(this.constraints);this.wrap_constraints.zpp_inner.adder=x(this,this.constraints_adder);this.wrap_constraints.zpp_inner.subber=x(this,this.constraints_subber);this.wrap_constraints.zpp_inner._modifiable=x(this,this.constraints_modifiable);this.compounds=new Ac;this.wrap_compounds=qa.get(this.compounds);this.wrap_compounds.zpp_inner.adder=x(this,this.compounds_adder);this.wrap_compounds.zpp_inner.subber=x(this,this.compounds_subber);this.wrap_compounds.zpp_inner._modifiable=
x(this,this.compounds_modifiable)};xd.__name__=!0;xd.__super__=H;xd.prototype=B(H.prototype,{__imutable_midstep:function(a){if(null!=this.space&&this.space.midstep)throw new m("Error: "+a+" cannot be set during space step()");},addedToSpace:function(){this.__iaddedToSpace()},removedFromSpace:function(){this.__iremovedFromSpace()},bodies_adder:function(a){return a.zpp_inner.compound!=this?(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_bodies.remove(a):null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_bodies.remove(a),
a.zpp_inner.compound=this,null!=this.space&&this.space.addBody(a.zpp_inner),!0):!1},bodies_subber:function(a){a.zpp_inner.compound=null;null!=this.space&&this.space.remBody(a.zpp_inner)},bodies_modifiable:function(){this.immutable_midstep("Compound::bodies")},constraints_adder:function(a){return a.zpp_inner.compound!=this?(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_constraints.remove(a):null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_constraints.remove(a),a.zpp_inner.compound=this,null!=
this.space&&this.space.addConstraint(a.zpp_inner),!0):!1},constraints_subber:function(a){a.zpp_inner.compound=null;null!=this.space&&this.space.remConstraint(a.zpp_inner)},constraints_modifiable:function(){this.immutable_midstep("Compound::constraints")},compounds_adder:function(a){for(var b=this;null!=b&&b!=a.zpp_inner;)b=b.compound;if(b==a.zpp_inner)throw new m("Error: Assignment would cause a cycle in the Compound tree: assigning "+a.toString()+".compound = "+this.outer.toString());return a.zpp_inner.compound!=
this?(null!=a.zpp_inner.compound?a.zpp_inner.compound.wrap_compounds.remove(a):null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_compounds.remove(a),a.zpp_inner.compound=this,a.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(a.zpp_inner),!0):!1},compounds_subber:function(a){a.zpp_inner.compound=null;a.zpp_inner.depth=1;null!=this.space&&this.space.remCompound(a.zpp_inner)},compounds_modifiable:function(){this.immutable_midstep("Compound::compounds")},__class__:xd});var C=function(){this.dynamicFriction=
this.staticFriction=this.density=this.elasticity=this.rollingFriction=0;this.next=this.outer=this.shapes=null;this.shapes=new jc;this.elasticity=0;this.dynamicFriction=1;this.staticFriction=2;this.density=.001;this.rollingFriction=.01};C.__name__=!0;C.prototype={wrapper:function(){if(null==this.outer){this.outer=new sc;var a=this.outer.zpp_inner;a.outer=null;a.next=C.zpp_pool;C.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},set:function(a){this.dynamicFriction=a.dynamicFriction;this.staticFriction=
a.staticFriction;this.density=a.density;this.elasticity=a.elasticity;this.rollingFriction=a.rollingFriction},invalidate:function(a){for(var b=this.shapes.head;null!=b;)b.elt.invalidate_material(a),b=b.next},__class__:C};var Db=function(a){this.zip_aabb=!1;this.sweep=this.node=this.pairs=this.aabb=null;this.fluidEnabled=this.sensorEnabled=!1;this.circle=this.polygon=this.refmaterial=this.material=this.filter=this.fluidProperties=null;this.sweepCoef=0;this.zip_sweepRadius=!1;this.sweepRadius=0;this.wrap_localCOM=
null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_angDrag=!1;this.inertia=this.angDrag=0;this.zip_area_inertia=!1;this.type=this.area=0;this.outer=this.body=null;H.call(this);this.pairs=new de;this.ishape=this;this.type=a;this.aabb=la.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=x(this,this.aabb_validate);this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0;this.worldCOMy=this.worldCOMx=this.localCOMy=
this.localCOMx=0;this.sensorEnabled=this.fluidEnabled=!1;this.body=this.fluidProperties=null;this.refmaterial=new C;this.sweepRadius=this.sweepCoef=0};Db.__name__=!0;Db.__super__=H;Db.prototype=B(H.prototype,{validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},validate_area_inertia:function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,this.type==f.id_ShapeType_CIRCLE?
this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){if(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_angDrag():this.polygon.__validate_angDrag()},validate_worldCOM:function(){this.zip_worldCOM&&null!=this.body&&(this.zip_worldCOM=!1,this.zip_localCOM&&(this.zip_localCOM=
!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy))},invalidate_area_inertia:function(){this.zip_area_inertia=!0;null!=this.body&&(this.body.invalidate_localCOM(),
this.body.invalidate_mass(),this.body.invalidate_inertia())},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){this.zip_localCOM=!0;this.invalidate_area_inertia();this.type==f.id_ShapeType_CIRCLE&&(this.zip_sweepRadius=!0);this.invalidate_angDrag();this.invalidate_worldCOM();null!=this.body&&this.body.invalidate_localCOM()},invalidate_worldCOM:function(){this.zip_aabb=this.zip_worldCOM=!0;null!=this.body&&(this.body.zip_aabb=!0)},invalidate_material:function(a){0!=
(a&C.WAKE)&&this.wake();0!=(a&C.ARBITERS)&&null!=this.body&&this.body.refreshArbiters();0!=(a&C.PROPS)&&null!=this.body&&(this.body.invalidate_localCOM(),this.body.invalidate_mass(),this.body.invalidate_inertia());0!=(a&C.ANGDRAG)&&this.invalidate_angDrag();this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},aabb_validate:function(){if(null==this.body)throw new m("Error: bounds only makes sense when Shape belongs to a Body");this.zip_aabb&&null!=this.body&&(this.zip_aabb=
!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_aabb():this.polygon.__validate_aabb())},setMaterial:function(a){this.material!=a&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(a){this.filter!=a&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),
this.filter=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),this.wake())},__immutable_midstep:function(a){if(null!=this.body&&null!=this.body.space&&this.body.space.midstep)throw new m("Error: "+a+" cannot be set during a space step()");},addedToBody:function(){this.invalidate_worldCOM();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace();this.material.shapes.add(this);this.filter.shapes.add(this);null!=
this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace();this.material.shapes.remove(this);this.filter.shapes.remove(this);null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},__class__:Db});var yd=function(){this.radius=0;this.outer_zn=null;Db.call(this,f.id_ShapeType_CIRCLE);this.circle=this;this.zip_localCOM=!1};yd.__name__=!0;yd.__super__=Db;yd.prototype=B(Db.prototype,{invalidate_radius:function(){this.invalidate_area_inertia();
this.invalidate_angDrag();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);null!=this.body&&this.body.wake()},__validate_aabb:function(){this.zip_worldCOM&&null!=this.body&&(this.zip_worldCOM=!1,this.zip_localCOM&&(this.zip_localCOM=!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*
this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy));var a=this.radius,b=this.radius;this.aabb.minx=this.worldCOMx-a;this.aabb.miny=this.worldCOMy-b;this.aabb.maxx=this.worldCOMx+a;this.aabb.maxy=this.worldCOMy+b},_force_validate_aabb:function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy);this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*
this.body.axisy);this.aabb.minx=this.worldCOMx-this.radius;this.aabb.miny=this.worldCOMy-this.radius;this.aabb.maxx=this.worldCOMx+this.radius;this.aabb.maxy=this.worldCOMy+this.radius},__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy);this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var a=this.radius*this.radius;this.area=a*Math.PI;this.inertia=.5*a+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},
__validate_angDrag:function(){var a=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,b=this.radius*this.radius;this.angDrag=(a+2*b)*this.material.dynamicFriction*p.fluidAngularDragFriction+.5*p.fluidAngularDrag*(1+p.fluidVacuumDrag)*a;this.angDrag/=2*(a+.5*b)},__translate:function(a,b){this.localCOMx+=1*a;this.localCOMy+=1*b;this.invalidate_localCOM()},__class__:yd});var A=function(){this.tp0=this.tp1=0;this.lp0=this.gp0=this.lp1=this.gp1=null;this.length=this.lprojection=this.gprojection=
0;this.wrap_gnorm=null;this.gnormx=this.gnormy=0;this.wrap_lnorm=null;this.lnormx=this.lnormy=0;this.next=this.polygon=this.outer=null;this.gprojection=this.lprojection=this.length=this.gnormy=this.gnormx=this.lnormy=this.lnormx=0};A.__name__=!0;A.prototype={wrapper:function(){null==this.outer&&(A.internal=!0,this.outer=new Ud,A.internal=!1,this.outer.zpp_inner=this);return this.outer},__class__:A};var zd=function(){this.reverse_flag=this.zip_lverts=this.zip_laxi=this.zip_gverts=this.zip_gaxi=this.zip_valid=
this.zip_sanitation=!1;this.edgeCnt=0;this.outer_zn=this.lverts=this.wrap_lverts=this.gverts=this.wrap_gverts=this.edges=this.wrap_edges=null;Db.call(this,f.id_ShapeType_POLYGON);this.polygon=this;this.lverts=new D;this.gverts=new D;this.edges=new qd;this.edgeCnt=0};zd.__name__=!0;zd.__super__=Db;zd.prototype=B(Db.prototype,{lverts_pa_invalidate:function(a){this.invalidate_lverts()},lverts_pa_immutable:function(){if(null!=this.body&&this.body.type==f.id_BodyType_STATIC&&null!=this.body.space)throw new m("Error: Cannot modify local vertex of Polygon added to a static body whilst within a Space");
},gverts_pa_validate:function(){if(null==this.body)throw new m("Error: World vertex only makes sense when Polygon is contained in a rigid body");this.validate_gverts()},lverts_post_adder:function(a){a.zpp_inner._invalidate=x(this,this.lverts_pa_invalidate);a.zpp_inner._isimmutable=x(this,this.lverts_pa_immutable);for(var b=null,c=null,d=this.lverts.next;null!=d&&d!=a.zpp_inner;)b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:c.next,d=d.next;a=D.get(0,0,!0);this.gverts.insert(b,a);null!=
this.lverts.next.next&&(null==this.lverts.next.next.next?(null==A.zpp_pool?c=new A:(c=A.zpp_pool,A.zpp_pool=c.next,c.next=null),null,c.polygon=this,this.edges.add(c),null==A.zpp_pool?c=new A:(c=A.zpp_pool,A.zpp_pool=c.next,c.next=null),null,c.polygon=this,this.edges.add(c),this.edgeCnt+=2):(null==A.zpp_pool?b=new A:(b=A.zpp_pool,A.zpp_pool=b.next,b.next=null),null,b.polygon=this,this.edges.insert(c,b),this.edgeCnt++));a._validate=x(this,this.gverts_pa_validate)},lverts_subber:function(a){this.cleanup_lvert(a.zpp_inner)},
lverts_invalidate:function(a){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},lverts_modifiable:function(){this.immutable_midstep("Polygon::localVerts");if(null!=this.body&&this.body.type==f.id_BodyType_STATIC&&null!=this.body.space)throw new m("Error: Cannot modifiy shapes of static object once added to Space");},gverts_validate:function(){this.validate_gverts()},getlverts:function(){this.wrap_lverts=Ob.get(this.lverts);this.wrap_lverts.zpp_inner.post_adder=x(this,this.lverts_post_adder);
this.wrap_lverts.zpp_inner.subber=x(this,this.lverts_subber);this.wrap_lverts.zpp_inner._invalidate=x(this,this.lverts_invalidate);this.wrap_lverts.zpp_inner._validate=x(this,this.lverts_validate);this.wrap_lverts.zpp_inner._modifiable=x(this,this.lverts_modifiable);this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},getgverts:function(){this.wrap_gverts=Ob.get(this.gverts,!0);this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag;this.wrap_gverts.zpp_inner._validate=x(this,this.gverts_validate)},
invalidate_lverts:function(){this.invalidate_laxi();this.invalidate_area_inertia();this.invalidate_angDrag();this.invalidate_localCOM();this.invalidate_gverts();this.zip_sanitation=this.zip_valid=this.zip_lverts=!0;null!=this.body&&this.body.wake()},invalidate_laxi:function(){this.invalidate_gaxi();this.zip_laxi=this.zip_sweepRadius=!0},invalidate_gverts:function(){this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);this.zip_gverts=!0},invalidate_gaxi:function(){this.zip_gaxi=!0},valid:function(){if(this.zip_valid){this.zip_valid=
!1;this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real());if(3>this.lverts.length)return null==f.ValidationResult_DEGENERATE&&(f.internal=!0,f.ValidationResult_DEGENERATE=new J,f.internal=!1),this.validation=f.ValidationResult_DEGENERATE;this.validate_lverts();this.validate_area_inertia();if(this.area<p.epsilon)return null==f.ValidationResult_DEGENERATE&&(f.internal=!0,f.ValidationResult_DEGENERATE=new J,f.internal=!1),this.validation=f.ValidationResult_DEGENERATE;for(var a=!1,
b=!1,c=!0,d=this.lverts.next,e=d,l=d=d.next,d=d.next;null!=d;){var h=d,g=0,k=0,g=h.x-l.x,k=h.y-l.y,m=0,n=0,m=l.x-e.x,n=l.y-e.y,g=n*g-m*k;g>p.epsilon?b=!0:g<-p.epsilon&&(a=!0);if(b&&a){c=!1;break}e=l;l=h;d=d.next}c&&(h=d=this.lverts.next,k=g=0,g=h.x-l.x,k=h.y-l.y,n=m=0,m=l.x-e.x,n=l.y-e.y,e=n*g-m*k,e>p.epsilon?b=!0:e<-p.epsilon&&(a=!0),b&&a&&(c=!1),c&&(e=l,l=h,h=d=d.next,d=c=0,c=h.x-l.x,d=h.y-l.y,g=h=0,h=l.x-e.x,g=l.y-e.y,l=g*c-h*d,l>p.epsilon?b=!0:l<-p.epsilon&&(a=!0)));if(b&&a)return null==f.ValidationResult_CONCAVE&&
(f.internal=!0,f.ValidationResult_CONCAVE=new J,f.internal=!1),this.validation=f.ValidationResult_CONCAVE;l=a=!0;b=e=this.lverts.next;for(e=e.next;null!=e;){c=e;if(!a){l=!1;break}h=!0;d=g=this.lverts.next;for(g=g.next;null!=g;){k=g;if(b!=d&&b!=k&&c!=d&&c!=k){var n=m=0,m=b.x-d.x,n=b.y-d.y,q=0,t=0,q=c.x-b.x,t=c.y-b.y,w=0,x=0,w=k.x-d.x,x=k.y-d.y,F=t*w-q*x;if(F*F>p.epsilon&&(F=1/F,w=(x*m-w*n)*F,w>p.epsilon&&w<1-p.epsilon&&(m=(t*m-q*n)*F,m>p.epsilon&&m<1-p.epsilon))){h=a=!1;break}}d=k;g=g.next}h&&(n=this.lverts.next,
b!=d&&b!=n&&c!=d&&c!=n&&(g=h=0,h=b.x-d.x,g=b.y-d.y,m=k=0,k=c.x-b.x,m=c.y-b.y,q=b=0,b=n.x-d.x,q=n.y-d.y,d=m*b-k*q,d*d>p.epsilon&&(d=1/d,b=(q*h-b*g)*d,b>p.epsilon&&b<1-p.epsilon&&(b=(m*h-k*g)*d,b>p.epsilon&&b<1-p.epsilon&&(a=!1)))));b=c;e=e.next}if(l){do if(e=this.lverts.next,a){c=!0;l=d=this.lverts.next;for(d=d.next;null!=d;){h=d;if(b!=l&&b!=h&&e!=l&&e!=h&&(k=g=0,g=b.x-l.x,k=b.y-l.y,n=m=0,m=e.x-b.x,n=e.y-b.y,F=t=0,t=h.x-l.x,F=h.y-l.y,q=n*t-m*F,q*q>p.epsilon&&(q=1/q,t=(F*g-t*k)*q,t>p.epsilon&&t<1-p.epsilon&&
(g=(n*g-m*k)*q,g>p.epsilon&&g<1-p.epsilon)))){c=a=!1;break}l=h;d=d.next}c&&(k=this.lverts.next,b!=l&&b!=k&&e!=l&&e!=k&&(d=c=0,c=b.x-l.x,d=b.y-l.y,g=h=0,h=e.x-b.x,g=e.y-b.y,m=e=0,e=k.x-l.x,m=k.y-l.y,l=g*e-h*m,l*l>p.epsilon&&(l=1/l,e=(m*c-e*d)*l,e>p.epsilon&&e<1-p.epsilon&&(l*=g*c-h*d,l>p.epsilon&&l<1-p.epsilon&&(a=!1)))))}while(0)}a?(null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=new J,f.internal=!1),a=this.validation=f.ValidationResult_VALID):(null==f.ValidationResult_SELF_INTERSECTING&&
(f.internal=!0,f.ValidationResult_SELF_INTERSECTING=new J,f.internal=!1),a=this.validation=f.ValidationResult_SELF_INTERSECTING);return a}return this.validation},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),0>this.area&&(this.reverse_vertices(),this.area=-this.area)))},cleanup_lvert:function(a){for(var b=null,c=null,d=this.lverts.next;null!=d&&d!=a;)b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:c.next,d=d.next;a=
null==b?this.gverts.next:b.next;this.gverts.erase(b);null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=D.zpp_pool;D.zpp_pool=a;2==this.edgeCnt?(c=this.edges.pop_unsafe(),c.polygon=null,c.next=A.zpp_pool,A.zpp_pool=c,c=this.edges.pop_unsafe(),c.polygon=null,c.next=A.zpp_pool,A.zpp_pool=c,this.edgeCnt=0):0!=this.edgeCnt&&(b=null==c?this.edges.head.elt:c.next.elt,this.edges.erase(c),b.polygon=null,b.next=A.zpp_pool,A.zpp_pool=b,this.edgeCnt--)},
splice_collinear:function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},splice_collinear_real:function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var a=null,b=this.lverts.next;null!=b;){var c=b,d=null==b.next?this.lverts.next:b.next;eb.vec_dsq(c.x,c.y,d.x,d.y)<p.epsilon*p.epsilon?(this.cleanup_lvert(b),b=this.lverts.erase(a)):(a=b,b=b.next)}if(null!=this.lverts.next){do for(a=!1,b=this.lverts.next;null!=b;){var c=
null==b.next?this.lverts.next:b.next,e=b,d=c,f=null==c.next?this.lverts.next:c.next,h=0,g=0,h=d.x-e.x,g=d.y-e.y,k=e=0,e=f.x-d.x,k=f.y-d.y,d=k*h-e*g;d*d>=p.epsilon*p.epsilon||(this.cleanup_lvert(c),this.lverts.erase(null==b.next?null:b),a=!0);b=b.next}while(a)}}},reverse_vertices:function(){this.lverts.reverse();this.gverts.reverse();this.edges.reverse();var a=this.edges.iterator_at(this.edgeCnt-1),b=this.edges.pop_unsafe();this.edges.insert(a,b);this.reverse_flag=!this.reverse_flag;null!=this.wrap_lverts&&
(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag);null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag);null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1;this.validate_lverts();for(var a=this.edges.head,b=this.lverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.lp0=c;e.lp1=d;var f=0,h=0,f=c.x-d.x,h=c.y-d.y,g=Math.sqrt(f*f+h*h);e.length=g;g=1/g;f*=g;h*=g;g=
f;f=-h;h=g;e.lprojection=f*c.x+h*c.y;e.lnormx=f;e.lnormy=h;null!=e.wrap_lnorm&&(e.wrap_lnorm.zpp_inner.x=f,e.wrap_lnorm.zpp_inner.y=h);c=d;b=b.next}e=this.lverts.next;a=a.elt;a.lp0=c;a.lp1=e;d=b=0;b=c.x-e.x;d=c.y-e.y;e=Math.sqrt(b*b+d*d);a.length=e;e=1/e;f=b*e;b=-(d*e);d=f;a.lprojection=b*c.x+d*c.y;a.lnormx=b;a.lnormy=d;null!=a.wrap_lnorm&&(a.wrap_lnorm.zpp_inner.x=b,a.wrap_lnorm.zpp_inner.y=d)}},validate_gverts:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1;this.validate_lverts();
this.body.validate_axis();for(var a=this.lverts.next,b=this.gverts.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);b=b.next}}},validate_gaxi:function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1;this.validate_laxi();this.body.validate_axis();this.validate_gverts();for(var a=this.edges.head,b=this.gverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.gp0=c;e.gp1=d;e.gnormx=
this.body.axisy*e.lnormx-this.body.axisx*e.lnormy;e.gnormy=e.lnormx*this.body.axisx+e.lnormy*this.body.axisy;e.gprojection=this.body.posx*e.gnormx+this.body.posy*e.gnormy+e.lprojection;null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy);e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy;e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy;c=d;b=b.next}b=this.gverts.next;a=a.elt;a.gp0=c;a.gp1=b;a.gnormx=this.body.axisy*a.lnormx-this.body.axisx*a.lnormy;a.gnormy=a.lnormx*this.body.axisx+
a.lnormy*this.body.axisy;a.gprojection=this.body.posx*a.gnormx+this.body.posy*a.gnormy+a.lprojection;null!=a.wrap_gnorm&&(a.wrap_gnorm.zpp_inner.x=a.gnormx,a.wrap_gnorm.zpp_inner.y=a.gnormy);a.tp0=a.gp0.y*a.gnormx-a.gp0.x*a.gnormy;a.tp1=a.gp1.y*a.gnormx-a.gp1.x*a.gnormy}},__validate_aabb:function(){this.validate_gverts();if(null==this.lverts.next)throw new m("Error: An empty polygon has no meaningful bounds");var a=this.gverts.next;this.aabb.minx=a.x;this.aabb.miny=a.y;this.aabb.maxx=a.x;this.aabb.maxy=
a.y;for(a=this.gverts.next.next;null!=a;){var b=a;b.x<this.aabb.minx&&(this.aabb.minx=b.x);b.x>this.aabb.maxx&&(this.aabb.maxx=b.x);b.y<this.aabb.miny&&(this.aabb.miny=b.y);b.y>this.aabb.maxy&&(this.aabb.maxy=b.y);a=a.next}},_force_validate_aabb:function(){var a=this.lverts.next,b=this.gverts.next,c=a,a=a.next;b.x=this.body.posx+(this.body.axisy*c.x-this.body.axisx*c.y);b.y=this.body.posy+(c.x*this.body.axisx+c.y*this.body.axisy);this.aabb.minx=b.x;this.aabb.miny=b.y;this.aabb.maxx=b.x;this.aabb.maxy=
b.y;for(b=this.gverts.next.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);c.x<this.aabb.minx&&(this.aabb.minx=c.x);c.x>this.aabb.maxx&&(this.aabb.maxx=c.x);c.y<this.aabb.miny&&(this.aabb.miny=c.y);c.y>this.aabb.maxy&&(this.aabb.maxy=c.y);b=b.next}},__validate_sweepRadius:function(){var a=0,b=0;this.validate_laxi();for(var c=this.lverts.next;null!=c;){var d=c,d=d.x*d.x+d.y*d.y;d>a&&(a=d);
c=c.next}for(c=this.edges.head;null!=c;){d=c.elt;if(d.lprojection<b&&(b=d.lprojection,0>b))break;c=c.next}0>b&&(b=0);this.sweepRadius=Math.sqrt(a);this.sweepCoef=this.sweepRadius-b},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.inertia=this.area=0;else{for(var a=this.area=0,b=0,c=this.lverts.next,d=c,e=c=c.next,c=c.next;null!=c;){var f=c,h=e.y*d.x-e.x*d.y,a=a+h*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y)),
b=b+h;this.area+=e.x*(f.y-d.y);d=e;e=f;c=c.next}h=c=this.lverts.next;f=e.y*d.x-e.x*d.y;a+=f*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));this.area+=e.x*(h.y-d.y);d=e;e=h;c=c.next;h=e.y*d.x-e.x*d.y;a+=h*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));b=b+f+h;this.area+=e.x*(c.y-d.y);this.inertia=a/(6*b);this.area*=.5;0>this.area&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){if(3>this.lverts.length)throw new m("Error: Polygon's with less than 3 vertices have no meaningful angDrag");
this.validate_area_inertia();this.validate_laxi();for(var a=0,b=this.edges.head,c=0,d=this.lverts.next,e=d,d=d.next;null!=d;){var f=d,h=b.elt,b=b.next,c=c+h.length,g=0,k=0,g=f.x-e.x,k=f.y-e.y,a=a+h.length*p.fluidAngularDragFriction*this.material.dynamicFriction*h.lprojection*h.lprojection,r=-(e.y*h.lnormx-e.x*h.lnormy)/(k*h.lnormx-g*h.lnormy);if(0<r){var n;n=1<r?1:r;var q=0,t=0,q=e.x,t=e.y,w=n,q=q+g*w,t=t+k*w,w=h.lnormy*e.x-h.lnormx*e.y,q=h.lnormy*q-h.lnormx*t,a=a+(q*q*q-w*w*w)/(3*(q-w))*n*h.length*
p.fluidAngularDrag}1>r&&(r=0>r?0:r,q=n=0,n=e.x,q=e.y,e=r,n+=g*e,q+=k*e,e=h.lnormy*n-h.lnormx*q,g=h.lnormy*f.x-h.lnormx*f.y,a+=(g*g*g-e*e*e)/(3*(g-e))*p.fluidVacuumDrag*(1-r)*h.length*p.fluidAngularDrag);e=f;d=d.next}d=this.lverts.next;b=b.elt;c+=b.length;h=f=0;f=d.x-e.x;h=d.y-e.y;a+=b.length*p.fluidAngularDragFriction*this.material.dynamicFriction*b.lprojection*b.lprojection;g=-(e.y*b.lnormx-e.x*b.lnormy)/(h*b.lnormx-f*b.lnormy);0<g&&(k=1<g?1:g,q=n=0,n=e.x,q=e.y,r=b.lnormy*e.x-b.lnormx*e.y,n=b.lnormy*
(n+f*k)-b.lnormx*(q+h*k),a+=(n*n*n-r*r*r)/(3*(n-r))*k*b.length*p.fluidAngularDrag);1>g&&(g=0>g?0:g,r=k=0,k=e.x,r=e.y,e=b.lnormy*(k+f*g)-b.lnormx*(r+h*g),d=b.lnormy*d.x-b.lnormx*d.y,a+=(d*d*d-e*e*e)/(3*(d-e))*p.fluidVacuumDrag*(1-g)*b.length*p.fluidAngularDrag);this.angDrag=a/(this.inertia*c)},__validate_localCOM:function(){if(null==this.lverts.next)throw new m("Error: An empty polygon has no meaningful localCOM");if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;
else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{for(var a=this.localCOMy=this.localCOMx=0,b=this.lverts.next,c=b,d=b=b.next,b=b.next;null!=b;){var e=b,a=a+d.x*(e.y-c.y),c=e.y*d.x-e.x*d.y;this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next}e=b=this.lverts.next;a+=d.x*(e.y-c.y);c=e.y*d.x-e.x*d.y;
this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next;a+=d.x*(b.y-c.y);c=b.y*d.x-b.x*d.y;this.localCOMx+=(d.x+b.x)*c;this.localCOMy+=(d.y+b.y)*c;a=1/(3*a);this.localCOMx*=a;this.localCOMy*=a}},__translate:function(a,b){for(var c=this.lverts.next;null!=c;){var d=c;d.x+=1*a;d.y+=1*b;c=c.next}this.invalidate_lverts()},__class__:zd});var nc=function(){this.sweep=this.dynab=null;this.is_sweep=!1;this.space=null};nc.__name__=!0;nc.prototype={insert:function(a){this.is_sweep?this.sweep.__insert(a):
this.dynab.__insert(a)},remove:function(a){this.is_sweep?this.sweep.__remove(a):this.dynab.__remove(a)},sync:function(a){this.is_sweep?!this.sweep.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()):this.dynab.__sync(a)},broadphase:function(a,b){},__class__:nc};var za=function(){this.synced=this.first_sync=!1;this.snext=null;this.moved=!1;this.next=this.mnext=null;this.height=0;this.parent=this.child1=this.child2=
null;this.dyn=!1;this.aabb=this.shape=null;this.height=-1};za.__name__=!0;za.prototype={free:function(){this.height=-1;var a=this.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a.wrap_min=a.wrap_max=null;a._invalidate=null;a._validate=null;a.next=la.zpp_pool;la.zpp_pool=a;this.mnext=this.snext=this.next=this.child1=this.child2=this.parent=null},__class__:za};var Q=function(){this.arb=this.next=null;this.id=this.di=0;this.first=this.sleeping=!1;this.n1=this.n2=null};Q.__name__=!0;Q.prototype=
{__class__:Q};var fa=function(){this.root=null};fa.__name__=!0;fa.prototype={inlined_insertLeaf:function(a){if(null==this.root)this.root=a,this.root.parent=null;else{for(var b=a.aabb,c=this.root;null!=c.child1;){var d=c.child1,e=c.child2,f=c.aabb.perimeter();fa.tmpaabb.setCombine(c.aabb,b);var h=fa.tmpaabb.perimeter(),g=2*h,f=2*(h-f);fa.tmpaabb.setCombine(b,d.aabb);null==d.child1?h=fa.tmpaabb.perimeter()+f:(h=d.aabb.perimeter(),h=fa.tmpaabb.perimeter()-h+f);fa.tmpaabb.setCombine(b,e.aabb);if(null==
e.child1)f=fa.tmpaabb.perimeter()+f;else var k=e.aabb.perimeter(),f=fa.tmpaabb.perimeter()-k+f;if(g<h&&g<f)break;else c=h<f?d:e}d=c.parent;null==za.zpp_pool?e=new za:(e=za.zpp_pool,za.zpp_pool=e.next,e.next=null);null==la.zpp_pool?e.aabb=new la:(e.aabb=la.zpp_pool,la.zpp_pool=e.aabb.next,e.aabb.next=null);null;e.moved=!1;e.synced=!1;e.first_sync=!1;e.parent=d;e.aabb.setCombine(b,c.aabb);e.height=c.height+1;null!=d?(d.child1==c?d.child1=e:d.child2=e,e.child1=c,e.child2=a,c.parent=e,a.parent=e):(e.child1=
c,e.child2=a,c.parent=e,this.root=a.parent=e);for(c=a.parent;null!=c;)c=this.balance(c),a=c.child1,b=c.child2,d=c,e=void 0,e=a.height,g=b.height,e=e>g?e:g,d.height=1+e,c.aabb.setCombine(a.aabb,b.aabb),c=c.parent}},removeLeaf:function(a){this.inlined_removeLeaf(a)},inlined_removeLeaf:function(a){if(a==this.root)this.root=null;else{var b=a.parent,c=b.parent;a=b.child1==a?b.child2:b.child1;if(null!=c)for(c.child1==b?c.child1=a:c.child2=a,a.parent=c,b.free(),b.next=za.zpp_pool,za.zpp_pool=b,b=c;null!=
b;){var b=this.balance(b),d=b.child1;a=b.child2;b.aabb.setCombine(d.aabb,a.aabb);var c=b,e=void 0,d=d.height;a=a.height;e=d>a?d:a;c.height=1+e;b=b.parent}else this.root=a,a.parent=null,b.free(),b.next=za.zpp_pool,za.zpp_pool=b}},balance:function(a){if(null==a.child1||2>a.height)return a;var b=a.child1,c=a.child2,d=c.height-b.height;if(1<d){var e=c.child1,f=c.child2;c.child1=a;c.parent=a.parent;a.parent=c;null!=c.parent?c.parent.child1==a?c.parent.child1=c:c.parent.child2=c:this.root=c;e.height>f.height?
(c.child2=e,a.child2=f,f.parent=a,a.aabb.setCombine(b.aabb,f.aabb),c.aabb.setCombine(a.aabb,e.aabb),a.height=1+function(a){a=b.height;var c=f.height;return a>c?a:c}(this),c.height=1+function(b){b=a.height;var c=e.height;return b>c?b:c}(this)):(c.child2=f,a.child2=e,e.parent=a,a.aabb.setCombine(b.aabb,e.aabb),c.aabb.setCombine(a.aabb,f.aabb),a.height=1+function(a){a=b.height;var c=e.height;return a>c?a:c}(this),c.height=1+function(b){b=a.height;var c=f.height;return b>c?b:c}(this));return c}if(-1>
d){var h=b.child1,g=b.child2;b.child1=a;b.parent=a.parent;a.parent=b;null!=b.parent?b.parent.child1==a?b.parent.child1=b:b.parent.child2=b:this.root=b;h.height>g.height?(b.child2=h,a.child1=g,g.parent=a,a.aabb.setCombine(c.aabb,g.aabb),b.aabb.setCombine(a.aabb,h.aabb),a.height=1+function(a){a=c.height;var b=g.height;return a>b?a:b}(this),b.height=1+function(b){b=a.height;var c=h.height;return b>c?b:c}(this)):(b.child2=g,a.child1=h,h.parent=a,a.aabb.setCombine(c.aabb,h.aabb),b.aabb.setCombine(a.aabb,
g.aabb),a.height=1+function(a){a=c.height;var b=h.height;return a>b?a:b}(this),b.height=1+function(b){b=a.height;var c=g.height;return b>c?b:c}(this));return b}return a},__class__:fa};var Ed=function(a){this.stree=this.dtree=this.pairs=this.syncs=this.moves=null;nc.call(this);this.space=a;this.is_sweep=!1;this.dynab=this;this.stree=new fa;this.dtree=new fa};Ed.__name__=!0;Ed.__super__=nc;Ed.prototype=B(nc.prototype,{__insert:function(a){var b;null==za.zpp_pool?b=new za:(b=za.zpp_pool,za.zpp_pool=
b.next,b.next=null);null==la.zpp_pool?b.aabb=new la:(b.aabb=la.zpp_pool,la.zpp_pool=b.aabb.next,b.aabb.next=null);null;b.moved=!1;b.synced=!1;b.first_sync=!1;b.shape=a;a.node=b;b.synced=!0;b.first_sync=!0;b.snext=this.syncs;this.syncs=b},__remove:function(a){var b=a.node;b.first_sync||(b.dyn?this.dtree.removeLeaf(b):this.stree.removeLeaf(b));a.node=null;if(b.synced){for(var c=null,d=this.syncs;null!=d&&d!=b;)c=d,d=d.snext;null==c?this.syncs=d.snext:c.snext=d.snext;d.snext=null;b.synced=!1}if(b.moved){c=
null;for(d=this.moves;null!=d&&d!=b;)c=d,d=d.mnext;null==c?this.moves=d.mnext:c.mnext=d.mnext;d.mnext=null;b.moved=!1}for(var c=null,e=this.pairs;null!=e;)d=e.next,e.n1==b||e.n2==b?(null==c?this.pairs=d:c.next=d,null!=e.arb&&(e.arb.pair=null),e.arb=null,e.n1.shape.pairs.remove(e),e.n2.shape.pairs.remove(e),e.n1=e.n2=null,e.sleeping=!1,e.next=Q.zpp_pool,Q.zpp_pool=e):c=e,e=d;for(;null!=a.pairs.head;)c=a.pairs.pop_unsafe(),c.n1==b?c.n2.shape.pairs.remove(c):c.n1.shape.pairs.remove(c),null!=c.arb&&(c.arb.pair=
null),c.arb=null,c.n1=c.n2=null,c.sleeping=!1,c.next=Q.zpp_pool,Q.zpp_pool=c;b.free();b.next=za.zpp_pool;za.zpp_pool=b},__sync:function(a){var b=a.node;b.synced||(!this.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()),b.dyn==(a.body.type==f.id_BodyType_STATIC?!1:!a.body.component.sleeping)&&b.aabb.contains(a.aabb)||(b.synced=!0,b.snext=this.syncs,this.syncs=b))},broadphase:function(a,b){for(var c=this.syncs;null!=
c;){var d=c.shape;c.first_sync?c.first_sync=!1:(c.dyn?this.dtree:this.stree).inlined_removeLeaf(c);var e=c.aabb;!a.continuous&&d.zip_aabb&&null!=d.body&&(d.zip_aabb=!1,d.type==f.id_ShapeType_CIRCLE?d.circle.__validate_aabb():d.polygon.__validate_aabb());e.setExpand(d.aabb,3);((d.body.type==f.id_BodyType_STATIC?c.dyn=!1:c.dyn=!d.body.component.sleeping)?this.dtree:this.stree).inlined_insertLeaf(c);c.synced=!1;c=c.snext}for(;null!=this.syncs;)if(c=this.syncs,this.syncs=c.snext,c.snext=null,!c.moved&&
(c.moved=!1,d=c.shape,!d.body.component.sleeping)){var e=c.aabb,l=null;null!=this.dtree.root&&(this.dtree.root.next=l,l=this.dtree.root);for(;null!=l;){var h;h=l;l=h.next;h.next=null;if(h!=c)if(null==h.child1){var g=h.shape;if(g.body!=d.body&&(g.body.type!=f.id_BodyType_STATIC||d.body.type!=f.id_BodyType_STATIC)&&e.intersect(h.aabb)){var k,m;d.id<g.id?(k=d.id,m=g.id):(k=g.id,m=d.id);for(var n=null,p=(d.pairs.length<g.pairs.length?d:g).pairs.head;null!=p;){var t=p.elt;if(t.id==k&&t.di==m){n=t;break}p=
p.next}null!=n?n.sleeping&&(n.sleeping=!1,n.next=this.pairs,this.pairs=n,n.first=!0):(null==Q.zpp_pool?n=new Q:(n=Q.zpp_pool,Q.zpp_pool=n.next,n.next=null),null,n.n1=c,n.n2=h,n.id=k,n.di=m,n.next=this.pairs,this.pairs=n,n.first=!0,d.pairs.inlined_add(n),g.pairs.inlined_add(n))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=l,l=h.child1),null!=h.child2&&(h.child2.next=l,l=h.child2))}null!=this.stree.root&&(this.stree.root.next=l,l=this.stree.root);for(;null!=l;)if(h=l,l=h.next,h.next=null,
h!=c)if(null==h.child1){if(g=h.shape,g.body!=d.body&&(g.body.type!=f.id_BodyType_STATIC||d.body.type!=f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<g.id?(k=d.id,m=g.id):(k=g.id,m=d.id);n=null;for(p=(d.pairs.length<g.pairs.length?d:g).pairs.head;null!=p;){t=p.elt;if(t.id==k&&t.di==m){n=t;break}p=p.next}null!=n?n.sleeping&&(n.sleeping=!1,n.next=this.pairs,this.pairs=n,n.first=!0):(null==Q.zpp_pool?n=new Q:(n=Q.zpp_pool,Q.zpp_pool=n.next,n.next=null),null,n.n1=c,n.n2=h,n.id=k,n.di=m,n.next=this.pairs,
this.pairs=n,n.first=!0,d.pairs.inlined_add(n),g.pairs.inlined_add(n))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=l,l=h.child1),null!=h.child2&&(h.child2.next=l,l=h.child2))}for(;null!=this.moves;)if(c=this.moves,this.moves=c.mnext,c.mnext=null,c.moved=!1,d=c.shape,!d.body.component.sleeping){e=c.aabb;l=null;null!=this.dtree.root&&(this.dtree.root.next=l,l=this.dtree.root);for(;null!=l;)if(h=l,l=h.next,h.next=null,h!=c)if(null==h.child1){if(g=h.shape,g.body!=d.body&&(g.body.type!=
f.id_BodyType_STATIC||d.body.type!=f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<g.id?(k=d.id,m=g.id):(k=g.id,m=d.id);n=null;for(p=(d.pairs.length<g.pairs.length?d:g).pairs.head;null!=p;){t=p.elt;if(t.id==k&&t.di==m){n=t;break}p=p.next}null!=n?n.sleeping&&(n.sleeping=!1,n.next=this.pairs,this.pairs=n,n.first=!0):(null==Q.zpp_pool?n=new Q:(n=Q.zpp_pool,Q.zpp_pool=n.next,n.next=null),null,n.n1=c,n.n2=h,n.id=k,n.di=m,n.next=this.pairs,this.pairs=n,n.first=!0,d.pairs.inlined_add(n),g.pairs.inlined_add(n))}}else e.intersect(h.aabb)&&
(null!=h.child1&&(h.child1.next=l,l=h.child1),null!=h.child2&&(h.child2.next=l,l=h.child2));null!=this.stree.root&&(this.stree.root.next=l,l=this.stree.root);for(;null!=l;)if(h=l,l=h.next,h.next=null,h!=c)if(null==h.child1){if(g=h.shape,g.body!=d.body&&(g.body.type!=f.id_BodyType_STATIC||d.body.type!=f.id_BodyType_STATIC)&&e.intersect(h.aabb)){d.id<g.id?(k=d.id,m=g.id):(k=g.id,m=d.id);n=null;for(p=(d.pairs.length<g.pairs.length?d:g).pairs.head;null!=p;){t=p.elt;if(t.id==k&&t.di==m){n=t;break}p=p.next}null!=
n?n.sleeping&&(n.sleeping=!1,n.next=this.pairs,this.pairs=n,n.first=!0):(null==Q.zpp_pool?n=new Q:(n=Q.zpp_pool,Q.zpp_pool=n.next,n.next=null),null,n.n1=c,n.n2=h,n.id=k,n.di=m,n.next=this.pairs,this.pairs=n,n.first=!0,d.pairs.inlined_add(n),g.pairs.inlined_add(n))}}else e.intersect(h.aabb)&&(null!=h.child1&&(h.child1.next=l,l=h.child1),null!=h.child2&&(h.child2.next=l,l=h.child2))}c=null;for(d=this.pairs;null!=d;)d.first||d.n1.aabb.intersect(d.n2.aabb)?(e=d.n1.shape,l=e.body,h=d.n2.shape,g=h.body,
d.first||!l.component.sleeping&&l.type!=f.id_BodyType_STATIC||!g.component.sleeping&&g.type!=f.id_BodyType_STATIC?(d.first=!1,e.aabb.intersect(h.aabb)&&(c=d.arb,d.arb=b?a.narrowPhase(e,h,l.type!=f.id_BodyType_DYNAMIC||g.type!=f.id_BodyType_DYNAMIC,d.arb,!1):a.continuousEvent(e,h,l.type!=f.id_BodyType_DYNAMIC||g.type!=f.id_BodyType_DYNAMIC,d.arb,!1),null==d.arb?null!=c&&(c.pair=null):d.arb.pair=d),c=d):(d.sleeping=!0,null==c?this.pairs=d.next:c.next=d.next),d=d.next):(null==c?this.pairs=d.next:c.next=
d.next,d.n1.shape.pairs.inlined_try_remove(d),d.n2.shape.pairs.inlined_try_remove(d),e=d.next,null!=d.arb&&(d.arb.pair=null),d.arb=null,d.n1=d.n2=null,d.sleeping=!1,d.next=Q.zpp_pool,Q.zpp_pool=d,d=e)},__class__:Ed});var Eb=function(){this.waket=0;this.sleep=!1;this.comps=null;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.comps=new Fd};Eb.__name__=!0;Eb.prototype={inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},
pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},__class__:Eb};var ka=function(){this.woken=!1;this.waket=0;this.sleeping=!1;this.body=this.constraint=this.island=null;this.isBody=!1;this.rank=0;this.next=this.parent=null;this.sleeping=!1;this.island=null;this.parent=this;this.rank=0;this.woken=!1};ka.__name__=!0;
ka.prototype={__class__:ka};var gb=function(){this.freed=this.lazydel=!1;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.int1=this.int2=this.next=null;this.id=this.di=0;this.arbiters=new zc};gb.__name__=!0;gb.get=function(a,b){var c;null==gb.zpp_pool?c=new gb:(c=gb.zpp_pool,gb.zpp_pool=c.next,c.next=null);c.freed=!1;c.lazydel=!1;c.COLLISIONstate=f.id_PreFlag_ACCEPT;c.COLLISIONstamp=0;c.SENSORstate=f.id_PreFlag_ACCEPT;c.SENSORstamp=0;c.FLUIDstate=f.id_PreFlag_ACCEPT;c.FLUIDstamp=0;a.id<
b.id?(c.int1=a,c.int2=b):(c.int1=b,c.int2=a);c.id=c.int1.id;c.di=c.int2.id;return c};gb.prototype={inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},remove_arb:function(a){this.arbiters.inlined_try_remove(a)},empty_arb:function(a){var b;
b=!0;for(var c=this.arbiters.head;null!=c;)if(0==(c.elt.type&a))c=c.next;else{b=!1;break}return b},sleeping:function(){var a;a=!0;for(var b=this.arbiters.head;null!=b;)if(b.elt.sleeping)b=b.next;else{a=!1;break}return a},__class__:gb};var Gd=function(a){this.cbsets=this.space=null;null==ab.zpp_pool?this.cbsets=new ab:(this.cbsets=ab.zpp_pool,ab.zpp_pool=this.cbsets.next,this.cbsets.next=null);null;this.cbsets.lt=G.setlt;this.space=a};Gd.__name__=!0;Gd.prototype={get:function(a){if(null==a.head)return null;
var b;null==G.zpp_pool?b=new G:(b=G.zpp_pool,G.zpp_pool=b.next,b.next=null);null;var c=b.cbTypes;b.cbTypes=a;var d=this.cbsets.find_weak(b);null!=d?a=d.data:(a=G.get(a),this.cbsets.insert(a),a.manager=this);b.cbTypes=c;b.free();b.next=G.zpp_pool;G.zpp_pool=b;return a},remove:function(a){for(this.cbsets.remove(a);null!=a.cbpairs.head;){var b=a.cbpairs.pop_unsafe();b.a!=b.b&&(a==b.a?b.b.cbpairs.remove(b):b.a.cbpairs.remove(b));b.a=b.b=null;b.listeners.clear();b.next=Z.zpp_pool;Z.zpp_pool=b}a.manager=
null},validate:function(){if(!this.cbsets.empty()){for(var a=this.cbsets.parent;null!=a.prev;)a=a.prev;for(;null!=a;)if(a.data.validate(),null!=a.next)for(a=a.next;null!=a.prev;)a=a.prev;else{for(;null!=a.parent&&a==a.parent.next;)a=a.parent;a=a.parent}}},pair:function(a,b){for(var c=null,d=(a.cbpairs.length<b.cbpairs.length?a.cbpairs:b.cbpairs).head;null!=d;){var e=d.elt;if(e.a==a&&e.b==b||e.a==b&&e.b==a){c=e;break}d=d.next}null==c&&(c=Z.get(a,b),a.cbpairs.add(c),b!=a&&b.cbpairs.add(c));c.zip_listeners&&
(c.zip_listeners=!1,c.__validate());return c},__class__:Gd};var Wd=function(a,b){this.precb=this.prelisteners=null;this.continuous=!1;this.toiEvents=null;this.pre_dt=0;this.c_arbiters_true=this.c_arbiters_false=this.f_arbiters=this.s_arbiters=this.live=this.wrap_live=this.live_constraints=this.wrap_livecon=this.staticsleep=this.islands=this.listeners=this.wrap_listeners=this.callbacks=this.callbackset_list=this.cbsets=null;this.sortcontacts=!1;this.time=0;this.midstep=!1;this.global_lin_drag=this.global_ang_drag=
this.stamp=0;this.bodies=this.wrap_bodies=this.compounds=this.wrap_compounds=this.constraints=this.wrap_constraints=this.kinematics=this.bphase=this.__static=null;this.gravityx=this.gravityy=0;this.outer=null;this.toiEvents=new ee;this.global_ang_drag=this.global_lin_drag=.015;U.internal=!0;this.precb=new Pc;this.precb.zpp_inner=new U;U.internal=!1;this.sortcontacts=!0;this.pre_dt=0;var c;(c=null==b)||(null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=!0,f.Broadphase_DYNAMIC_AABB_TREE=new ic,f.internal=
!1),c=b==f.Broadphase_DYNAMIC_AABB_TREE);c?this.bphase=new Ed(this):(null==f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new ic,f.internal=!1),b==f.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Hd(this)));this.time=0;null!=a?(this.gravityx=a.x,this.gravityy=a.y):this.gravityy=this.gravityx=0;this.bodies=new mc;this.wrap_bodies=ja.get(this.bodies);this.wrap_bodies.zpp_inner.adder=x(this,this.bodies_adder);this.wrap_bodies.zpp_inner.subber=x(this,this.bodies_subber);this.wrap_bodies.zpp_inner._modifiable=
x(this,this.bodies_modifiable);this.compounds=new Ac;this.wrap_compounds=qa.get(this.compounds);this.wrap_compounds.zpp_inner.adder=x(this,this.compounds_adder);this.wrap_compounds.zpp_inner.subber=x(this,this.compounds_subber);this.wrap_compounds.zpp_inner._modifiable=x(this,this.compounds_modifiable);this.kinematics=new mc;this.c_arbiters_true=new Xc;this.c_arbiters_false=new Xc;this.f_arbiters=new Id;this.s_arbiters=new fe;this.islands=new Eb;this.live=new mc;this.wrap_live=ja.get(this.live,!0);
this.staticsleep=new mc;this.constraints=new Ub;this.wrap_constraints=Da.get(this.constraints);this.wrap_constraints.zpp_inner.adder=x(this,this.constraints_adder);this.wrap_constraints.zpp_inner.subber=x(this,this.constraints_subber);this.wrap_constraints.zpp_inner._modifiable=x(this,this.constraints_modifiable);this.live_constraints=new Ub;this.wrap_livecon=Da.get(this.live_constraints,!0);this.__static=kb.__static();this.__static.zpp_inner.space=this;this.callbacks=new U;this.midstep=!1;this.listeners=
new rd;this.wrap_listeners=Xb.get(this.listeners);this.wrap_listeners.zpp_inner.adder=x(this,this.listeners_adder);this.wrap_listeners.zpp_inner.subber=x(this,this.listeners_subber);this.wrap_listeners.zpp_inner._modifiable=x(this,this.listeners_modifiable);this.callbackset_list=new gb;this.mrca1=new ec;this.mrca2=new ec;this.prelisteners=new Fc;this.cbsets=new Gd(this)};Wd.__name__=!0;Wd.prototype={bodies_adder:function(a){if(null!=a.zpp_inner.compound)throw new m("Error: Cannot set the space of a Body belonging to a Compound, only the root Compound space can be set");
return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(a),this.addBody(a.zpp_inner),!0):!1},bodies_subber:function(a){this.remBody(a.zpp_inner)},bodies_modifiable:function(){if(this.midstep)throw new m("Error: Space::bodies cannot be set during space step()");},compounds_adder:function(a){if(null!=a.zpp_inner.compound)throw new m("Error: Cannot set the space of an inner Compound, only the root Compound space can be set");return a.zpp_inner.space!=
this?(null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_compounds.remove(a),this.addCompound(a.zpp_inner),!0):!1},compounds_subber:function(a){this.remCompound(a.zpp_inner)},compounds_modifiable:function(){if(this.midstep)throw new m("Error: Space::compounds cannot be set during space step()");},constraints_adder:function(a){if(null!=a.zpp_inner.compound)throw new m("Error: Cannot set the space of a Constraint belonging to a Compound, only the root Compound space can be set");return a.zpp_inner.space!=
this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(a),this.addConstraint(a.zpp_inner),!0):!1},constraints_subber:function(a){this.remConstraint(a.zpp_inner)},constraints_modifiable:function(){if(this.midstep)throw new m("Error: Space::constraints cannot be set during space step()");},listeners_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(a),this.addListener(a.zpp_inner),!0):
!1},listeners_subber:function(a){this.remListener(a.zpp_inner)},listeners_modifiable:function(){if(this.midstep)throw new m("Error: Space::listeners cannot be set during space step()");},addListener:function(a){a.space=this;a.addedToSpace();null!=a.interaction&&null},remListener:function(a){null!=a.interaction&&null;a.removedFromSpace();a.space=null},add_callbackset:function(a){a.int1.cbsets.inlined_add(a);a.int2.cbsets.inlined_add(a);this.callbackset_list.inlined_add(a)},remove_callbackset:function(a){a.lazydel=
!0;a.int1.cbsets.inlined_try_remove(a);a.int2.cbsets.inlined_try_remove(a)},transmitType:function(a,b){a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!1));a.type==f.id_BodyType_DYNAMIC?this.live.remove(a):a.type==f.id_BodyType_KINEMATIC?(this.kinematics.remove(a),this.staticsleep.remove(a)):a.type==f.id_BodyType_STATIC&&this.staticsleep.remove(a);a.type=b;a.type==f.id_BodyType_KINEMATIC&&
this.kinematics.add(a);a.type==f.id_BodyType_STATIC&&this.static_validation(a);a.component.sleeping=!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0))},added_shape:function(a,b){null==b&&(b=!1);if(!b){var c=a.body;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,!1))}this.bphase.insert(a);
a.addedToSpace()},removed_shape:function(a,b){null==b&&(b=!1);var c=this,d=a.body;b||d.wake();for(var e=null,l=d.arbiters.head;null!=l;){var h=[l.elt];if(h[0].ws1==a||h[0].ws2==a){if(0!=h[0].present)for(this.MRCA_chains(h[0].ws1,h[0].ws2),l=this.mrca1.head;null!=l;){for(var g=l.elt,k=this.mrca2.head;null!=k;){var m=k.elt,n=g.cbSet,p=m.cbSet;n.validate();p.validate();n.manager.pair(n,p).empty_intersection()||(m=[H.get(g,m)],m[0].remove_arb(h[0]),h[0].present--,n.manager.pair(n,p).forall(f.id_CbEvent_END,
function(a,b){return function(d){if(0!=(d.itype&b[0].type)&&a[0].empty_arb(d.itype)){var e=c.push_callback(d);e.event=f.id_CbEvent_END;H.int_callback(a[0],d,e);e.set=a[0]}}}(m,h)),null==m[0].arbiters.head&&this.remove_callbackset(m[0]));k=k.next}l=l.next}h[0].b1!=d&&h[0].b1.type==f.id_BodyType_DYNAMIC&&(l=h[0].b1,l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==f.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1)));h[0].b2!=d&&h[0].b2.type==
f.id_BodyType_DYNAMIC&&(l=h[0].b2,l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==f.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1)));h[0].cleared=!0;null!=d&&h[0].b2!=d||h[0].b1.arbiters.inlined_try_remove(h[0]);null!=d&&h[0].b1!=d||h[0].b2.arbiters.inlined_try_remove(h[0]);null!=h[0].pair&&(h[0].pair.arb=null,h[0].pair=null);h[0].active=!1;this.f_arbiters.modified=!0;l=d.arbiters.erase(e)}else e=l,l=l.next}this.bphase.remove(a);a.removedFromSpace()},
addConstraint:function(a){a.space=this;a.addedToSpace();a.active&&(a.component.sleeping=!0,this.wake_constraint(a,!0))},remConstraint:function(a){a.active&&(this.wake_constraint(a,!0),this.live_constraints.remove(a));a.removedFromSpace();a.space=null},addCompound:function(a){a.space=this;a.addedToSpace();for(var b=a.bodies.head;null!=b;)this.addBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.addConstraint(b.elt),b=b.next;for(a=a.compounds.head;null!=a;)this.addCompound(a.elt),a=a.next},
remCompound:function(a){for(var b=a.bodies.head;null!=b;)this.remBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.remConstraint(b.elt),b=b.next;for(b=a.compounds.head;null!=b;)this.remCompound(b.elt),b=b.next;a.removedFromSpace();a.space=null},addBody:function(a,b){null==b&&(b=-1);a.space=this;a.addedToSpace();a.component.sleeping=!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,
!0));for(var c=a.shapes.head;null!=c;)this.added_shape(c.elt,!0),c=c.next;a.type==f.id_BodyType_STATIC?this.static_validation(a):a.type!=f.id_BodyType_DYNAMIC&&b!=f.id_BodyType_KINEMATIC&&this.kinematics.add(a)},remBody:function(a,b){null==b&&(b=-1);a.type==f.id_BodyType_STATIC?(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a)):a.type==f.id_BodyType_DYNAMIC?
(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.live.remove(a)):(b!=f.id_BodyType_KINEMATIC&&this.kinematics.remove(a),a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a));for(var c=a.shapes.head;null!=c;)this.removed_shape(c.elt,!0),c=c.next;
a.removedFromSpace();a.space=null},push_callback:function(a){var b;null==U.zpp_pool?b=new U:(b=U.zpp_pool,U.zpp_pool=b.next,b.next=null);null;this.callbacks.push(b);b.listener=a;return b},step:function(a,b,c){var d=this;if(this.midstep)throw new m("Error: ... REALLY?? you're going to call space.step() inside of space.step()? COME ON!!");this.time+=a;this.pre_dt=a;this.midstep=!0;this.stamp++;this.validation();this.bphase.broadphase(this,!0);this.prestep(a);if(this.sortcontacts){var e=this.c_arbiters_false;
if(null!=e.head&&null!=e.head.next){var l=e.head,h=null,g=null,k=null,p=null,n=1,q,t,w;do{q=0;g=l;for(h=l=null;null!=g;){q++;k=g;t=0;for(w=n;null!=k&&t<n;)t++,k=k.next;for(;0<t||0<w&&null!=k;)0==t?(p=k,k=k.next,w--):0==w||null==k?(p=g,g=g.next,t--):(g.elt.active&&k.elt.active?g.elt.oc1.dist<k.elt.oc1.dist:1)?(p=g,g=g.next,t--):(p=k,k=k.next,w--),null!=h?h.next=p:l=p,h=p;g=k}h.next=null;n<<=1}while(1<q);e.head=l;e.modified=!0;e.pushmod=!0}}this.updateVel(a);this.warmStart();this.iterateVel(b);for(b=
this.kinematics.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,b=b.next;for(b=this.live.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,b=b.next;this.updatePos(a);this.continuous=!0;this.continuousCollisions(a);this.continuous=!1;this.iteratePos(c);for(c=this.kinematics.head;null!=c;)b=c.elt,e=b.pre_rot!=b.rot,b.posx==b.pre_posx&&b.posy==b.pre_posy||b.invalidate_pos(),e&&b.invalidate_rot(),c=c.next;for(c=this.live.head;null!=c;)b=c.elt,e=b.pre_rot!=
b.rot,b.posx==b.pre_posx&&b.posy==b.pre_posy||b.invalidate_pos(),e&&b.invalidate_rot(),c=c.next;c=null;for(b=this.staticsleep.head;null!=b;)e=b.elt,e.type!=f.id_BodyType_KINEMATIC||0==e.velx&&0==e.vely&&0==e.angvel?e.kinematicDelaySleep?(e.kinematicDelaySleep=!1,b=b.next):(e.component.sleeping=!0,b=this.staticsleep.inlined_erase(c)):(c=b,b=b.next);this.doForests(a);this.sleepArbiters();this.midstep=!1;c=null;for(a=this.callbackset_list.next;null!=a;)b=[a],null==b[0].arbiters.head?(a=this.callbackset_list.inlined_erase(c),
b=b[0],b.int1=b.int2=null,b.id=b.di=-1,b.freed=!0,null,b.next=gb.zpp_pool,gb.zpp_pool=b):(c=[b[0].sleeping()],G.find_all(b[0].int1.cbSet,b[0].int2.cbSet,f.id_CbEvent_ONGOING,function(a,b){return function(c){if((!a[0]||c.allowSleepingCallbacks)&&!b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_ONGOING;H.int_callback(b[0],c,e);e.set=b[0]}}}(c,b)),c=a,a=a.next);for(;!this.callbacks.empty();)a=this.callbacks.pop(),a.listener.type==f.id_ListenerType_BODY?a.listener.body.handler(a.wrapper_body()):
a.listener.type==f.id_ListenerType_CONSTRAINT?a.listener.constraint.handler(a.wrapper_con()):a.listener.type==f.id_ListenerType_INTERACTION&&a.listener.interaction.handleri(a.wrapper_int()),a.int1=a.int2=null,a.body=null,a.constraint=null,a.listener=null,null!=a.wrap_arbiters&&(a.wrap_arbiters.zpp_inner.inner=null),a.set=null,a.next=U.zpp_pool,U.zpp_pool=a},continuousCollisions:function(a){var b=2*Math.PI/a;this.bphase.broadphase(this,!1);for(var c=0;1>c&&null!=this.toiEvents.head;){for(var d=null,
c=2,e=!1,l=null,h=null,g=this.toiEvents.head;null!=g;){var k=g.elt,m=k.s1.body,n=k.s2.body;if(m.sweepFrozen&&n.sweepFrozen)if(0!=k.toi&&q.testCollide_safe(k.s1,k.s2))k.toi=0;else{g=this.toiEvents.erase(h);k.next=P.zpp_pool;P.zpp_pool=k;continue}if(k.frozen1!=m.sweepFrozen||k.frozen2!=n.sweepFrozen)if(k.kinematic){g=this.toiEvents.erase(h);k.next=P.zpp_pool;P.zpp_pool=k;continue}else if(k.frozen1=m.sweepFrozen,k.frozen2=n.sweepFrozen,k.frozen1&&(m=k.s1,k.s1=k.s2,k.s2=m,k.frozen1=!1,k.frozen2=!0),ta.staticSweep(k,
a,0,p.collisionSlopCCD),0>k.toi){g=this.toiEvents.erase(h);k.next=P.zpp_pool;P.zpp_pool=k;continue}0<=k.toi&&(k.toi<c||!e&&k.kinematic)&&(d=k,c=k.toi,e=k.kinematic,l=h);h=g;g=g.next}if(null==d)break;this.toiEvents.erase(l);c=d.toi;e=d.s1.body;l=d.s2.body;e.sweepFrozen||(e.sweepIntegrate(c*a),e.sweepValidate(d.s1));l.sweepFrozen||(l.sweepIntegrate(c*a),l.sweepValidate(d.s2));h=this.narrowPhase(d.s1,d.s2,!0,d.arbiter,!0);null==h?null!=d.arbiter&&null!=d.arbiter.pair&&(d.arbiter.pair.arb=null,d.arbiter.pair=
null):!this.presteparb(h,a,!0)&&h.type==z.COL&&h.active&&0!=(h.immState&f.id_ImmState_ACCEPT)&&(h.colarb.warmStart(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),h.colarb.applyImpulseVel(),e.sweep_angvel=e.angvel%b,l.sweep_angvel=l.angvel%b);null!=h&&h.active&&0!=(h.immState&f.id_ImmState_ACCEPT)&&h.type==z.COL&&(e.sweepFrozen||e.type==f.id_BodyType_KINEMATIC||(e.sweepFrozen=!0,e.angvel=d.failed?e.sweep_angvel=0:d.slipped?e.sweep_angvel*=p.angularCCDSlipScale:e.sweep_angvel),
l.sweepFrozen||l.type==f.id_BodyType_KINEMATIC||(l.sweepFrozen=!0,l.angvel=d.failed?l.sweep_angvel=0:d.slipped?l.sweep_angvel*=p.angularCCDSlipScale:l.sweep_angvel));d.next=P.zpp_pool;P.zpp_pool=d}for(;null!=this.toiEvents.head;)b=this.toiEvents.pop_unsafe(),b.next=P.zpp_pool,P.zpp_pool=b;for(b=this.kinematics.head;null!=b;)d=b.elt,d.sweepIntegrate(a),d.sweepTime=0,b=b.next;for(b=this.live.head;null!=b;)d=b.elt,d.sweepFrozen||d.sweepIntegrate(a),d.sweepTime=0,b=b.next},continuousEvent:function(a,
b,c,d,e){if(a.body.sweepFrozen&&b.body.sweepFrozen||a.body.disableCCD||b.body.disableCCD||null!=d&&null==d.colarb||0>=this.interactionType(a,b,a.body,b.body))return d;var l=a.body,h=b.body;if(c||l.bullet||h.bullet)null==P.zpp_pool?e=new P:(e=P.zpp_pool,P.zpp_pool=e.next,e.next=null),e.failed=!1,e.s1=e.s2=null,e.arbiter=null,l=l.type==f.id_BodyType_KINEMATIC||h.type==f.id_BodyType_KINEMATIC,c&&!l?(a.body.type!=f.id_BodyType_DYNAMIC?(e.s2=a,e.s1=b):(e.s1=a,e.s2=b),e.kinematic=!1,ta.staticSweep(e,this.pre_dt,
0,p.collisionSlopCCD)):(e.s1=a,e.s2=b,e.kinematic=l,e.s1.body.sweepFrozen||e.s2.body.sweepFrozen?(e.s1.body.sweepFrozen&&(a=e.s1,e.s1=e.s2,e.s2=a,e.frozen1=!1,e.frozen2=!0),ta.staticSweep(e,this.pre_dt,0,p.collisionSlopCCD)):ta.dynamicSweep(e,this.pre_dt,0,p.collisionSlopCCD)),c&&0>e.toi||e.failed?(c=e,c.next=P.zpp_pool,P.zpp_pool=c):(this.toiEvents.add(e),e.frozen1=e.s1.body.sweepFrozen,e.frozen2=e.s2.body.sweepFrozen,e.arbiter=null!=d?d.colarb:null);return d},bodyCbWake:function(a){if(a.type==f.id_BodyType_DYNAMIC&&
null!=a.cbSet)if(this.midstep)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.body=a);b=b.next}else a.component.woken=!0},bodyCbSleep:function(a){if(a.type==f.id_BodyType_DYNAMIC&&null!=a.cbSet)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),c.event=f.id_CbEvent_SLEEP,c.body=a);b=b.next}},constraintCbWake:function(a){if(null!=a.cbSet)if(this.midstep)for(var b=
a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.constraint=a);b=b.next}else a.component.woken=!0},constraintCbSleep:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),c.event=f.id_CbEvent_SLEEP,c.constraint=a);b=b.next}},constraintCbBreak:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==
f.id_CbEvent_BREAK&&(c=this.push_callback(c),c.event=f.id_CbEvent_BREAK,c.constraint=a);b=b.next}},nullListenerType:function(a,b){for(var c=new ec,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=d.icompound,e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else for(e=null!=d.ibody?d.ibody:d.ishape.body,d=null!=d.ishape?
d.ishape:null,e=e.arbiters.head;null!=e;){var f=e.elt;if(0!=f.present&&(null==d||f.ws1==d||f.ws2==d))for(this.MRCA_chains(f.ws1,f.ws2),f=this.mrca1.head;null!=f;){var h=f.elt;if(h.cbSet==a||h.cbSet==b)for(var g=this.mrca2.head;null!=g;){var k=g.elt;if(!(h.cbSet==a&&k.cbSet!=b||h.cbSet==b&&k.cbSet!=a)&&(k=H.get(h,k),null!=k)){for(;null!=k.arbiters.head;)k.arbiters.pop_unsafe().present--;this.remove_callbackset(k)}g=g.next}f=f.next}e=e.next}},nullInteractorType:function(a,b){null==b&&(b=a);if(null!=
a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.nullInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.nullInteractorType(c.elt,b),c=c.next}else for(d=null!=a.ibody?a.ibody:a.ishape.body,c=null!=a.ishape?a.ishape:null,d=d.arbiters.head;null!=d;){var e=d.elt;if(0!=e.present&&(null==c||e.ws1==c||e.ws2==c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var h=f.elt,g=this.mrca2.head;null!=g;){var k=g.elt;if(h==b||k==b)k=H.get(h,k),null!=k&&(e.present--,
k.remove_arb(e),null==k.arbiters.head&&this.remove_callbackset(k));g=g.next}f=f.next}}d=d.next}},freshListenerType:function(a,b){for(var c=new ec,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=d.icompound,e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else for(e=null!=d.ibody?d.ibody:d.ishape.body,d=null!=d.ishape?
d.ishape:null,e=e.arbiters.head;null!=e;){var f=e.elt;if(f.presentable&&(null==d||f.ws1==d||f.ws2==d)){this.MRCA_chains(f.ws1,f.ws2);for(var h=this.mrca1.head;null!=h;){var g=h.elt;if(g.cbSet==a||g.cbSet==b)for(var k=this.mrca2.head;null!=k;){var m=k.elt;if(!(g.cbSet==a&&m.cbSet!=b||g.cbSet==b&&m.cbSet!=a)){var n=H.get(g,m);null==n&&(n=gb.get(g,m),this.add_callbackset(n));n.arbiters.inlined_has(f)?n=!1:(m=void 0,n.arbiters.inlined_add(f),n=m=!0);n&&f.present++}k=k.next}h=h.next}}e=e.next}},freshInteractorType:function(a,
b){null==b&&(b=a);if(null!=a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.freshInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.freshInteractorType(c.elt,b),c=c.next}else for(d=null!=a.ibody?a.ibody:a.ishape.body,c=null!=a.ishape?a.ishape:null,d=d.arbiters.head;null!=d;){var e=d.elt;if(e.presentable&&(null==c||e.ws1==c||e.ws2==c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var h=f.elt,g=this.mrca2.head;null!=g;){var k=g.elt;if(h==b||
k==b){var m=h.cbSet,n=k.cbSet;m.validate();n.validate();m.manager.pair(m,n).empty_intersection()||(m=H.get(h,k),null==m&&(m=gb.get(h,k),this.add_callbackset(m)),m.arbiters.inlined_has(e)?k=!1:(k=void 0,m.arbiters.inlined_add(e),k=!0),k&&e.present++)}g=g.next}f=f.next}}d=d.next}},wakeCompound:function(a){for(var b=a.bodies.head;null!=b;){var c=b.elt;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,
!1));b=b.next}for(b=a.constraints.head;null!=b;)this.wake_constraint(b.elt),b=b.next;for(a=a.compounds.head;null!=a;)this.wakeCompound(a.elt),a=a.next},wakeIsland:function(a){for(;null!=a.comps.head;){var b=a.comps.pop_unsafe();b.waket=this.stamp+(this.midstep?0:1);if(b.isBody){var c=b.body;this.live.add(c);for(var d=c.arbiters.head;null!=d;){var e=d.elt;e.sleeping&&(e.sleeping=!1,e.up_stamp+=this.stamp-e.sleep_stamp,e.type==z.COL?(e=e.colarb,e.stat?this.c_arbiters_true.inlined_add(e):this.c_arbiters_false.inlined_add(e)):
e.type==z.FLUID?this.f_arbiters.inlined_add(e.fluidarb):this.s_arbiters.inlined_add(e.sensorarb));d=d.next}this.bodyCbWake(c);b.sleeping=!1;b.island=null;b.parent=b;b.rank=0;if(c.type!=f.id_BodyType_STATIC)for(b=c.shapes.head;null!=b;)c=b.elt,null!=c.node&&this.bphase.sync(c),b=b.next}else c=b.constraint,this.live_constraints.inlined_add(c),this.constraintCbWake(c),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0}a.next=Eb.zpp_pool;Eb.zpp_pool=a},non_inlined_wake:function(a,b){null==b&&(b=!1);a.world||
(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,b))},really_wake:function(a,b){null==b&&(b=!1);if(null==a.component.island){a.component.sleeping=!1;a.type==f.id_BodyType_KINEMATIC||a.type==f.id_BodyType_STATIC?this.staticsleep.inlined_add(a):this.live.inlined_add(a);for(var c=a.constraints.head;null!=c;){var d=c.elt;d.space==this&&this.wake_constraint(d);c=c.next}for(c=a.arbiters.head;null!=c;){d=
c.elt;if(d.sleeping)if(d.sleeping=!1,d.up_stamp+=this.stamp+(this.midstep?0:1)-d.sleep_stamp,d.type==z.COL){var e=d.colarb;e.stat?this.c_arbiters_true.inlined_add(e):this.c_arbiters_false.inlined_add(e)}else d.type==z.FLUID?this.f_arbiters.inlined_add(d.fluidarb):this.s_arbiters.inlined_add(d.sensorarb);d.type!=z.SENSOR&&!d.cleared&&d.up_stamp>=this.stamp&&0!=(d.immState&f.id_ImmState_ACCEPT)&&(d.b1.type==f.id_BodyType_DYNAMIC&&d.b1.component.sleeping&&(e=d.b1,e.world||(e.component.waket=this.stamp+
(this.midstep?0:1),e.type==f.id_BodyType_KINEMATIC&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1))),d.b2.type==f.id_BodyType_DYNAMIC&&d.b2.component.sleeping&&(d=d.b2,d.world||(d.component.waket=this.stamp+(this.midstep?0:1),d.type==f.id_BodyType_KINEMATIC&&(d.kinematicDelaySleep=!0),d.component.sleeping&&this.really_wake(d,!1))));c=c.next}b||a.type!=f.id_BodyType_DYNAMIC||this.bodyCbWake(a);if(!b&&!this.bphase.is_sweep&&a.type!=f.id_BodyType_STATIC)for(c=a.shapes.head;null!=
c;)d=c.elt,null!=d.node&&this.bphase.sync(d),c=c.next}else this.wakeIsland(a.component.island)},wake_constraint:function(a,b){null==b&&(b=!1);return a.active&&(a.component.waket=this.stamp+(this.midstep?0:1),a.component.sleeping)?(null==a.component.island?(a.component.sleeping=!1,this.live_constraints.inlined_add(a),a.wake_connected(),b||this.constraintCbWake(a)):this.wakeIsland(a.component.island),!0):!1},doForests:function(a){for(var b=this.c_arbiters_false.head;null!=b;){var c=b.elt;if(!c.cleared&&
c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){var d;if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(var e=null;d!=d.parent;){var l=d.parent;d.parent=e;e=d;d=l}for(;null!=e;)l=e.parent,e.parent=d,e=l}if(c.b2.component==c.b2.component.parent)c=c.b2.component;else{c=c.b2.component;for(e=null;c!=c.parent;)l=c.parent,c.parent=e,e=c,c=l;for(;null!=e;)l=e.parent,e.parent=c,e=l}d!=c&&(d.rank<
c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.f_arbiters.head;null!=b;){c=b.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(e=null;d!=d.parent;)l=d.parent,d.parent=e,e=d,d=l;for(;null!=e;)l=e.parent,e.parent=d,e=l}if(c.b2.component==c.b2.component.parent)c=c.b2.component;else{c=
c.b2.component;for(e=null;c!=c.parent;)l=c.parent,c.parent=e,e=c,c=l;for(;null!=e;)l=e.parent,e.parent=c,e=l}d!=c&&(d.rank<c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.live_constraints.head;null!=b;)b.elt.forest(),b=b.next;for(;null!=this.live.head;){d=this.live.inlined_pop_unsafe();b=d.component;if(b==b.parent)c=b;else{c=b;for(e=null;c!=c.parent;)l=c.parent,c.parent=e,e=c,c=l;for(;null!=e;)l=e.parent,e.parent=c,e=l}null==c.island&&(null==Eb.zpp_pool?c.island=
new Eb:(c.island=Eb.zpp_pool,Eb.zpp_pool=c.island.next,c.island.next=null),c.island.waket=0,this.islands.inlined_add(c.island),c.island.sleep=!0);b.island=c.island;b.island.comps.inlined_add(b);d=d.atRest(a);b.island.sleep=b.island.sleep&&d;b.waket>b.island.waket&&(b.island.waket=b.waket)}for(;null!=this.live_constraints.head;){a=this.live_constraints.inlined_pop_unsafe().component;if(a==a.parent)b=a;else{b=a;for(d=null;b!=b.parent;)c=b.parent,b.parent=d,d=b,b=c;for(;null!=d;)c=d.parent,d.parent=
b,d=c}a.island=b.island;a.island.comps.inlined_add(a);a.waket>a.island.waket&&(a.island.waket=a.waket)}for(;null!=this.islands.next;)if(a=this.islands.inlined_pop_unsafe(),a.sleep)for(a=a.comps.head;null!=a;){d=a.elt;if(d.isBody){b=d.body;b.velx=0;b.vely=0;b.angvel=0;d.sleeping=!0;for(d=b.shapes.head;null!=d;)this.bphase.sync(d.elt),d=d.next;this.bodyCbSleep(b)}else this.constraintCbSleep(d.constraint),d.sleeping=!0;a=a.next}else{for(;null!=a.comps.head;)b=a.comps.inlined_pop_unsafe(),b.waket=a.waket,
b.isBody?this.live.inlined_add(b.body):this.live_constraints.inlined_add(b.constraint),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0;a.next=Eb.zpp_pool;Eb.zpp_pool=a}},sleepArbiters:function(){var a=null,b=this.c_arbiters_true,c=b.head,d=null!=this.c_arbiters_false;d&&null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null);for(;null!=c;){var e=c.elt;e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next);d&&
null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null)}a=null;b=this.f_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==c&&(d=!1,a=b=null);a=null;b=this.s_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==c&&(d=!1,a=b=null)},
static_validation:function(a){null!=a.shapes.head&&a.validate_aabb();a.validate_mass();a.validate_inertia();if(0!=a.velx||0!=a.vely||0!=a.angvel)throw new m("Error: Static body cannot have any real velocity, only kinematic or surface velocities");for(var b=a.shapes.head;null!=b;){var c=b.elt;if(c.type==f.id_ShapeType_POLYGON){c.polygon.splice_collinear();var d=c.polygon.valid(),e=d,l=void 0;null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=new J,f.internal=!1);l=f.ValidationResult_VALID;
if(e!=l)throw new m("Error: Cannot simulate with an invalid Polygon : "+c.polygon.outer.toString()+" is invalid : "+d.toString());c.polygon.validate_gaxi()}b=b.next}a.sweepFrozen=!0},validation:function(){this.cbsets.validate();for(var a=this.live.head;null!=a;){var b=a.elt;b.sweepRadius=0;for(var c=b.shapes.head;null!=c;){var d=c.elt;if(d.type==f.id_ShapeType_POLYGON){d.polygon.splice_collinear();var e=d.polygon.valid(),l=e;null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=
new J,f.internal=!1);if(l!=f.ValidationResult_VALID)throw new m("Error: Cannot simulate with an invalid Polygon : "+d.polygon.outer.toString()+" is invalid : "+e.toString());d.polygon.validate_gaxi()}d.validate_sweepRadius();d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius);c=c.next}b.validate_mass();b.validate_inertia();null!=b.shapes.head&&(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);if(!b.nomove&&
b.type==f.id_BodyType_DYNAMIC&&0==b.mass)throw new m("Error: Dynamic Body cannot be simulated with 0 mass unless allowMovement is false");if(!b.norotate&&b.type==f.id_BodyType_DYNAMIC&&0==b.inertia)throw new m("Error: Dynamic Body cannot be simulated with 0 inertia unless allowRotation is false");if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.bodylisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.body=b),c=c.next;b.component.woken=!1;
for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.kinematics.head;null!=a;){b=a.elt;b.sweepRadius=0;for(c=b.shapes.head;null!=c;){d=c.elt;if(d.type==f.id_ShapeType_POLYGON){d.polygon.splice_collinear();l=e=d.polygon.valid();null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=new J,f.internal=!1);if(l!=f.ValidationResult_VALID)throw new m("Error: Cannot simulate with an invalid Polygon : "+d.polygon.outer.toString()+" is invalid : "+e.toString());
d.polygon.validate_gaxi()}d.validate_sweepRadius();d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius);c=c.next}b.validate_mass();b.validate_inertia();null!=b.shapes.head&&(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);if(!b.nomove&&b.type==f.id_BodyType_DYNAMIC&&0==b.mass)throw new m("Error: Dynamic Body cannot be simulated with 0 mass unless allowMovement is false");if(!b.norotate&&b.type==f.id_BodyType_DYNAMIC&&
0==b.inertia)throw new m("Error: Dynamic Body cannot be simulated with 0 inertia unless allowRotation is false");for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.live_constraints.head;null!=a;){b=a.elt;if(b.active){b.validate();if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.conlisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.constraint=b),c=c.next;b.component.woken=!1}a=a.next}},updateVel:function(a){for(var b=
1-a*this.global_lin_drag,c=1-a*this.global_ang_drag,d=this.live.head;null!=d;){var e=d.elt;if(0!=e.smass){var f=a*e.imass;e.velx=b*e.velx+(e.forcex+this.gravityx*e.gravMass)*f;e.vely=b*e.vely+(e.forcey+this.gravityy*e.gravMass)*f}if(0!=e.sinertia){var h=f=0,f=e.worldCOMx-e.posx,h=e.worldCOMy-e.posy;e.angvel=c*e.angvel+(e.torque+(this.gravityy*f-this.gravityx*h)*e.gravMass)*a*e.iinertia}d=d.next}},updatePos:function(a){for(var b=2*Math.PI/a,c=this.live.head;null!=c;){var d=c.elt;d.pre_posx=d.posx;
d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else{var e=p.staticCCDLinearThreshold*d.sweepRadius,l=p.staticCCDAngularThreshold;if((d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>l*l||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);for(var l=1/e,h=d.shapes.head;null!=h;){var g=h.elt,k=g.aabb,m=k.minx,n=k.miny,q=k.maxx,t=k.maxy,w=e*a*g.sweepCoef*.008333333333333333|0;8<w&&(w=8);var x=
e*a/w;d.sweepIntegrate(a);g.type==f.id_ShapeType_CIRCLE?g.circle._force_validate_aabb():g.polygon._force_validate_aabb();m<k.minx?k.minx=m:m=k.minx;n<k.miny?k.miny=n:n=k.miny;q>k.maxx?k.maxx=q:q=k.maxx;t>k.maxy?k.maxy=t:t=k.maxy;for(var z=1;z<w;){var A=z++;d.sweepIntegrate(x*A*l);g.type==f.id_ShapeType_CIRCLE?g.circle._force_validate_aabb():g.polygon._force_validate_aabb();m<k.minx?k.minx=m:m=k.minx;n<k.miny?k.miny=n:n=k.miny;q>k.maxx?k.maxx=q:q=k.maxx;t>k.maxy?k.maxy=t:t=k.maxy}this.bphase.sync(g);
h=h.next}d.sweepFrozen=!1;d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=p.bulletCCDLinearThreshold*d.sweepRadius,l=p.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>l*l)&&(d.bullet=!0)}else d.sweepFrozen=!0,d.bullet=!1}c=c.next}for(c=this.kinematics.head;null!=c;){d=c.elt;d.pre_posx=d.posx;d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else if(e=p.staticCCDLinearThreshold*
d.sweepRadius,l=p.staticCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>l*l||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);l=1/e;for(h=d.shapes.head;null!=h;){g=h.elt;k=g.aabb;m=k.minx;n=k.miny;q=k.maxx;t=k.maxy;w=e*a*g.sweepCoef*.008333333333333333|0;8<w&&(w=8);x=e*a/w;d.sweepIntegrate(a);g.type==f.id_ShapeType_CIRCLE?g.circle._force_validate_aabb():g.polygon._force_validate_aabb();m<k.minx?k.minx=m:m=k.minx;n<k.miny?k.miny=n:n=k.miny;q>k.maxx?k.maxx=
q:q=k.maxx;t>k.maxy?k.maxy=t:t=k.maxy;for(z=1;z<w;)A=z++,d.sweepIntegrate(x*A*l),g.type==f.id_ShapeType_CIRCLE?g.circle._force_validate_aabb():g.polygon._force_validate_aabb(),m<k.minx?k.minx=m:m=k.minx,n<k.miny?k.miny=n:n=k.miny,q>k.maxx?k.maxx=q:q=k.maxx,t>k.maxy?k.maxy=t:t=k.maxy;this.bphase.sync(g);h=h.next}d.sweepFrozen=!1;d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=p.bulletCCDLinearThreshold*d.sweepRadius,l=p.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*
a*a>l*l)&&(d.bullet=!0)}else d.sweepFrozen=!0,d.bullet=!1;c=c.next}},presteparb:function(a,b,c){null==c&&(c=!1);var d=this;if(!a.cleared&&a.b1.component.sleeping&&a.b2.component.sleeping)return a.sleep_stamp=this.stamp,a.sleeping=!0;if(!a.cleared||0!=a.present||a.intchange){var e=!c&&a.up_stamp==this.stamp-1&&!a.cleared&&!a.intchange;c=a.fresh&&!a.cleared&&!a.intchange;e&&(a.endGenerated=this.stamp);if(c||e||a.cleared||a.intchange)for(this.inlined_MRCA_chains(a.ws1,a.ws2),e=this.mrca1.head;null!=
e;){for(var l=e.elt,h=this.mrca2.head;null!=h;){var g=h.elt,k=l.cbSet,m=g.cbSet;if(!k.manager.pair(k,m).empty_intersection()){var n=[H.get(l,g)];c||a.intchange?(null==n[0]&&(n[0]=gb.get(l,g),this.add_callbackset(n[0])),k.manager.pair(k,m).forall(f.id_CbEvent_BEGIN,function(b){return function(c){if(0!=(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_BEGIN;H.int_callback(b[0],c,e);e.set=b[0]}}}(n)),n[0].arbiters.inlined_has(a)?g=0:(n[0].arbiters.inlined_add(a),
g=!0),g&&a.present++):(a.present--,n[0].remove_arb(a),k.manager.pair(k,m).forall(f.id_CbEvent_END,function(b){return function(c){if(0!=(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_END;H.int_callback(b[0],c,e);e.set=b[0]}}}(n)),null==n[0].arbiters.head&&this.remove_callbackset(n[0]))}h=h.next}e=e.next}a.fresh=!1;a.intchange=!1}if(a.cleared||a.up_stamp+(a.type==z.COL?p.arbiterExpirationDelay:0)<this.stamp)return a.type==z.SENSOR?a.sensorarb.retire():a.type==
z.FLUID?a.fluidarb.retire():a.colarb.retire(),!0;c=a.active;a.active=a.presentable=a.up_stamp==this.stamp;0!=(a.immState&f.id_ImmState_ACCEPT)?a.active&&a.type!=z.SENSOR&&(null!=a.colarb?a.colarb.preStep(b)&&(a.active=!1):a.fluidarb.preStep(this,b)):null!=a.colarb&&a.colarb.cleanupContacts()&&(a.active=!1);c!=a.active&&(a.b1.arbiters.modified=!0,a.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0);return!1},
prestep:function(a){for(var b=null,c=this.live_constraints.head;null!=c;){var d=c.elt;d.preStep(a)?(c=this.live_constraints.erase(b),d.broken(),this.constraintCbBreak(d),d.removeOnBreak?(d.component.sleeping=!0,this.midstep=!1,null!=d.compound?d.compound.wrap_constraints.remove(d.outer):this.wrap_constraints.remove(d.outer),this.midstep=!0):d.active=!1,d.clearcache()):(b=c,c=c.next)}var b=null,c=this.c_arbiters_true,d=c.head,e=null!=this.c_arbiters_false;e&&null==d&&(e=!1,d=this.c_arbiters_false.head,
c=this.c_arbiters_false,b=null);for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,d=this.c_arbiters_false.head,c=this.c_arbiters_false,b=null);b=null;c=this.f_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,b=c=null);b=null;c=this.s_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,b=c=null)},warmStart:function(){for(var a=
this.f_arbiters.head;null!=a;){var b=a.elt;b.active&&0!=(b.immState&f.id_ImmState_ACCEPT)&&b.warmStart();a=a.next}a=this.c_arbiters_false.head;b=!0;null==a&&(a=this.c_arbiters_true.head,b=!1);for(;null!=a;){var c=a.elt;c.active&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.warmStart();a=a.next;b&&null==a&&(a=this.c_arbiters_true.head,b=!1)}for(a=this.live_constraints.head;null!=a;)a.elt.warmStart(),a=a.next},iterateVel:function(a){for(var b=0;b<a;){b++;for(var c=this.f_arbiters.head;null!=c;){var d=c.elt;
d.active&&0!=(d.immState&f.id_ImmState_ACCEPT)&&d.applyImpulseVel();c=c.next}c=null;for(d=this.live_constraints.head;null!=d;){var e=d.elt;e.applyImpulseVel()?(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):this.wrap_constraints.remove(e.outer),this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==c&&(c=this.c_arbiters_true.head,
d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulseVel(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}},iteratePos:function(a){for(var b=0;b<a;){b++;for(var c=null,d=this.live_constraints.head;null!=d;){var e=d.elt;!e.__velocity&&e.stiff&&e.applyImpulsePos()?(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):this.wrap_constraints.remove(e.outer),
this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==c&&(c=this.c_arbiters_true.head,d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulsePos(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}},group_ignore:function(a,b){var c=a.lookup_group();if(null==c)return!1;var d=b.lookup_group();if(null==d)return!1;for(var e=!1;null!=c&&null!=d;){if(c==d){e=c.ignore;break}c.depth<d.depth?d=d.group:c=c.group}return e},
interactionType:function(a,b,c,d){var e;e=!1;for(var f=c.constraints.head;null!=f;){var h=f.elt;if(h.ignore&&h.pair_exists(c.id,d.id)){e=!0;break}f=f.next}return e||this.group_ignore(a,b)?-1:(a.sensorEnabled||b.sensorEnabled)&&a.filter.shouldSense(b.filter)?2:!a.fluidEnabled&&!b.fluidEnabled||!a.filter.shouldFlow(b.filter)||0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia?!a.filter.shouldCollide(b.filter)||0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia?-1:1:0},narrowPhase:function(a,b,c,
d,e){var l=this,h=null,g=a.body,k=b.body,m=this.interactionType(a,b,g,k);if(-1!=m){var n,p;a.type>b.type?(n=b,p=a):a.type==b.type?a.id<b.id?(n=a,p=b):(p=a,n=b):(n=a,p=b);var t=n==b;if(0==m){var w;if(null==d){for(var x=null,z=(g.arbiters.length<k.arbiters.length?g:k).arbiters.head;null!=z;){var A=z.elt;if(A.id==n.id&&A.di==p.id){x=A;break}z=z.next}w=x}else w=d;var B=null==w,v,C=!1;B?(null==cb.zpp_pool?v=new cb:(v=cb.zpp_pool,cb.zpp_pool=v.next,v.next=null),null):null==w.fluidarb?(w.cleared=!0,w.b1.arbiters.inlined_try_remove(w),
w.b2.arbiters.inlined_try_remove(w),null!=w.pair&&(w.pair.arb=null,w.pair=null),w.active=!1,this.f_arbiters.modified=!0,null==cb.zpp_pool?v=new cb:(v=cb.zpp_pool,cb.zpp_pool=v.next,v.next=null),null,C=B=v.intchange=!0):v=w.fluidarb;var G=f.id_InteractionType_FLUID;if(B||v.stamp!=this.stamp||e)if(v.stamp=this.stamp,q.flowCollide(n,p,v)){B?(v.b1=a.body,v.ws1=a,v.b2=b.body,v.ws2=b,v.id=n.id,v.di=p.id,v.b1.arbiters.inlined_add(v),v.b2.arbiters.inlined_add(v),v.active=!0,v.present=0,v.cleared=!1,v.sleeping=
!1,v.fresh=!1,v.presentable=!1,v.nx=0,v.ny=1,v.dampx=0,v.dampy=0,v.adamp=0,this.f_arbiters.inlined_add(v),v.fresh=!C):v.fresh=v.up_stamp<this.stamp-1||v.endGenerated==this.stamp&&e;v.up_stamp=v.stamp;if(v.fresh||0==(v.immState&f.id_ImmState_ALWAYS)){v.immState=f.id_ImmState_ACCEPT;var E=!1;this.inlined_MRCA_chains(v.ws1.id>v.ws2.id?v.ws2:v.ws1,v.ws1.id>v.ws2.id?v.ws1:v.ws2);for(var D=this.mrca1.head;null!=D;){for(var I=D.elt,M=this.mrca2.head;null!=M;){var N=M.elt,O=I.cbSet,R=N.cbSet;if(!O.manager.pair(O,
R).empty_intersection()){var K=null,P=null;this.prelisteners.inlined_clear();O.manager.pair(O,R).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&G)&&(a[0]=l.prelisteners.inlined_insert(a[0],b),E=E||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(K=H.get(I,N),null==K&&(P=gb.get(I,N),this.add_callbackset(P)),null==K||(K.FLUIDstamp!=this.stamp||e)&&0==(K.FLUIDstate&f.id_ImmState_ALWAYS)){null!=P&&(K=P);if(null!=K)for(var Q=this.prelisteners.head;null!=Q;)Q.elt.itype==f.id_InteractionType_ANY&&
(K.COLLISIONstamp=this.stamp,K.SENSORstamp=this.stamp),K.FLUIDstamp=this.stamp,Q=Q.next;v.mutable=!0;null!=v.wrap_position&&(v.wrap_position.zpp_inner._immutable=!1);var ba=v.active;v.active=!0;this.precb.zpp_inner.pre_arbiter=v;this.precb.zpp_inner.set=K;for(var W=this.prelisteners.head;null!=W;){var ca=W.elt;this.precb.zpp_inner.listener=ca;H.int_callback(K,ca,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=I!=this.precb.zpp_inner.int1;var Z=ca.handlerp(this.precb);if(null!=Z){var la=Z;null==
f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(la==f.PreFlag_ACCEPT)v.immState=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var ma=Z;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(ma==f.PreFlag_ACCEPT_ONCE)v.immState=f.id_ImmState_ACCEPT;else{var oa=Z;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1);oa==f.PreFlag_IGNORE?v.immState=f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:v.immState=f.id_ImmState_IGNORE}}}W=
W.next}v.mutable=!1;null!=v.wrap_position&&(v.wrap_position.zpp_inner._immutable=!0);v.active=ba;if(null!=K)for(var aa=this.prelisteners.head;null!=aa;)aa.elt.itype==f.id_InteractionType_ANY&&(K.COLLISIONstate=v.immState,K.SENSORstate=v.immState),K.FLUIDstate=v.immState,aa=aa.next}else null==K?0==(v.immState&f.id_ImmState_ALWAYS)&&(v.immState=f.id_ImmState_ACCEPT):v.immState=K.FLUIDstate}M=M.next}D=D.next}if(E&&0==(v.immState&f.id_ImmState_ALWAYS)){if(v.b1.type==f.id_BodyType_DYNAMIC){var T=v.b1;
T.world||(T.component.waket=this.stamp+(this.midstep?0:1),T.type==f.id_BodyType_KINEMATIC&&(T.kinematicDelaySleep=!0),T.component.sleeping&&this.really_wake(T,!1))}if(v.b1.type==f.id_BodyType_DYNAMIC){var U=v.b2;U.world||(U.component.waket=this.stamp+(this.midstep?0:1),U.type==f.id_BodyType_KINEMATIC&&(U.kinematicDelaySleep=!0),U.component.sleeping&&this.really_wake(U,!1))}}}if(0!=(v.immState&f.id_ImmState_ACCEPT)){if(v.b1.type==f.id_BodyType_DYNAMIC&&v.b1.component.sleeping){var Y=v.b1;Y.world||
(Y.component.waket=this.stamp+(this.midstep?0:1),Y.type==f.id_BodyType_KINEMATIC&&(Y.kinematicDelaySleep=!0),Y.component.sleeping&&this.really_wake(Y,!1))}if(v.b2.type==f.id_BodyType_DYNAMIC&&v.b2.component.sleeping){var V=v.b2;V.world||(V.component.waket=this.stamp+(this.midstep?0:1),V.type==f.id_BodyType_KINEMATIC&&(V.kinematicDelaySleep=!0),V.component.sleeping&&this.really_wake(V,!1))}}v.sleeping&&(v.sleeping=!1,this.f_arbiters.inlined_add(v));h=v}else if(B){var ja=v;ja.next=cb.zpp_pool;cb.zpp_pool=
ja;h=null}else h=v;else h=v}else if(1==m){var da;da=c?this.c_arbiters_true:this.c_arbiters_false;var J;if(null==d){for(var ka=null,ga=(g.arbiters.length<k.arbiters.length?g:k).arbiters.head;null!=ga;){var ia=ga.elt;if(ia.id==n.id&&ia.di==p.id){ka=ia;break}ga=ga.next}J=ka}else J=d;var fa=null==J,u,ya=!1;fa?(null==Ea.zpp_pool?u=new Ea:(u=Ea.zpp_pool,Ea.zpp_pool=u.next,u.next=null),null,u.stat=c):null==J.colarb?(J.cleared=!0,J.b1.arbiters.inlined_try_remove(J),J.b2.arbiters.inlined_try_remove(J),null!=
J.pair&&(J.pair.arb=null,J.pair=null),J.active=!1,this.f_arbiters.modified=!0,null==Ea.zpp_pool?u=new Ea:(u=Ea.zpp_pool,Ea.zpp_pool=u.next,u.next=null),null,u.intchange=!0,u.stat=c,ya=fa=!0):(u=J.colarb,t=n!=u.s1,u.stat!=c&&(u.stat=c,u.sleeping||((c?this.c_arbiters_false:this.c_arbiters_true).remove(u),da.add(u))));var Ga=f.id_InteractionType_COLLISION;if(fa||u.stamp!=this.stamp||e)if(u.stamp=this.stamp,q.contactCollide(n,p,u,t)){fa?(u.b1=a.body,u.ws1=a,u.b2=b.body,u.ws2=b,u.id=n.id,u.di=p.id,u.b1.arbiters.inlined_add(u),
u.b2.arbiters.inlined_add(u),u.active=!0,u.present=0,u.cleared=!1,u.sleeping=!1,u.fresh=!1,u.presentable=!1,u.s1=a,u.s2=b,u.userdef_restitution||(u.restitution=-Infinity>=u.s1.material.elasticity||-Infinity>=u.s2.material.elasticity?0:Infinity<=u.s1.material.elasticity||Infinity<=u.s2.material.elasticity?1:(u.s1.material.elasticity+u.s2.material.elasticity)/2,0>u.restitution&&(u.restitution=0),1<u.restitution&&(u.restitution=1)),u.userdef_dyn_fric||(u.dyn_fric=Math.sqrt(u.s1.material.dynamicFriction*
u.s2.material.dynamicFriction)),u.userdef_stat_fric||(u.stat_fric=Math.sqrt(u.s1.material.staticFriction*u.s2.material.staticFriction)),u.userdef_rfric||(u.rfric=Math.sqrt(u.s1.material.rollingFriction*u.s2.material.rollingFriction)),da.inlined_add(u),u.fresh=!ya):u.fresh=u.up_stamp<this.stamp-1||u.endGenerated==this.stamp&&e;u.up_stamp=u.stamp;if(u.fresh||0==(u.immState&f.id_ImmState_ALWAYS)){u.immState=f.id_ImmState_ACCEPT;var wa=!1;this.inlined_MRCA_chains(u.ws1.id>u.ws2.id?u.ws2:u.ws1,u.ws1.id>
u.ws2.id?u.ws1:u.ws2);for(var na=this.mrca1.head;null!=na;){for(var pa=na.elt,qa=this.mrca2.head;null!=qa;){var za=qa.elt,S=pa.cbSet,Ha=za.cbSet;if(!S.manager.pair(S,Ha).empty_intersection()){var ea=null,xa=null;this.prelisteners.inlined_clear();S.manager.pair(S,Ha).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&Ga)&&(a[0]=l.prelisteners.inlined_insert(a[0],b),wa=wa||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(ea=H.get(pa,za),null==ea&&(xa=gb.get(pa,za),this.add_callbackset(xa)),
null==ea||(ea.COLLISIONstamp!=this.stamp||e)&&0==(ea.COLLISIONstate&f.id_ImmState_ALWAYS)){null!=xa&&(ea=xa);if(null!=ea)for(var Aa=this.prelisteners.head;null!=Aa;)Aa.elt.itype==f.id_InteractionType_ANY?(ea.COLLISIONstamp=this.stamp,ea.SENSORstamp=this.stamp,ea.FLUIDstamp=this.stamp):ea.COLLISIONstamp=this.stamp,Aa=Aa.next;u.mutable=!0;null!=u.wrap_normal&&(u.wrap_normal.zpp_inner._immutable=!1);null!=u.wrap_contacts&&(u.wrap_contacts.zpp_inner.immutable=!1);var Ra=u.active;u.active=!0;u.cleanupContacts();
this.precb.zpp_inner.pre_arbiter=u;this.precb.zpp_inner.set=ea;for(var Da=this.prelisteners.head;null!=Da;){var Za=Da.elt;this.precb.zpp_inner.listener=Za;H.int_callback(ea,Za,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=pa!=this.precb.zpp_inner.int1;var db=Za.handlerp(this.precb);if(null!=db){var Ta=db;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(Ta==f.PreFlag_ACCEPT)u.immState=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var Wa=db;null==f.PreFlag_ACCEPT_ONCE&&
(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(Wa==f.PreFlag_ACCEPT_ONCE)u.immState=f.id_ImmState_ACCEPT;else{var Xa=db;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1);Xa==f.PreFlag_IGNORE?u.immState=f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:u.immState=f.id_ImmState_IGNORE}}}Da=Da.next}u.mutable=!1;null!=u.wrap_normal&&(u.wrap_normal.zpp_inner._immutable=!0);null!=u.wrap_contacts&&(u.wrap_contacts.zpp_inner.immutable=!0);u.active=Ra;if(null!=ea)for(var Fa=
this.prelisteners.head;null!=Fa;)Fa.elt.itype==f.id_InteractionType_ANY?(ea.COLLISIONstate=u.immState,ea.SENSORstate=u.immState,ea.FLUIDstate=u.immState):ea.COLLISIONstate=u.immState,Fa=Fa.next}else null==ea?0==(u.immState&f.id_ImmState_ALWAYS)&&(u.immState=f.id_ImmState_ACCEPT):u.immState=ea.COLLISIONstate}qa=qa.next}na=na.next}if(wa&&0==(u.immState&f.id_ImmState_ALWAYS)){if(u.b1.type==f.id_BodyType_DYNAMIC){var ta=u.b1;ta.world||(ta.component.waket=this.stamp+(this.midstep?0:1),ta.type==f.id_BodyType_KINEMATIC&&
(ta.kinematicDelaySleep=!0),ta.component.sleeping&&this.really_wake(ta,!1))}if(u.b1.type==f.id_BodyType_DYNAMIC){var ua=u.b2;ua.world||(ua.component.waket=this.stamp+(this.midstep?0:1),ua.type==f.id_BodyType_KINEMATIC&&(ua.kinematicDelaySleep=!0),ua.component.sleeping&&this.really_wake(ua,!1))}}}if(0!=(u.immState&f.id_ImmState_ACCEPT)){if(u.b1.type==f.id_BodyType_DYNAMIC&&u.b1.component.sleeping){var Na=u.b1;Na.world||(Na.component.waket=this.stamp+(this.midstep?0:1),Na.type==f.id_BodyType_KINEMATIC&&
(Na.kinematicDelaySleep=!0),Na.component.sleeping&&this.really_wake(Na,!1))}if(u.b2.type==f.id_BodyType_DYNAMIC&&u.b2.component.sleeping){var va=u.b2;va.world||(va.component.waket=this.stamp+(this.midstep?0:1),va.type==f.id_BodyType_KINEMATIC&&(va.kinematicDelaySleep=!0),va.component.sleeping&&this.really_wake(va,!1))}}u.sleeping&&(u.sleeping=!1,da.inlined_add(u));h=u}else if(fa){var ha=u;ha.userdef_dyn_fric=!1;ha.userdef_stat_fric=!1;ha.userdef_restitution=!1;ha.userdef_rfric=!1;ha.__ref_edge1=ha.__ref_edge2=
null;ha.next=Ea.zpp_pool;Ea.zpp_pool=ha;h=null}else h=u;else h=u}else{var $a;if(null==d){for(var Qa=null,Ia=(g.arbiters.length<k.arbiters.length?g:k).arbiters.head;null!=Ia;){var La=Ia.elt;if(La.id==n.id&&La.di==p.id){Qa=La;break}Ia=Ia.next}$a=Qa}else $a=d;var Ba=null==$a,y,Ya=!1;Ba?(null==ra.zpp_pool?y=new ra:(y=ra.zpp_pool,ra.zpp_pool=y.next,y.next=null),null):null==$a.sensorarb?($a.cleared=!0,$a.b1.arbiters.inlined_try_remove($a),$a.b2.arbiters.inlined_try_remove($a),null!=$a.pair&&($a.pair.arb=
null,$a.pair=null),$a.active=!1,this.f_arbiters.modified=!0,null==ra.zpp_pool?y=new ra:(y=ra.zpp_pool,ra.zpp_pool=y.next,y.next=null),null,Ya=Ba=y.intchange=!0):y=$a.sensorarb;var hb=f.id_InteractionType_SENSOR;if(Ba||y.stamp!=this.stamp||e)if(y.stamp=this.stamp,q.testCollide(n,p)){Ba?(y.b1=a.body,y.ws1=a,y.b2=b.body,y.ws2=b,y.id=n.id,y.di=p.id,y.b1.arbiters.inlined_add(y),y.b2.arbiters.inlined_add(y),y.active=!0,y.present=0,y.cleared=!1,y.sleeping=!1,y.fresh=!1,y.presentable=!1,this.s_arbiters.inlined_add(y),
y.fresh=!Ya):y.fresh=y.up_stamp<this.stamp-1||y.endGenerated==this.stamp&&e;y.up_stamp=y.stamp;if(y.fresh||0==(y.immState&f.id_ImmState_ALWAYS)){y.immState=f.id_ImmState_ACCEPT;var Pa=!1;this.inlined_MRCA_chains(y.ws1.id>y.ws2.id?y.ws2:y.ws1,y.ws1.id>y.ws2.id?y.ws1:y.ws2);for(var Ja=this.mrca1.head;null!=Ja;){for(var Ka=Ja.elt,Ma=this.mrca2.head;null!=Ma;){var ab=Ma.elt,Oa=Ka.cbSet,ib=ab.cbSet;if(!Oa.manager.pair(Oa,ib).empty_intersection()){var sa=null,Sa=null;this.prelisteners.inlined_clear();Oa.manager.pair(Oa,
ib).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=(b.itype&hb)&&(a[0]=l.prelisteners.inlined_insert(a[0],b),Pa=Pa||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(sa=H.get(Ka,ab),null==sa&&(Sa=gb.get(Ka,ab),this.add_callbackset(Sa)),null==sa||(sa.SENSORstamp!=this.stamp||e)&&0==(sa.SENSORstate&f.id_ImmState_ALWAYS)){null!=Sa&&(sa=Sa);if(null!=sa)for(var Ua=this.prelisteners.head;null!=Ua;)Ua.elt.itype==f.id_InteractionType_ANY?(sa.COLLISIONstamp=this.stamp,sa.SENSORstamp=this.stamp,
sa.FLUIDstamp=this.stamp):sa.SENSORstamp=this.stamp,Ua=Ua.next;var pb=y.active;y.active=!0;this.precb.zpp_inner.pre_arbiter=y;this.precb.zpp_inner.set=sa;for(var Va=this.prelisteners.head;null!=Va;){var eb=Va.elt;this.precb.zpp_inner.listener=eb;H.int_callback(sa,eb,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=Ka!=this.precb.zpp_inner.int1;var bb=eb.handlerp(this.precb);if(null!=bb){var jb=bb;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new Ca,f.internal=!1);if(jb==f.PreFlag_ACCEPT)y.immState=
f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var kb=bb;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new Ca,f.internal=!1);if(kb==f.PreFlag_ACCEPT_ONCE)y.immState=f.id_ImmState_ACCEPT;else{var lb=bb;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new Ca,f.internal=!1);lb==f.PreFlag_IGNORE?y.immState=f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:y.immState=f.id_ImmState_IGNORE}}}Va=Va.next}y.active=pb;if(null!=sa)for(var mb=this.prelisteners.head;null!=mb;)mb.elt.itype==f.id_InteractionType_ANY?
(sa.COLLISIONstate=y.immState,sa.SENSORstate=y.immState,sa.FLUIDstate=y.immState):sa.SENSORstate=y.immState,mb=mb.next}else null==sa?0==(y.immState&f.id_ImmState_ALWAYS)&&(y.immState=f.id_ImmState_ACCEPT):y.immState=sa.SENSORstate}Ma=Ma.next}Ja=Ja.next}if(Pa&&0==(y.immState&f.id_ImmState_ALWAYS)){if(y.b1.type!=f.id_BodyType_STATIC){var wb=y.b1;wb.world||(wb.component.waket=this.stamp+(this.midstep?0:1),wb.type==f.id_BodyType_KINEMATIC&&(wb.kinematicDelaySleep=!0),wb.component.sleeping&&this.really_wake(wb,
!1))}if(y.b2.type!=f.id_BodyType_STATIC){var xb=y.b2;xb.world||(xb.component.waket=this.stamp+(this.midstep?0:1),xb.type==f.id_BodyType_KINEMATIC&&(xb.kinematicDelaySleep=!0),xb.component.sleeping&&this.really_wake(xb,!1))}}}y.sleeping&&(y.sleeping=!1,this.s_arbiters.inlined_add(y));h=y}else if(Ba){var ub=y;ub.next=ra.zpp_pool;ra.zpp_pool=ub;h=null}else h=y;else h=y}}return h},MRCA_chains:function(a,b){this.inlined_MRCA_chains(a,b)},inlined_MRCA_chains:function(a,b){this.mrca1.inlined_clear();this.mrca2.inlined_clear();
null!=a.cbSet&&this.mrca1.inlined_add(a);null!=a.body.cbSet&&this.mrca1.inlined_add(a.body);null!=b.cbSet&&this.mrca2.inlined_add(b);null!=b.body.cbSet&&this.mrca2.inlined_add(b.body);for(var c=a.body.compound,d=b.body.compound;c!=d;)(null==c?0:c.depth)<(null==d?0:d.depth)?(null!=d.cbSet&&this.mrca2.inlined_add(d),d=d.compound):(null!=c.cbSet&&this.mrca1.inlined_add(c),c=c.compound)},__class__:Wd};var ac=function(){this.next=this.prev=this.shape=this.aabb=null};ac.__name__=!0;ac.prototype={__class__:ac};
var Hd=function(a){this.list=null;nc.call(this);this.space=a;this.is_sweep=!0;this.sweep=this};Hd.__name__=!0;Hd.__super__=nc;Hd.prototype=B(nc.prototype,{__insert:function(a){var b;null==ac.zpp_pool?b=new ac:(b=ac.zpp_pool,ac.zpp_pool=b.next,b.next=null);null;a.sweep=b;b.shape=a;b.aabb=a.aabb;b.next=this.list;null!=this.list&&(this.list.prev=b);this.list=b},__remove:function(a){var b=a.sweep;null==b.prev?this.list=b.next:b.prev.next=b.next;null!=b.next&&(b.next.prev=b.prev);a.sweep=null;b.prev=null;
b.shape=null;b.aabb=null;b.next=ac.zpp_pool;ac.zpp_pool=b},sync_broadphase_fast:function(){for(var a=this.list.next;null!=a;){var b=a.next,c=a.prev;if(!(a.aabb.minx>c.aabb.minx)){for(;null!=c.prev&&c.prev.aabb.minx>a.aabb.minx;)c=c.prev;var d=a.prev;d.next=a.next;null!=a.next&&(a.next.prev=d);null==c.prev?(a.prev=null,this.list=a,a.next=c,c.prev=a):(a.prev=c.prev,c.prev=a,a.prev.next=a,a.next=c)}a=b}},broadphase:function(a,b){if(null!=this.list){this.sync_broadphase_fast();for(var c=this.list;null!=
c;){for(var d=c.next,e=c.shape,l=e.body,h=c.aabb.maxx;null!=d&&!(d.aabb.minx>h);){var g=d.shape,k=g.body;k==l||l.type==f.id_BodyType_STATIC&&k.type==f.id_BodyType_STATIC||l.component.sleeping&&k.component.sleeping||e.aabb.intersectY(g.aabb)&&(b?a.narrowPhase(e,g,l.type!=f.id_BodyType_DYNAMIC||k.type!=f.id_BodyType_DYNAMIC,null,!1):a.continuousEvent(e,g,l.type!=f.id_BodyType_DYNAMIC||k.type!=f.id_BodyType_DYNAMIC,null,!1));d=d.next}c=c.next}}},__class__:Hd});var pd=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};pd.__name__=!0;pd.prototype={inlined_add:function(a){var b;null==bc.zpp_pool?b=new bc:(b=bc.zpp_pool,bc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=
a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=bc.zpp_pool;bc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:pd};var jc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};jc.__name__=!0;jc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==ua.zpp_pool?b=new ua:(b=ua.zpp_pool,ua.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},
insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==ua.zpp_pool?c=new ua:(c=ua.zpp_pool,ua.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=ua.zpp_pool;ua.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:jc};var mc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};mc.__name__=!0;mc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;
null==Ga.zpp_pool?b=new Ga:(b=Ga.zpp_pool,Ga.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Ga.zpp_pool?c=new Ga:(c=Ga.zpp_pool,Ga.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=
this.head;this.head=a.next;a.elt=null;a.next=Ga.zpp_pool;Ga.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=
!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ga.zpp_pool;Ga.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:mc};var Ac=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Ac.__name__=!0;Ac.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==va.zpp_pool?b=new va:(b=va.zpp_pool,va.zpp_pool=b.next,
b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==va.zpp_pool?c=new va:(c=va.zpp_pool,va.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=
c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=va.zpp_pool;va.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ac};var zc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=
null};zc.__name__=!0;zc.prototype={inlined_add:function(a){var b;null==Oa.zpp_pool?b=new Oa:(b=Oa.zpp_pool,Oa.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Oa.zpp_pool;Oa.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=
this.head.elt;this.pop();return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Oa.zpp_pool;Oa.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},inlined_has:function(a){var b;
b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},__class__:zc};var jd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};jd.__name__=!0;jd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==hb.zpp_pool?b=new hb:(b=hb.zpp_pool,hb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;
this.head=a.next;a.elt=null;a.next=hb.zpp_pool;hb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=
c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=hb.zpp_pool;hb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:jd};var de=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};de.__name__=!0;de.prototype={inlined_add:function(a){var b;null==Pb.zpp_pool?b=new Pb:(b=Pb.zpp_pool,Pb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;
return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Pb.zpp_pool;Pb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=
c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Pb.zpp_pool;Pb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:de};var qd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};qd.__name__=!0;qd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ha.zpp_pool?
b=new Ha:(b=Ha.zpp_pool,Ha.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Ha.zpp_pool?c=new Ha:(c=Ha.zpp_pool,Ha.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;
this.head=a.next;a.elt=null;a.next=Ha.zpp_pool;Ha.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ha.zpp_pool;
Ha.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.head,b=null;null!=a;){var c=a.next;a.next=b;b=this.head=a;a=c}this.pushmod=this.modified=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:qd};var Fd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Fd.__name__=!0;Fd.prototype={inlined_add:function(a){var b;null==oc.zpp_pool?b=new oc:(b=oc.zpp_pool,oc.zpp_pool=b.next,b.next=null);
null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=oc.zpp_pool;oc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},__class__:Fd};var Bd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};
Bd.__name__=!0;Bd.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Bd};var Id=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Id.__name__=!0;Id.prototype={inlined_add:function(a){var b;null==Qb.zpp_pool?b=new Qb:(b=Qb.zpp_pool,Qb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&
(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Qb.zpp_pool;Qb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Id};var fe=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};fe.__name__=!0;fe.prototype={inlined_add:function(a){var b;null==Pa.zpp_pool?b=new Pa:(b=Pa.zpp_pool,Pa.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Pa.zpp_pool;Pa.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:fe};var Xc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};Xc.__name__=!0;Xc.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Rb.zpp_pool?b=new Rb:(b=Rb.zpp_pool,Rb.zpp_pool=b.next,b.next=
null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Rb.zpp_pool;Rb.zpp_pool=a;this.modified=
!0;this.length--;this.pushmod=!0;return c},__class__:Xc};var rd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};rd.__name__=!0;rd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==ha.zpp_pool?b=new ha:(b=ha.zpp_pool,ha.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==ha.zpp_pool?
c=new ha:(c=ha.zpp_pool,ha.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,
a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=ha.zpp_pool;ha.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:rd};var ee=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};ee.__name__=!0;ee.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==bb.zpp_pool?b=new bb:(b=bb.zpp_pool,bb.zpp_pool=b.next,b.next=null);null;b.elt=
a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=bb.zpp_pool;bb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,
this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=bb.zpp_pool;bb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:ee};var Ya=function(){this.next=this.elt=null};Ya.__name__=!0;Ya.prototype={__class__:Ya};var bc=function(){this.next=this.elt=null};bc.__name__=!0;bc.prototype={__class__:bc};var ua=function(){this.next=this.elt=null};ua.__name__=!0;ua.prototype={__class__:ua};var Ga=function(){this.next=
this.elt=null};Ga.__name__=!0;Ga.prototype={__class__:Ga};var Ra=function(){this.next=this.elt=null};Ra.__name__=!0;Ra.prototype={__class__:Ra};var va=function(){this.next=this.elt=null};va.__name__=!0;va.prototype={__class__:va};var Aa=function(){this.next=this.elt=null};Aa.__name__=!0;Aa.prototype={__class__:Aa};var Ib=function(){this.next=this.elt=null};Ib.__name__=!0;Ib.prototype={__class__:Ib};var jb=function(){this.next=this.elt=null};jb.__name__=!0;jb.prototype={__class__:jb};var Gb=function(){this.next=
this.elt=null};Gb.__name__=!0;Gb.prototype={__class__:Gb};var Oa=function(){this.next=this.elt=null};Oa.__name__=!0;Oa.prototype={__class__:Oa};var Hb=function(){this.next=this.elt=null};Hb.__name__=!0;Hb.prototype={__class__:Hb};var hb=function(){this.next=this.elt=null};hb.__name__=!0;hb.prototype={__class__:hb};var Pb=function(){this.next=this.elt=null};Pb.__name__=!0;Pb.prototype={__class__:Pb};var Ha=function(){this.next=this.elt=null};Ha.__name__=!0;Ha.prototype={__class__:Ha};var Fa=function(){this.next=
this.elt=null};Fa.__name__=!0;Fa.prototype={__class__:Fa};var oc=function(){this.next=this.elt=null};oc.__name__=!0;oc.prototype={__class__:oc};var Qb=function(){this.next=this.elt=null};Qb.__name__=!0;Qb.prototype={__class__:Qb};var Pa=function(){this.next=this.elt=null};Pa.__name__=!0;Pa.prototype={__class__:Pa};var Rb=function(){this.next=this.elt=null};Rb.__name__=!0;Rb.prototype={__class__:Rb};var ha=function(){this.next=this.elt=null};ha.__name__=!0;ha.prototype={__class__:ha};var bb=function(){this.next=
this.elt=null};bb.__name__=!0;bb.prototype={__class__:bb};var Ob=function(){this.at_index=0;this.at_ite=null;this.zip_length=!1;this._length=0;this.inner=null;Zb.call(this);this.at_ite=null;this.at_index=0;this.zip_length=!0;this._length=0};Ob.__name__=!0;Ob.get=function(a,b){null==b&&(b=!1);var c=new Ob;c.inner=a;c.zpp_inner.immutable=b;return c};Ob.__super__=Zb;Ob.prototype=B(Zb.prototype,{zpp_gl:function(){this.zpp_vm();if(this.zip_length){this._length=0;for(var a=this.inner.next;null!=a;)this._length++,
a=a.next;this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate();this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(a){this.zpp_vm();if(0>a||a>=this.zpp_gl())throw new m("Error: Index out of bounds");this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.at_index||null==this.at_ite)for(this.at_index=0,this.at_ite=this.inner.next;;)break;for(;this.at_index!=a;)for(this.at_index++,this.at_ite=this.at_ite.next;;)break;return this.at_ite.wrapper()},
push:function(a){if(this.zpp_inner.immutable)throw new m("Error: Vec2List is immutable");this.zpp_inner.modify_test();this.zpp_vm();if(a.zpp_inner._inuse)throw new m("Error: Vec2 is already in use");var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0){if(this.zpp_inner.reverse_flag)this.inner.add(a.zpp_inner);else{var c=this.inner.iterator_at(this.zpp_gl()-1);this.inner.insert(c,a.zpp_inner)}this.zpp_inner.invalidate();null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a)}return b},
__class__:Ob});var Da=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Ub;this._invalidated=!0};Da.__name__=!0;Da.get=function(a,b){null==b&&(b=!1);var c=new Pd;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};
Da.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Da};var ja=function(){this.user_length=
0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new mc;this._invalidated=!0};ja.__name__=!0;ja.get=function(a,b){null==b&&(b=!1);var c=new id;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};ja.prototype={valmod:function(){this.validate();this.inner.modified&&
(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:ja};var qa=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;
this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Ac;this._invalidated=!0};qa.__name__=!0;qa.get=function(a,b){null==b&&(b=!1);var c=new Td;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};qa.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=
null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:qa};var Xb=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=
this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new rd;this._invalidated=!0};Xb.__name__=!0;Xb.get=function(a,b){null==b&&(b=!1);var c=new ed;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Xb.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,
this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Xb};var Ba=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=
this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new mb;this._invalidated=!0};Ba.__name__=!0;Ba.get=function(a,b){null==b&&(b=!1);var c=new cd;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Ba.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&
this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Ba};var Yb=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=
null;this.inner=new ld;this._invalidated=!0};Yb.__name__=!0;Yb.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},
__class__:Yb};var lb=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this._modifiable=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new jc;this._invalidated=!0};lb.__name__=!0;lb.get=function(a,b){null==b&&(b=!1);var c=new Vd;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};
lb.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:lb};var V=function(){this.user_length=
0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new zc;this._invalidated=!0};V.__name__=!0;V.get=function(a,b){null==b&&(b=!1);var c=new Qd;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};V.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=
!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:V};var Nb=function(){};Nb.__name__=!0;Nb.sqr=function(a){return a*a};Nb.clamp=function(a,b,c){return a<b?b:a>c?c:a};var Ua=function(){};Ua.__name__=!0;var W=function(){this.colour=0;this.lt=this.swapped=this.data=this.prev=this.next=this.parent=null};W.__name__=!0;W.prototype={clear_with:function(a){if(null!=this.parent){for(var b=this.parent;null!=
b;)b=null!=b.prev?b.prev:null!=b.next?b.next:this.clear_node(b,a);this.parent=null}},clear_node:function(a,b){b(a.data);var c=a.parent;null!=c&&(a==c.prev?c.prev=null:c.next=null,a.parent=null);a.data=null;a.lt=null;a.swapped=null;a.next=W.zpp_pool;W.zpp_pool=a;return c},__fix_dbl_red:function(a){for(;;){var b=a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,h,g,k,m;b==c.prev?(f=c,m=c.next,a==b.prev?(d=a,e=b,h=a.prev,g=a.next,k=b.next):(d=b,e=a,h=b.prev,g=a.prev,k=a.next)):(d=c,h=c.prev,
a==b.prev?(e=a,f=b,g=a.prev,k=a.next,m=b.next):(e=b,f=a,g=b.prev,k=a.prev,m=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=h;null!=h&&(h.parent=d);d.next=g;null!=g&&(g.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=k;null!=k&&(k.parent=f);f.next=m;null!=m&&(m.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},try_insert:function(a){var b=
null,c=null;if(null==this.parent)null==W.zpp_pool?b=new W:(b=W.zpp_pool,W.zpp_pool=b.next,b.next=null),null,b.data=a,this.parent=b;else for(c=this.parent;;)if(this.lt(a,c.data))if(null==c.prev){null==W.zpp_pool?b=new W:(b=W.zpp_pool,W.zpp_pool=b.next,b.next=null);null;b.data=a;c.prev=b;b.parent=c;break}else c=c.prev;else if(this.lt(c.data,a))if(null==c.next){null==W.zpp_pool?b=new W:(b=W.zpp_pool,W.zpp_pool=b.next,b.next=null);null;b.data=a;c.next=b;b.parent=c;break}else c=c.next;else break;if(null==
b)return c;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:W};var ab=function(){this.colour=0;this.lt=this.swapped=this.data=this.prev=this.next=this.parent=null};ab.__name__=!0;ab.prototype={empty:function(){return null==this.parent},find:function(a){for(var b=this.parent;null!=b&&b.data!=a;)b=this.lt(a,b.data)?b.prev:b.next;return b},find_weak:function(a){for(var b=this.parent;null!=b;)if(this.lt(a,b.data))b=b.prev;else if(this.lt(b.data,a))b=
b.next;else break;return b},remove:function(a){a=this.find(a);this.remove_node(a)},remove_node:function(a){if(null!=a.next&&null!=a.prev){for(var b=a.next;null!=b.prev;)b=b.prev;var c=a.data;a.data=b.data;b.data=c;null!=this.swapped&&this.swapped(a.data,b.data);a=b}b=null==a.prev?a.next:a.prev;if(1==a.colour)if(null!=a.prev||null!=a.next)b.colour=1;else if(null!=a.parent)for(c=a.parent;;){c.colour++;c.prev.colour--;c.next.colour--;var d=c.prev;if(-1==d.colour){this.__fix_neg_red(d);break}else if(0==
d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}d=c.next;if(-1==d.colour){this.__fix_neg_red(d);break}else if(0==d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}if(2==c.colour)if(null==c.parent)c.colour=1;else{c=c.parent;continue}break}c=a.parent;null==c?this.parent=b:c.prev==a?c.prev=b:c.next=b;null!=
b&&(b.parent=c);a.parent=a.prev=a.next=null;a.data=null;a.lt=null;a.swapped=null;a.next=ab.zpp_pool;ab.zpp_pool=a},__fix_neg_red:function(a){var b=a.parent;if(b.prev==a){var c=a.prev,d=a.next,e=d.prev,f=d.next;c.colour=0;a.colour=b.colour=1;a.next=e;null!=e&&(e.parent=a);a=b.data;b.data=d.data;d.data=a;null!=this.swapped&&this.swapped(b.data,d.data);d.prev=f;null!=f&&(f.parent=d);d.next=b.next;null!=b.next&&(b.next.parent=d);b.next=d}else c=a.next,d=a.prev,e=d.next,f=d.prev,c.colour=0,a.colour=b.colour=
1,a.prev=e,null!=e&&(e.parent=a),a=b.data,b.data=d.data,d.data=a,null!=this.swapped&&this.swapped(b.data,d.data),d.next=f,null!=f&&(f.parent=d),d.prev=b.prev,null!=b.prev&&(b.prev.parent=d),b.prev=d;null!=d&&(d.parent=b);b=c;null!=b.prev&&0==b.prev.colour?this.__fix_dbl_red(b.prev):null!=b.next&&0==b.next.colour&&this.__fix_dbl_red(b.next)},__fix_dbl_red:function(a){for(;;){var b=a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,h,g,k,m;b==c.prev?(f=c,m=c.next,a==b.prev?(d=a,e=b,h=a.prev,
g=a.next,k=b.next):(d=b,e=a,h=b.prev,g=a.prev,k=a.next)):(d=c,h=c.prev,a==b.prev?(e=a,f=b,g=a.prev,k=a.next,m=b.next):(e=b,f=a,g=b.prev,k=a.prev,m=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=h;null!=h&&(h.parent=d);d.next=g;null!=g&&(g.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=k;null!=k&&(k.parent=f);f.next=m;null!=m&&(m.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=
1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},insert:function(a){var b;null==ab.zpp_pool?b=new ab:(b=ab.zpp_pool,ab.zpp_pool=b.next,b.next=null);null;b.data=a;if(null==this.parent)this.parent=b;else for(a=this.parent;;)if(this.lt(b.data,a.data))if(null==a.prev){a.prev=b;b.parent=a;break}else a=a.prev;else if(null==a.next){a.next=b;b.parent=a;break}else a=a.next;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:ab};var Mb,Ge=0;String.prototype.__class__=
String;String.__name__=!0;Array.__name__=!0;Date.prototype.__class__=Date;Date.__name__=["Date"];var He={__name__:["Int"]},Ie={__name__:["Dynamic"]},ne=Number;ne.__name__=["Float"];var oe=Boolean;oe.__ename__=["Bool"];var Je={__name__:["Class"]},Ke={},pc=window.OscillatorNode;null!=pc&&(Object.prototype.hasOwnProperty.call(pc,"SINE")?window.TonesOscillatorTypeShim={SINE:pc.SINE,SQUARE:pc.SQUARE,TRIANGLE:pc.TRIANGLE,SAWTOOTH:pc.SAWTOOTH,CUSTOM:pc.CUSTOM}:window.TonesOscillatorTypeShim={SINE:"sine",
SQUARE:"square",TRIANGLE:"triangle",SAWTOOTH:"sawtooth",CUSTOM:"custom"});Ja._frameTick=new bd;window.requestAnimationFrame(Ja.onFrame);Jc.hasField(window,"performance")&&Jc.isFunction((Mb=window.performance,x(Mb,Mb.now)))?Ja.nowTime=(Mb=window.performance,x(Mb,Mb.now)):(Ja.initTime=(new Date).getTime(),Ja.nowTime=function(){return(new Date).getTime()-Ja.initTime});ma.FixedTimeStep=.016666666666666666;ma.VelocityIterationsPerTimeStep=10;ma.PositionIterationsPerTimeStep=10;ba.ANY_SHAPE=new Ia;ba.ANY_BODY=
new Ia;ba.ANY_COMPOUND=new Ia;ba.ANY_CONSTRAINT=new Ia;oa._Constraint=0;oa._Interactor=0;oa._CbType=0;oa._CbSet=0;oa._Listener=0;Ka.sensorCbType=new Ia;Ka.barCbType=new Ia;Kc.count=0;I.__toStr={}.toString;p.epsilon=1E-8;p.fluidAngularDragFriction=2.5;p.fluidAngularDrag=100;p.fluidVacuumDrag=.5;p.fluidLinearDrag=.5;p.collisionSlop=.2;p.collisionSlopCCD=.5;p.distanceThresholdCCD=.05;p.staticCCDLinearThreshold=.05;p.staticCCDAngularThreshold=.005;p.bulletCCDLinearThreshold=.125;p.bulletCCDAngularThreshold=
.0125;p.dynamicSweepLinearThreshold=17;p.dynamicSweepAngularThreshold=.6;p.angularCCDSlipScale=.75;p.arbiterExpirationDelay=6;p.staticFrictionThreshold=2;p.elasticThreshold=20;p.sleepDelay=60;p.linearSleepThreshold=.2;p.angularSleepThreshold=.4;p.contactBiasCoef=.3;p.contactStaticBiasCoef=.6;p.contactContinuousBiasCoef=.4;p.contactContinuousStaticBiasCoef=.5;p.constraintLinearSlop=.1;p.constraintAngularSlop=.001;p.illConditionedThreshold=2E8;ya.zpp_internalAlloc=!1;O.zpp_internalAlloc=!1;da.zpp_internalAlloc=
!1;Ja.initTime=0;U.internal=!1;f.internal=!1;f.id_ImmState_ACCEPT=1;f.id_ImmState_IGNORE=2;f.id_ImmState_ALWAYS=4;f.id_GravMassMode_DEFAULT=0;f.id_GravMassMode_FIXED=1;f.id_GravMassMode_SCALED=2;f.id_InertiaMode_DEFAULT=0;f.id_MassMode_DEFAULT=0;f.id_BodyType_STATIC=1;f.id_BodyType_DYNAMIC=2;f.id_BodyType_KINEMATIC=3;f.id_ListenerType_BODY=0;f.id_ListenerType_CONSTRAINT=1;f.id_PreFlag_ACCEPT=1;f.id_ListenerType_INTERACTION=2;f.id_ListenerType_PRE=3;f.id_CbEvent_BEGIN=0;f.id_CbEvent_ONGOING=6;f.id_InteractionType_COLLISION=
1;f.id_CbEvent_END=1;f.id_InteractionType_SENSOR=2;f.id_CbEvent_WAKE=2;f.id_InteractionType_FLUID=4;f.id_CbEvent_SLEEP=3;f.id_InteractionType_ANY=7;f.id_CbEvent_BREAK=4;f.id_CbEvent_PRE=5;f.id_ShapeType_CIRCLE=0;f.id_ShapeType_POLYGON=1;N.internal=!1;ca.UCbSet=new Gc;ca.VCbSet=new Gc;ca.WCbSet=new Gc;ca.UCbType=new mb;ca.VCbType=new mb;ca.WCbType=new mb;z.internal=!1;z.COL=1;z.FLUID=4;z.SENSOR=2;M.internal=!1;q.flowpoly=new ld;q.flowsegs=new ld;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=
new T,f.internal=!1);var Le=f.BodyType_STATIC;null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new T,f.internal=!1);var Me=f.BodyType_DYNAMIC;null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new T,f.internal=!1);kb.types=[null,Le,Me,f.BodyType_KINEMATIC];C.WAKE=1;C.PROPS=2;C.ANGDRAG=4;C.ARBITERS=8;A.internal=!1;fa.tmpaabb=new la;Da.internal=!1;ja.internal=!1;qa.internal=!1;Xb.internal=!1;Ba.internal=!1;Yb.internal=!1;lb.internal=!1;V.internal=!1;cc.main()})("undefined"!=
typeof console?console:{log:function(){}},"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
